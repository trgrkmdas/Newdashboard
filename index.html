<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- CSP Vercel'in vercel.json dosyasÄ±nda tanÄ±mlÄ±, burada tekrar tanÄ±mlamaya gerek yok -->
    <title>Zuhal MÃ¼zik Raporlama</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">
    <!-- Cache kontrolÃ¼ Vercel headers ile yapÄ±lÄ±yor (vercel.json) -->
    <!-- Pako.js for GZIP Decompression (Fallback) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <!-- Chart.js for Graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <!-- CryptoJS kaldÄ±rÄ±ldÄ± - Firebase authentication yeterli -->
    <!-- Firebase SDK -->
    <script type="module" src="assets/js/services/firebase-service.js"></script>
    <!-- Performance Optimizer -->
    <script defer src="js/performance-optimizer.js"></script>
    <!-- Enhanced AI Analyzer -->
    <script defer src="js/ai-analyzer-enhanced.js"></script>
    <!-- Enhanced Time Analysis -->
    <script defer src="js/time-analysis-enhanced.js"></script>
    <!-- Vercel Speed Insights -->
    <script type="module">
        // Sadece production'da Ã§alÄ±ÅŸtÄ±r (localhost'ta deÄŸil)
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            import('./js/speed-insights.js').then((module) => {
                // injectSpeedInsights fonksiyonunu Ã§aÄŸÄ±r
                if (module.injectSpeedInsights) {
                    module.injectSpeedInsights();
                } else if (module.default && module.default.injectSpeedInsights) {
                    module.default.injectSpeedInsights();
                }
            }).catch(() => {
                // Paket yÃ¼klenemezse sessizce devam et
            });
        }
    </script>
    
    <!-- CSS ModÃ¼lleri -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link rel="stylesheet" href="assets/css/loading.css">
    <link rel="stylesheet" href="assets/css/modal.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    
    <!-- Core ModÃ¼lleri -->
    <script type="module" src="assets/js/core/config.js"></script>
    <script type="module" src="assets/js/core/constants.js"></script>
    <script type="module" src="assets/js/core/utils.js"></script>
    <script type="module" src="assets/js/core/logger.js"></script>
    <script type="module" src="assets/js/core/district-normalizer.js"></script>
    <script type="module" src="assets/js/core/tab-manager.js"></script>
    
    <!-- Data ModÃ¼lleri -->
    <script type="module" src="assets/js/data/metadata-manager.js"></script>
    <script type="module" src="assets/js/data/data-processor.js"></script>
    <script type="module" src="assets/js/data/data-loader.js"></script>
    
    <!-- Filter ModÃ¼lleri -->
    <script type="module" src="assets/js/filters/filter-manager.js"></script>
    <script type="module" src="assets/js/filters/search-engine.js"></script>
    <script type="module" src="assets/js/filters/ai-filter.js"></script>
    
    <!-- Chart ModÃ¼lleri -->
    <script type="module" src="assets/js/charts/chart-manager.js"></script>
    <script type="module" src="assets/js/charts/sales-charts.js"></script>
    <script type="module" src="assets/js/charts/inventory-charts.js"></script>
    <script type="module" src="assets/js/charts/dashboard-charts.js"></script>
    
    <!-- Component ModÃ¼lleri -->
    <script type="module" src="assets/js/components/table-renderer.js"></script>
    <script type="module" src="assets/js/components/summary-cards.js"></script>
    <script type="module" src="assets/js/components/inventory-table.js"></script>
    
    <!-- Feature ModÃ¼lleri -->
    <script type="module" src="assets/js/features/dashboard.js"></script>
    <script type="module" src="assets/js/features/products/product-analyzer.js"></script>
    <script type="module" src="assets/js/features/dashboard/dashboard.js"></script>
    <script type="module" src="assets/js/features/ai/dashboard-ai-analyzer.js"></script>
    <script type="module" src="assets/js/features/payments/payment-analyzer.js"></script>
    <script type="module" src="assets/js/features/analytics/inventory-analytics.js"></script>
    <script type="module" src="assets/js/features/analytics/time-analytics.js"></script>
    <script type="module" src="assets/js/features/sales/daily-sales.js"></script>
    <script type="module" src="assets/js/features/customers/customer-analyzer.js"></script>
    <!-- store-analyzer.js artÄ±k dinamik olarak import() ile yÃ¼kleniyor -->
    
    <!-- Service ModÃ¼lleri -->
    <script type="module" src="assets/js/services/export-service.js"></script>
    <script type="module" src="assets/js/services/voice-service.js"></script>
    
    <!-- Dashboard BaÅŸlatma -->
    <script>
        // safeConsole, getDailyVersion, getHourlyVersion, loadMetadata, loadYearData, vb. artÄ±k modÃ¼llerden geliyor
        // Global eriÅŸim iÃ§in window'a ekleniyorlar
        
        // safeConsole fallback (modÃ¼l yÃ¼klenene kadar)
        const safeConsoleFallback = {
            log: (...args) => console.log(...args),
            warn: (...args) => console.warn(...args),
            error: (...args) => console.error(...args),
            info: (...args) => console.info(...args),
            debug: (...args) => console.debug(...args)
        };
        
        // safeConsole'u modÃ¼l yÃ¼klenene kadar fallback kullan
        let safeConsole = safeConsoleFallback;
        
        // ModÃ¼l yÃ¼klendikten sonra gerÃ§ek safeConsole'u kullan
        if (typeof window.safeConsole !== 'undefined') {
            safeConsole = window.safeConsole;
        } else {
            // ModÃ¼l yÃ¼klenene kadar bekle
            const checkSafeConsole = setInterval(() => {
                if (typeof window.safeConsole !== 'undefined') {
                    safeConsole = window.safeConsole;
                    clearInterval(checkSafeConsole);
                }
            }, 10);
        }
        
        // ===== GLOBAL DATA LOADING FUNCTION =====
        // Loading guard - aynÄ± anda birden fazla Ã§aÄŸrÄ±lmasÄ±nÄ± Ã¶nler
        // loadData() fonksiyonu artÄ±k assets/js/data/data-loader.js modÃ¼lÃ¼nden geliyor
        window.isLoadingData = false;
        window.dataLoaded = false; // Veri yÃ¼kleme tamamlandÄ± mÄ±?
        
        // Sayfa yÃ¼klendiÄŸinde dashboard'Ä± otomatik baÅŸlat
        // NOT: Firebase auth listener da loadData Ã§aÄŸÄ±rabilir, bu yÃ¼zden koordinasyon Ã¶nemli
        (function() {
            (window.safeConsole || safeConsoleFallback).log('ğŸš€ Dashboard otomatik baÅŸlatÄ±lÄ±yor...');
            setTimeout(() => {
                // EÄŸer veri zaten yÃ¼klendiyse veya yÃ¼kleme devam ediyorsa, otomatik baÅŸlatmayÄ± atla
                if (window.dataLoaded) {
                    (window.safeConsole || safeConsoleFallback).log('âœ… Veri zaten yÃ¼klÃ¼, otomatik baÅŸlatma atlandÄ±');
                    return;
                }
                
                if (window.isLoadingData) {
                    (window.safeConsole || safeConsoleFallback).log('â¸ï¸ Veri yÃ¼kleme zaten devam ediyor, otomatik baÅŸlatma atlandÄ±');
                    return;
                }
                
                // loadData fonksiyonu modÃ¼lden geliyor, yÃ¼klenene kadar bekle
                if (typeof window.loadData === 'function') {
                    window.loadData();
                } else {
                    // ModÃ¼l henÃ¼z yÃ¼klenmedi, biraz bekle ve tekrar dene
                    setTimeout(() => {
                        if (typeof window.loadData === 'function') {
                            window.loadData();
                        } else {
                            (window.safeConsole || safeConsoleFallback).warn('âš ï¸ loadData fonksiyonu henÃ¼z yÃ¼klenmedi');
                        }
                    }, 500);
                }
            }, 1000); // 1 saniye loading
        })();
        
        // ===== CACHE VERSION FUNCTIONS =====
        // getDailyVersion ve getHourlyVersion artÄ±k assets/js/core/utils.js modÃ¼lÃ¼nden geliyor
        
        // ===== METADATA CACHE CONTROL =====
        // Metadata cache fonksiyonlarÄ± (getLastMetadataUpdate, saveLastMetadataUpdate, isMetadataUpdated)
        // artÄ±k assets/js/data/metadata-manager.js modÃ¼lÃ¼nden geliyor
        // Global eriÅŸim iÃ§in window'a ekleniyorlar
        
        // loadMetadata ve loadYearData artÄ±k modÃ¼llerden geliyor (metadata-manager.js ve data-loader.js)
        // Global eriÅŸim iÃ§in window'a ekleniyorlar
        
    </script>
</head>
    <body>
    <!-- Email Authentication Form -->

        <!-- Loading Screen -->
        <div id="loadingScreen">
            <div>
                <!-- Animated Icon -->
                <div id="loadingIcon">ğŸ“Š</div>
                <h1>Zuhal MÃ¼zik Raporlama</h1>
                <p>HoÅŸ Geldiniz! Veriler yÃ¼kleniyor...</p>
                
                <!-- Progress Bar -->
                <div>
                    <div id="progressBar">
                        <div></div>
                    </div>
                </div>
                
                <!-- Progress Text -->
                <div id="progressText">0%</div>
                
                <!-- Loading Steps -->
                <div id="loadingSteps">
                    <div id="step1">ğŸ”„ Sayfa baÅŸlatÄ±lÄ±yor...</div>
                    <div id="step2" style="display: none;">ğŸ“Š Veri dosyalarÄ± yÃ¼kleniyor...</div>
                    <div id="step3" style="display: none;">ğŸ¯ Hedefler yÃ¼kleniyor...</div>
                    <div id="step4" style="display: none;">âœ… HazÄ±rlanÄ±yor...</div>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal">
            <div>
                <h2>ğŸ” GiriÅŸ Yap</h2>
                <input type="email" id="loginEmail" placeholder="E-posta">
                <input type="password" id="loginPassword" placeholder="Åifre">
                <div>
                    <a href="#" onclick="handleForgotPassword(); return false;">Åifremi Unuttum</a>
                </div>
                <div>
                    <button onclick="handleLogin()">GiriÅŸ Yap</button>
                </div>
                <p id="loginError"></p>
                <p id="loginSuccess"></p>
            </div>
        </div>

        <div class="container" id="mainContainer">
        <div class="header">
            <div class="header-brand">
                <div class="header-icon">ğŸ“Š</div>
                <div class="header-text">
                    <h1>Zuhal MÃ¼zik Raporlama</h1>
                    <p>MÃ¼zik EnstrÃ¼man SektÃ¶rÃ¼</p>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-badge year-toggle-wrapper">
                    <div id="yearToggleContainer" class="year-toggle-container" style="display: none;"></div>
                </div>
                <div class="stat-badge">
                    <span class="stat-icon">ğŸ•’</span>
                    <div class="stat-content">
                        <span class="stat-label">Son GÃ¼ncelleme</span>
                        <span class="stat-value" id="lastUpdate">-</span>
                    </div>
                </div>
                <div class="stat-badge">
                    <span class="stat-icon">ğŸ“ˆ</span>
                    <div class="stat-content">
                        <span class="stat-label">Toplam KayÄ±t</span>
                        <span class="stat-value" id="totalRecords">-</span>
                    </div>
                </div>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">
                    <span class="user-initial">U</span>
                </div>
                <div class="user-details">
                    <span class="user-email-badge" id="currentUserName" data-full-email=""></span>
                </div>
                <div class="user-divider"></div>
                <button id="loginBtn" onclick="showLoginModal()" class="btn-icon">ğŸ”</button>
                <button id="logoutBtn" onclick="handleLogout()" class="btn-logout">
                    <span class="btn-icon-text">ğŸšª</span>
                    <span class="btn-text">Ã‡Ä±kÄ±ÅŸ</span>
                </button>
            </div>
        </div>

        <!-- Global SatÄ±ÅŸ KanalÄ± Filtresi -->
        <div class="channel-filter-section">
            <h3>ğŸ¢ SatÄ±ÅŸ KanalÄ± Filtresi</h3>
            <div class="channel-filter-grid">
                <label class="channel-filter-label">
                    <input type="checkbox" id="channelAll" checked onchange="handleChannelFilter('channelAll')">
                    <span>âœ¨ TÃ¼mÃ¼ (19 Kanal)</span>
                </label>
                <label class="channel-filter-label">
                    <input type="checkbox" id="channelRetail" onchange="handleChannelFilter('channelRetail')">
                    <span>ğŸª Perakende (14)</span>
                </label>
                <label class="channel-filter-label">
                    <input type="checkbox" id="channelWholesale" onchange="handleChannelFilter('channelWholesale')">
                    <span>ğŸ“¦ Toptan SatÄ±ÅŸ</span>
                </label>
                <label class="channel-filter-label">
                    <input type="checkbox" id="channelOnline" onchange="handleChannelFilter('channelOnline')">
                    <span>ğŸŒ Online SatÄ±ÅŸ</span>
                </label>
                <label class="channel-filter-label">
                    <input type="checkbox" id="channelCorporate" onchange="handleChannelFilter('channelCorporate')">
                    <span>ğŸ¢ Kurumsal SatÄ±ÅŸ</span>
                </label>
                <label class="channel-filter-label">
                    <input type="checkbox" id="channelCentral" onchange="handleChannelFilter('channelCentral')">
                    <span>ğŸ›ï¸ Merkezi SatÄ±ÅŸ</span>
                </label>
            </div>
            
            <!-- AI Sorgu AlanÄ± -->
            <div class="ai-query-section">
                <div class="ai-query-container">
                    <input type="text" id="aiQueryInput" placeholder="ğŸ¤– Verileriniz hakkÄ±nda soru sorun... (Ã¶rn: Bu ayÄ±n en Ã§ok satan Ã¼rÃ¼nÃ¼ nedir?)" 
                           onkeypress="if(event.key === 'Enter') askAI()">
                    <button id="aiQueryButton" onclick="askAI()">
                        ğŸ¤– Sor
                    </button>
                </div>
                <div id="aiResponseContainer">
                    <div id="aiResponseText"></div>
                </div>
                <div id="aiLoadingIndicator">
                    <div></div>
                    AI dÃ¼ÅŸÃ¼nÃ¼yor...
                </div>
            </div>
        </div>

        <!-- Loading Spinner for Channel Filter -->
        <div id="channelLoadingSpinner" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
            <div style="text-align: center;">
                <div style="width: 80px; height: 80px; border: 8px solid rgba(255,255,255,0.2); border-top: 8px solid #10B981; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                <div style="color: white; font-size: 1.3em; font-weight: bold;" id="channelLoadingText">ğŸ”„ Filtreleniyor...</div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9em; margin-top: 10px;">LÃ¼tfen bekleyin</div>
            </div>
        </div>

        <style>
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        </style>

        <!-- Info-box removed - stats moved to header -->

        <!-- Tab Navigation - Premium Compact Design -->
        <div class="tabs-wrapper">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('dashboard')">
                    <span class="tab-icon">ğŸ </span>
                    <span class="tab-text">Dashboard</span>
                </button>
                <button class="tab" onclick="switchTab('dailySales')">
                    <span class="tab-icon">ğŸ“…</span>
                    <span class="tab-text">GÃ¼nlÃ¼k SatÄ±ÅŸ</span>
                </button>
                <button class="tab" onclick="switchTab('targets')">
                    <span class="tab-icon">ğŸ¯</span>
                    <span class="tab-text">Hedef Takip</span>
                </button>
                <button class="tab" onclick="switchTab('customers')">
                    <span class="tab-icon">ğŸ‘¥</span>
                    <span class="tab-text">MÃ¼ÅŸteri Analizi</span>
                </button>
                <button class="tab" onclick="switchTab('salesperson')">
                    <span class="tab-icon">ğŸ‘¨â€ğŸ’¼</span>
                    <span class="tab-text">SatÄ±ÅŸ Temsilcisi</span>
                </button>
                <button class="tab" onclick="switchTab('store')">
                    <span class="tab-icon">ğŸª</span>
                    <span class="tab-text">MaÄŸaza Analizi</span>
                </button>
                <button class="tab" onclick="switchTab('city')">
                    <span class="tab-icon">ğŸŒ</span>
                    <span class="tab-text">Åehir Analizi</span>
                </button>
                <button class="tab" onclick="switchTab('stock')">
                    <span class="tab-icon">ğŸ“¦</span>
                    <span class="tab-text">Stok DaÄŸÄ±lÄ±m</span>
                </button>
                <button class="tab" onclick="switchTab('time')">
                    <span class="tab-icon">â°</span>
                    <span class="tab-text">Zaman Analizi</span>
                </button>
                <button class="tab" onclick="switchTab('product')">
                    <span class="tab-icon">ğŸ¸</span>
                    <span class="tab-text">ÃœrÃ¼n Analizi</span>
                </button>
                <button class="tab" onclick="switchTab('inventory')">
                    <span class="tab-icon">ğŸ“Š</span>
                    <span class="tab-text">Envanter</span>
                </button>
                <button class="tab" onclick="switchTab('payments')">
                    <span class="tab-icon">ğŸ’³</span>
                    <span class="tab-text">Ã–deme Analizi</span>
                </button>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content active">
            <div class="content">
                <!-- Genel Ã–zet KartlarÄ± -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; margin-bottom: 40px;">
                    <div class="summary-card">
                        <h3 id="dashTotalSalesTitle" style="font-size: 0.75em; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2;">ğŸ’° Toplam SatÄ±ÅŸ</h3>
                        <p id="dashTotalSales" style="color: white; font-size: 1.1em; font-weight: bold; margin: 5px 0; word-break: break-all; line-height: 1.2;">$0</p>
                        <small style="opacity: 0.8; font-size: 0.7em; line-height: 1.2;">KDV HariÃ§ - TÃ¼m zamanlar</small>
                    </div>
                    <div class="summary-card">
                        <h3 style="font-size: 0.75em; margin-bottom: 5px; line-height: 1.2;">ğŸ“¦ Toplam ÃœrÃ¼n</h3>
                        <p id="dashTotalQty" style="color: white; font-size: 1.1em; font-weight: bold; margin: 5px 0; line-height: 1.2;">0</p>
                        <small style="opacity: 0.8; font-size: 0.7em; line-height: 1.2;">SatÄ±lan Ã¼rÃ¼n adedi</small>
                    </div>
                    <div class="summary-card">
                        <h3 style="font-size: 0.75em; margin-bottom: 5px; line-height: 1.2;">ğŸ‘¥ MÃ¼ÅŸteri</h3>
                        <p id="dashTotalCustomers" style="color: white; font-size: 1.1em; font-weight: bold; margin: 5px 0; line-height: 1.2;">0</p>
                        <small style="opacity: 0.8; font-size: 0.7em; line-height: 1.2;">Aktif mÃ¼ÅŸteri sayÄ±sÄ±</small>
                    </div>
                    <div class="summary-card">
                        <h3 style="font-size: 0.75em; margin-bottom: 5px; line-height: 1.2;">ğŸ¸ FarklÄ± ÃœrÃ¼n</h3>
                        <p id="dashTotalProducts" style="color: white; font-size: 1.1em; font-weight: bold; margin: 5px 0; line-height: 1.2;">0</p>
                        <small style="opacity: 0.8; font-size: 0.7em; line-height: 1.2;">ÃœrÃ¼n Ã§eÅŸidi</small>
                    </div>
                    <div class="summary-card">
                        <h3 style="font-size: 0.75em; margin-bottom: 5px; line-height: 1.2;">ğŸª MaÄŸaza</h3>
                        <p id="dashTotalStores" style="color: white; font-size: 1.1em; font-weight: bold; margin: 5px 0; line-height: 1.2;">0</p>
                        <small style="opacity: 0.8; font-size: 0.7em; line-height: 1.2;">Aktif maÄŸaza sayÄ±sÄ±</small>
                    </div>
                    <div class="summary-card">
                        <h3 style="font-size: 0.75em; margin-bottom: 5px; line-height: 1.2;">ğŸ‘¨â€ğŸ’¼ Temsilci</h3>
                        <p id="dashTotalSalespeople" style="color: white; font-size: 1.1em; font-weight: bold; margin: 5px 0; line-height: 1.2;">0</p>
                        <small style="opacity: 0.8; font-size: 0.7em; line-height: 1.2;">Aktif temsilci sayÄ±sÄ±</small>
                    </div>
                    <div class="summary-card">
                        <h3 style="font-size: 0.75em; margin-bottom: 5px; line-height: 1.2;">ğŸ“… GÃ¼nlÃ¼k Ortalama</h3>
                        <p id="dashDailyAverage" style="color: white; font-size: 1.1em; font-weight: bold; margin: 5px 0; line-height: 1.2;">$0</p>
                        <small style="opacity: 0.8; font-size: 0.7em; line-height: 1.2;">GÃ¼nlÃ¼k ortalama satÄ±ÅŸ</small>
                    </div>
                    <div class="summary-card">
                        <h3 style="font-size: 0.75em; margin-bottom: 5px; line-height: 1.2;">ğŸ›’ Sepet OrtalamasÄ±</h3>
                        <p id="dashBasketAverage" style="color: white; font-size: 1.1em; font-weight: bold; margin: 5px 0; line-height: 1.2;">$0</p>
                        <small style="opacity: 0.8; font-size: 0.7em; line-height: 1.2;">Ortalama iÅŸlem tutarÄ±</small>
                    </div>
                    <div class="summary-card">
                        <h3 style="font-size: 0.75em; margin-bottom: 5px; line-height: 1.2;">ğŸ“„ Fatura SayÄ±sÄ±</h3>
                        <p id="dashTotalInvoices" style="color: white; font-size: 1.1em; font-weight: bold; margin: 5px 0; line-height: 1.2;">0</p>
                        <small style="opacity: 0.8; font-size: 0.7em; line-height: 1.2;">Benzersiz fatura sayÄ±sÄ±</small>
                    </div>
                </div>

                <!-- YÄ±llÄ±k KarÅŸÄ±laÅŸtÄ±rma -->
                <div style="background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); margin-bottom: 40px; color: #e2e8f0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">ğŸ“Š YÄ±llÄ±k SatÄ±ÅŸ KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3>
                        <div style="display: flex; gap: 10px;">
                            <button id="dashYearlyMetricSales" onclick="changeDashYearlyMetric('sales')" style="padding: 8px 20px; border: 2px solid #10B981; background: #10B981; color: white; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                ğŸ’° SatÄ±ÅŸ (USD)
                            </button>
                            <button id="dashYearlyMetricQty" onclick="changeDashYearlyMetric('qty')" style="padding: 8px 20px; border: 2px solid #10B981; background: rgba(30, 41, 59, 0.8); color: #10B981; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                ğŸ“¦ Miktar
                            </button>
                        </div>
                    </div>
                    <canvas id="dashYearlyChart" style="max-height: 400px;"></canvas>
            </div>
            
                <!-- Top Performanslar -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; margin-bottom: 40px;">
                    <div style="background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); height: 580px; color: #e2e8f0; overflow-y: auto;">
                        <h3 style="margin-bottom: 20px; font-size: 1.2em;">ğŸ† Top 10 MaÄŸaza (TÃ¼m Zamanlar)</h3>
                        <div id="dashTopStoresList" class="store-list-progress">
                            <!-- Progress bar listesi buraya render edilecek -->
                        </div>
                    </div>
                    <div style="background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); height: 580px; color: #e2e8f0; overflow-y: auto;">
                        <h3 style="margin-bottom: 20px; font-size: 1.2em;">â­ Top 10 SatÄ±ÅŸ Temsilcisi (TÃ¼m Zamanlar)</h3>
                        <div id="dashTopSalespeopleList" class="store-list-progress">
                            <!-- Progress bar listesi buraya render edilecek -->
                        </div>
                    </div>
                    <div style="background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); height: 580px; color: #e2e8f0; overflow-y: auto;">
                        <h3 style="margin-bottom: 20px; font-size: 1.2em;">ğŸ·ï¸ Top 10 Marka (TÃ¼m Zamanlar)</h3>
                        <div id="dashTopBrandsList" class="store-list-progress">
                            <!-- Progress bar listesi buraya render edilecek -->
                        </div>
                    </div>
                    <div style="background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); height: 580px; color: #e2e8f0; overflow-y: auto;">
                        <h3 style="margin-bottom: 20px; font-size: 1.2em;">ğŸ“‚ Top 10 Kategori (TÃ¼m Zamanlar)</h3>
                        <div id="dashTopCategoriesList" class="store-list-progress">
                            <!-- Progress bar listesi buraya render edilecek -->
                        </div>
                    </div>
                    <div style="background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); height: 580px; color: #e2e8f0; overflow-y: auto;">
                        <h3 style="margin-bottom: 20px; font-size: 1.2em;">ğŸŒ Top 10 Åehir (TÃ¼m Zamanlar)</h3>
                        <div id="dashTopCitiesList" class="store-list-progress">
                            <!-- Progress bar listesi buraya render edilecek -->
                        </div>
                    </div>
                    <div style="background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); height: 580px; color: #e2e8f0; overflow-y: auto;">
                        <h3 style="margin-bottom: 20px; font-size: 1.2em;">ğŸ¸ Top 10 ÃœrÃ¼n (TÃ¼m Zamanlar)</h3>
                        <div id="dashTopProductsList" class="store-list-progress">
                            <!-- Progress bar listesi buraya render edilecek -->
                        </div>
                    </div>
                </div>

                <!-- AI Dashboard Analizi -->
                <div style="background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); padding: 30px; border-radius: 15px; margin-bottom: 40px;">
                    <h3 style="color: white; margin-bottom: 20px;">ğŸ¤– AI Dashboard Analizi</h3>
                    <div id="dashAIAnalysis" style="background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); padding: 20px; border-radius: 10px; line-height: 1.8; border: 1px solid rgba(255,255,255,0.1); color: #e2e8f0;"></div>
            </div>
        </div>
        </div>
        <!-- End Dashboard Tab -->

        <!-- Daily Sales Tab -->
        <div id="dailySalesTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 30px; text-align: center;">ğŸ“… GÃ¼nlÃ¼k SatÄ±ÅŸ</h2>
                
                <!-- Filtreler -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 1.1em;">ğŸª MaÄŸaza (Opsiyonel)</label>
                        <select id="dailySalesStoreFilter" onchange="loadDailySales()"
                                style="width: 100%; padding: 12px; border: 2px solid #10B981; border-radius: 8px; font-size: 1em; background: rgba(30, 41, 59, 0.8); color: #e2e8f0;">
                            <option value="">TÃ¼m MaÄŸazalar</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 1.1em;">ğŸ“… YÄ±l</label>
                        <select id="dailySalesYearFilter" onchange="loadDailySales()"
                                style="width: 100%; padding: 12px; border: 2px solid #10B981; border-radius: 8px; font-size: 1em; background: rgba(30, 41, 59, 0.8); color: #e2e8f0;">
                            <option value="">TÃ¼m YÄ±llar</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 1.1em;">ğŸ“… Ay</label>
                        <select id="dailySalesMonthFilter" onchange="loadDailySales()"
                                style="width: 100%; padding: 12px; border: 2px solid #10B981; border-radius: 8px; font-size: 1em; background: rgba(30, 41, 59, 0.8); color: #e2e8f0;">
                            <option value="">TÃ¼m Aylar</option>
                            <option value="01">Ocak</option>
                            <option value="02">Åubat</option>
                            <option value="03">Mart</option>
                            <option value="04">Nisan</option>
                            <option value="05">MayÄ±s</option>
                            <option value="06">Haziran</option>
                            <option value="07">Temmuz</option>
                            <option value="08">AÄŸustos</option>
                            <option value="09">EylÃ¼l</option>
                            <option value="10">Ekim</option>
                            <option value="11">KasÄ±m</option>
                            <option value="12">AralÄ±k</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 1.1em;">ğŸ“… GÃ¼n</label>
                        <select id="dailySalesDayFilter" onchange="loadDailySales()"
                                style="width: 100%; padding: 12px; border: 2px solid #10B981; border-radius: 8px; font-size: 1em; background: rgba(30, 41, 59, 0.8); color: #e2e8f0;">
                            <option value="">TÃ¼m GÃ¼nler</option>
                        </select>
                    </div>
                </div>
                
                <!-- DetaylÄ± ÃœrÃ¼n Listesi -->
                <div style="margin-top: 40px;">
                    <h3 style="margin-bottom: 20px;">ğŸ“‹ DetaylÄ± ÃœrÃ¼n Listesi</h3>
                    <div id="dailySalesTableContainer" style="overflow-x: auto;">
                        <p style="text-align: center; color: #6c757d; padding: 40px;">Veriler yÃ¼kleniyor...</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Daily Sales Tab -->

        <!-- Targets Tab -->
        <div id="targetsTab" class="tab-content">
            <div class="content">
                <!-- Filtreler -->
                <div style="background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); padding: 10px 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; max-width: 450px;">
                        <div>
                            <select id="targetFilterYear" class="target-input" onchange="loadAllStoresTargets()" style="width: 100%; padding: 6px 10px; font-size: 0.85em;">
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                            </select>
                        </div>
                        <div>
                            <select id="targetFilterMonth" class="target-input" onchange="loadAllStoresTargets()" style="width: 100%; padding: 6px 10px; font-size: 0.85em;">
                                <option value="">TÃ¼m YÄ±l</option>
                                <option value="01">Ocak</option>
                                <option value="02">Åubat</option>
                                <option value="03">Mart</option>
                                <option value="04">Nisan</option>
                                <option value="05">MayÄ±s</option>
                                <option value="06">Haziran</option>
                                <option value="07">Temmuz</option>
                                <option value="08">AÄŸustos</option>
                                <option value="09">EylÃ¼l</option>
                                <option value="10">Ekim</option>
                                <option value="11">KasÄ±m</option>
                                <option value="12">AralÄ±k</option>
                            </select>
                        </div>
                            </div>
                </div>
                
                <!-- TÃ¼m MaÄŸazalar Hedef Listesi -->
                <div id="allStoresTargetsContainer"></div>
            </div>
        </div>
        <!-- End Targets Tab -->

        <!-- Customers Tab -->
        <div id="customersTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 20px;">ğŸ‘¥ MÃ¼ÅŸteri Analizi</h2>
                
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3>Toplam MÃ¼ÅŸteri</h3>
                        <p id="totalCustomers">0</p>
                    </div>
                    <div class="summary-card">
                        <h3>Aktif MÃ¼ÅŸteri (Son 90 GÃ¼n)</h3>
                        <p id="activeCustomers">0</p>
                    </div>
                    <div class="summary-card">
                        <h3>Ortalama SipariÅŸ</h3>
                        <p id="avgOrderValue">$0</p>
                    </div>
                    <div class="summary-card">
                        <h3>En YÃ¼ksek SipariÅŸ</h3>
                        <p id="maxOrderValue">$0</p>
                    </div>
                </div>
                
                <!-- Customer Search Section -->
                <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); padding: 30px; border-radius: 15px; margin: 30px 0;">
                    <h3 style="color: white; margin: 0 0 20px 0;">ğŸ” MÃ¼ÅŸteri Arama</h3>
                    <div style="display: flex; gap: 10px; max-width: 600px; margin-bottom: 15px;">
                        <div style="position: relative; flex: 1;">
                            <input type="text" id="customerSearchInputMain" placeholder="MÃ¼ÅŸteri adÄ± yazÄ±n... (Ã¶rn: Ahmet YÄ±lmaz)" 
                                   style="width: 100%; padding: 15px 60px 15px 15px; font-size: 1em; border: 2px solid white; border-radius: 10px; outline: none;"
                                   onkeyup="if(event.key==='Enter') searchCustomerProfileMain()">
                            <button onclick="searchCustomerProfileMain()" 
                                    style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: rgba(30, 41, 59, 0.9); color: #10B981; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                ğŸ” Ara
                            </button>
                        </div>
                        <button onclick="clearCustomerSearchMain()" 
                                style="background: rgba(255,255,255,0.2); border: 2px solid white; color: white; padding: 15px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.3s;"
                                onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
                                onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                            ğŸ—‘ï¸ Temizle
                        </button>
                    </div>
                    <!-- Store Filter -->
                    <div style="margin-top: 15px;">
                        <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸª MaÄŸaza (Opsiyonel)</label>
                        <select id="customerStoreFilter" onchange="analyzeCustomers()"
                                style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;">
                            <option value="">TÃ¼m MaÄŸazalar</option>
                        </select>
                    </div>
                    <p style="color: white; opacity: 0.9; margin-top: 10px; font-size: 0.9em;">
                        ğŸ’¡ MÃ¼ÅŸteri adÄ±nÄ±n bir kÄ±smÄ±nÄ± yazmak yeterli
                    </p>
                </div>
                
                <!-- Customer Profile Results (Initially Hidden) -->
                <div id="customerProfileMainContainer" style="display: none; margin-bottom: 40px;">
                    <!-- Customer Profile Header -->
                    <div style="background: linear-gradient(135deg, #38ef7d 0%, #11998e 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.8em;">ğŸ‘¤ <span id="customerNameMain">-</span></h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div>
                                <div style="opacity: 0.8; font-size: 0.85em;">ğŸŒ Åehir</div>
                                <div style="font-size: 1.1em; font-weight: bold;" id="customerCityMain">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.85em;">ğŸ·ï¸ Etiketler</div>
                                <div style="font-size: 0.95em; font-weight: bold;" id="customerTagsMain">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.85em;">ğŸ’° Toplam AlÄ±ÅŸveriÅŸ</div>
                                <div style="font-size: 1.3em; font-weight: bold;" id="customerTotalSalesMain">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.85em;">ğŸ“¦ Toplam Adet</div>
                                <div style="font-size: 1.3em; font-weight: bold;" id="customerTotalQtyMain">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.85em;">ğŸ›’ Ä°ÅŸlem SayÄ±sÄ±</div>
                                <div style="font-size: 1.3em; font-weight: bold;" id="customerTransactionCountMain">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.85em;">ğŸ“Š Ortalama Sepet</div>
                                <div style="font-size: 1.3em; font-weight: bold;" id="customerAvgBasketMain">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.85em;">ğŸ’³ En Ã‡ok Tercih Edilen Kart</div>
                                <div style="font-size: 1.1em; font-weight: bold;" id="customerTopCardFamilyMain">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.85em;">ğŸ“… En Ã‡ok Tercih Edilen Taksit</div>
                                <div style="font-size: 1.1em; font-weight: bold;" id="customerTopInstallmentMain">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Customer Charts -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 15px;">ğŸ·ï¸ En Ã‡ok Tercih EttiÄŸi Markalar</h3>
                            <canvas id="customerBrandChartMain"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 15px;">ğŸ“‚ En Ã‡ok AldÄ±ÄŸÄ± Kategoriler</h3>
                            <canvas id="customerCategoryChartMain"></canvas>
                        </div>
                    </div>
                    
                    <!-- Purchase History -->
                    <div style="margin-top: 30px;">
                        <h3 style="margin-bottom: 15px;">ğŸ›ï¸ Son AlÄ±ÅŸveriÅŸler (Son 20)</h3>
                        <div id="customerPurchaseHistoryMain" style="overflow-x: auto;"></div>
                    </div>
                    
                    <!-- AI Analysis Panel -->
                    <div id="customerAIAnalysisPanelMain" style="margin: 40px 0; display: none;">
                        <h3 style="margin-bottom: 20px;">ğŸ¤– AI MÃ¼ÅŸteri Analizi, Yorum ve Ã–neriler</h3>
                        <div id="customerAIAnalysisContentMain"></div>
                    </div>
                </div>
                
                <div id="topCustomersSection">
                    <h3 style="margin: 30px 0 20px 0;">ğŸ† Top 30 MÃ¼ÅŸteri</h3>
                    <div class="customer-grid" id="topCustomersGrid">
                        <!-- Dinamik olarak doldurulacak -->
                    </div>
                </div>
                
                <!-- RFM Analysis Section -->
                <div id="rfmAnalysisSection" style="margin-top: 40px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <h3 style="color: white; margin: 0 0 10px 0; font-size: 1.5em;">ğŸ“Š RFM Analizi (Recency, Frequency, Monetary)</h3>
                        <p style="color: white; opacity: 0.9; margin: 0; font-size: 0.95em;">
                            MÃ¼ÅŸterilerinizi Recency (Son alÄ±ÅŸveriÅŸ), Frequency (AlÄ±ÅŸveriÅŸ sÄ±klÄ±ÄŸÄ±) ve Monetary (Toplam harcama) kriterlerine gÃ¶re segmentlere ayÄ±rÄ±n.
                        </p>
                    </div>
                    
                    <!-- RFM Segment Chart -->
                    <div class="chart-container" style="margin-bottom: 30px;">
                        <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“ˆ RFM Segment DaÄŸÄ±lÄ±mÄ±</h3>
                        <canvas id="rfmSegmentChart" style="max-height: 400px;"></canvas>
                    </div>
                    
                    <!-- RFM Table -->
                    <div style="margin-top: 30px;">
                        <h3 style="margin-bottom: 20px;">ğŸ“‹ RFM Analizi Detay Tablosu (Top 100)</h3>
                        <div id="rfmTableContainer">
                            <!-- Dinamik olarak doldurulacak -->
                        </div>
                    </div>
                </div>
                
                <!-- Customer Charts -->
                <div id="customerChartsSection" style="margin-top: 30px;">
                    <!-- AylÄ±k MÃ¼ÅŸteri Trendi - Tam GeniÅŸlik -->
                    <div class="chart-container" style="margin-bottom: 30px;">
                        <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“Š AylÄ±k MÃ¼ÅŸteri Trendi</h3>
                        <canvas id="customerTrendChart" style="max-height: 400px;"></canvas>
                    </div>
                    
                    <!-- MÃ¼ÅŸteri DaÄŸÄ±lÄ±mÄ± (Åehir) - Alt kÄ±sÄ±mda -->
                    <div class="chart-container" style="max-width: 800px; margin: 0 auto; background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="text-align: center; margin-bottom: 25px; color: #e2e8f0; font-size: 1.3em; font-weight: 600; text-shadow: 0 2px 8px rgba(0,0,0,0.2);">ğŸŒ MÃ¼ÅŸteri DaÄŸÄ±lÄ±mÄ± (Åehir)</h3>
                        <div id="customerCityList" class="store-list-progress" style="max-height: 500px; overflow-y: auto;">
                            <!-- Dinamik olarak doldurulacak -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Customers Tab -->

        <!-- Time Analysis Tab -->
        <div id="timeTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 20px;">â° Zaman Analizi</h2>
                
                <!-- Filters -->
                <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: white; font-weight: 600;">ğŸ“ Kategori</label>
                            <select id="timeCategory1Filter" onchange="analyzeTime()" style="width: 100%; padding: 10px; border: none; border-radius: 8px; font-size: 1em;">
                                <option value="">TÃ¼m Kategoriler</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: end;">
                            <button onclick="clearTimeFilters()" style="width: 100%; padding: 10px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1em;">
                                ğŸ”„ Temizle
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Time Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3>En YoÄŸun Saat</h3>
                        <p id="peakHour">-</p>
                    </div>
                    <div class="summary-card">
                        <h3>En YoÄŸun GÃ¼n</h3>
                        <p id="peakDay">-</p>
                    </div>
                    <div class="summary-card">
                        <h3>Mesai Saati SatÄ±ÅŸ</h3>
                        <p id="workHoursSales">-</p>
                    </div>
                    <div class="summary-card">
                        <h3>Hafta Sonu SatÄ±ÅŸ</h3>
                        <p id="weekendSales">-</p>
                    </div>
                </div>
                
                <!-- AI Time Insights -->
                <div id="timeInsightsPanel" style="display: none;"></div>
                
                <!-- Hourly Chart -->
                <div class="chart-container" style="margin: 30px 0;">
                    <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“Š Saatlik YoÄŸunluk (24 Saat)</h3>
                    <canvas id="hourlyChart"></canvas>
                </div>
                
                <!-- Monthly Trend -->
                <div class="chart-container" style="margin: 30px 0;">
                    <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“… AylÄ±k Trend</h3>
                    <canvas id="monthlyTrendChart"></canvas>
                </div>
                
                <!-- Yearly Trend -->
                <div class="chart-container" style="margin: 30px 0;">
                    <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“Š YÄ±llÄ±k Trend</h3>
                    <canvas id="yearlyTrendChart"></canvas>
                </div>
                
                <!-- Store Time Comparison -->
                <div style="margin: 30px 0;">
                    <h3 style="text-align: center; margin-bottom: 20px;">ğŸª MaÄŸaza BazÄ±nda Saat KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3>
                    <div style="margin-bottom: 20px; text-align: center;">
                        <label>MaÄŸaza SeÃ§: </label>
                        <select id="storeTimeFilter" onchange="renderStoreTimeChart()" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">TÃ¼m MaÄŸazalar</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="storeTimeChart"></canvas>
                    </div>
                </div>
                
                <!-- Category Time Analysis -->
                <div style="margin: 30px 0;">
                    <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“¦ Kategori BazÄ±nda Saat Analizi</h3>
                    <div style="margin-bottom: 20px; text-align: center;">
                        <label>Kategori SeÃ§: </label>
                        <select id="categoryTimeFilter" onchange="renderCategoryTimeChart()" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">TÃ¼m Kategoriler</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="categoryTimeChart"></canvas>
                    </div>
                </div>
                
                <!-- Sales Person Time Analysis -->
                <div style="margin: 30px 0;">
                    <h3 style="text-align: center; margin-bottom: 20px;">ğŸ‘¤ SatÄ±ÅŸ Temsilcisi BazÄ±nda Saat Analizi</h3>
                    <div style="margin-bottom: 20px; text-align: center;">
                        <label>Temsilci SeÃ§: </label>
                        <select id="salesPersonTimeFilter" onchange="renderSalesPersonTimeChart()" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                            <option value="">TÃ¼m Temsilciler</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="salesPersonTimeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Time Analysis Tab -->

        <!-- Product Analysis Tab -->
        <div id="productTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 20px;">ğŸ¸ ÃœrÃ¼n, Marka ve Kategori Analizi</h2>
                
                <!-- Search Section -->
                <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: white; margin-bottom: 20px; text-align: center;">ğŸ” ÃœrÃ¼n, Marka veya Kategori Ara</h3>
                    
                    <!-- Filters Grid -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1000px; margin: 0 auto 20px;">
                        <!-- Search Input -->
                        <div style="grid-column: 1 / -1;">
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ” ÃœrÃ¼n/Marka Ara</label>
                            <div style="display: flex; gap: 10px;">
                        <input type="text" id="productSearchInput" placeholder="Ã–rnek: KDP120R, Roland, Fender..." 
                                       style="flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 1em;"
                               onkeypress="if(event.key==='Enter') searchProduct()">
                        <button onclick="searchProduct()" 
                                        style="padding: 12px 30px; background: #38ef7d; color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer;">
                            ğŸ” Ara
                        </button>
                    </div>
                        </div>
                        
                        <!-- Category Search -->
                        <div style="position: relative;">
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“ Kategori Ara</label>
                            <input type="text" id="productCategorySearch" placeholder="Kategori adÄ± yazÄ±n..." 
                                   style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;"
                                   oninput="filterProductCategories()"
                                   onfocus="showProductCategoryDropdown()"
                                   onblur="setTimeout(() => hideProductCategoryDropdown(), 200)">
                            <div id="productCategoryDropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border-radius: 8px; max-height: 300px; overflow-y: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; margin-top: 5px;">
                            </div>
                        </div>
                        
                        <!-- Store Filter -->
                        <div style="margin-bottom: 15px;">
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸª MaÄŸaza (Opsiyonel)</label>
                            <select id="productStoreFilter" 
                                    style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;">
                                <option value="">TÃ¼m MaÄŸazalar</option>
                            </select>
                        </div>
                        
                        <!-- Date Range Filters -->
                        <div style="display: flex; gap: 10px; align-items: end;">
                            <div style="flex: 1;">
                                <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“… BaÅŸlangÄ±Ã§ Tarihi</label>
                                <input type="date" id="productDateStart" 
                                       style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;">
                            </div>
                            <div style="flex: 1;">
                                <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“… BitiÅŸ Tarihi</label>
                                <input type="date" id="productDateEnd" 
                                       style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;">
                            </div>
                            <div>
                                <button onclick="clearProductDateFilters()" 
                                        style="padding: 12px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; cursor: pointer; font-size: 1em; white-space: nowrap;">
                                    ğŸ”„ Temizle
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <p style="text-align: center; margin-top: 15px; color: white; font-size: 0.95em; opacity: 0.9;">
                        ğŸ’¡ <strong>Ä°pucu:</strong> Tarih aralÄ±ÄŸÄ± seÃ§mek zorunlu deÄŸil, istenirse tÃ¼m dÃ¶nem veya belirli tarih aralÄ±ÄŸÄ± iÃ§in analiz yapabilirsiniz
                    </p>
                </div>
                
                <!-- Results Section -->
                <div id="productResultsContainer" style="display: none;">
                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="summary-card">
                            <h3>Toplam SatÄ±ÅŸ (KDV HariÃ§)</h3>
                            <p id="productTotalSales">$0</p>
                        </div>
                        <div class="summary-card">
                            <h3>Toplam Adet</h3>
                            <p id="productTotalQty">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>FarklÄ± ÃœrÃ¼n</h3>
                            <p id="productUniqueCount">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>Sepet OrtalamasÄ±</h3>
                            <p id="productAvgPrice">$0</p>
                        </div>
                    </div>
                    
                    <!-- Charts Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px;">
                        <!-- Top Stores -->
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸª En Ã‡ok Satan MaÄŸazalar</h3>
                            <canvas id="productStoreChart"></canvas>
                        </div>
                        
                        <!-- Top Cities -->
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸŒ En Ã‡ok SatÄ±lan Ä°ller</h3>
                            <canvas id="productCityChart"></canvas>
                        </div>
                        
                        <!-- Top Districts -->
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“ En Ã‡ok SatÄ±lan Ä°lÃ§eler</h3>
                            <canvas id="productDistrictChart"></canvas>
                        </div>
                        
                        <!-- Top Sales Persons -->
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ‘¤ En Ã‡ok Satan Temsilciler</h3>
                            <canvas id="productSalesPersonChart"></canvas>
                        </div>
                        
                        <!-- Monthly Trend - GeniÅŸletilmiÅŸ -->
                        <div class="chart-container" style="grid-column: span 2; height: 500px;">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“ˆ AylÄ±k SatÄ±ÅŸ Trendi</h3>
                            <canvas id="productMonthlyChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- AI Analysis Panel -->
                    <div id="productAIAnalysisPanel" style="margin: 40px 0; display: none;">
                        <h3 style="margin-bottom: 20px;">ğŸ¤– AI Analiz, Yorum ve Ã–neriler</h3>
                        <div id="productAIAnalysisContent"></div>
                    </div>
                    
                    <!-- Detailed Products Table -->
                    <div style="margin-top: 40px;">
                        <h3 style="margin-bottom: 20px;">ğŸ“‹ DetaylÄ± ÃœrÃ¼n Listesi</h3>
                        <div id="productDetailTable" style="overflow-x: auto;"></div>
                    </div>
                </div>
                
                <!-- No Results Message -->
                <div id="productNoResults" style="display: none; text-align: center; padding: 60px; background: #f8f9fa; border-radius: 15px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">ğŸ”</div>
                    <h3 style="color: #6c757d; margin-bottom: 10px;">SonuÃ§ BulunamadÄ±</h3>
                    <p style="color: #adb5bd;">LÃ¼tfen farklÄ± bir Ã¼rÃ¼n veya marka adÄ± deneyin</p>
                </div>
            </div>
        </div>
        <!-- End Product Analysis Tab -->

        <!-- Customer Search Tab -->
        <div id="customerSearchTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 30px;">ğŸ” MÃ¼ÅŸteri Arama ve Analizi</h2>
                
                <!-- Search Input -->
                <div style="max-width: 800px; margin: 0 auto 40px;">
                    <div style="position: relative;">
                        <input type="text" id="customerSearchInput" placeholder="MÃ¼ÅŸteri adÄ± yazÄ±n veya virgÃ¼lle ayÄ±rarak Ã§oklu arama yapÄ±n..." 
                               style="width: 100%; padding: 20px 60px 20px 20px; font-size: 1.1em; border: 2px solid #10B981; border-radius: 15px; outline: none; background: rgba(30, 41, 59, 0.8); color: #e2e8f0;"
                               oninput="showCustomerSuggestions(this.value)"
                               onkeydown="handleCustomerKeydown(event)"
                               onfocus="showCustomerSuggestions(this.value)">
                        <button onclick="searchCustomerProfile()" 
                                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-size: 1em;">
                            ğŸ” Ara
                        </button>
                        <div id="customerSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(20px); border: 2px solid #10B981; border-top: none; border-radius: 0 0 15px 15px; max-height: 300px; overflow-y: auto; display: none; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.3); color: #e2e8f0;"></div>
                    </div>
                    
                    <!-- Selected Customers Tags -->
                    <div id="selectedCustomersContainer" style="display: none; margin-top: 15px;">
                        <div style="background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); padding: 15px; border-radius: 10px; border: 2px dashed #10B981;">
                            <div style="font-weight: 600; color: #10B981; margin-bottom: 10px;">âœ… SeÃ§ili MÃ¼ÅŸteriler (En fazla 3):</div>
                            <div id="selectedCustomersTags" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
                        </div>
                    </div>
                    
                    <p style="text-align: center; color: #94a3b8; margin-top: 10px; font-size: 0.9em;">
                        ğŸ’¡ Ä°pucu: Listeden tÄ±klayarak veya virgÃ¼l ile ayÄ±rarak birden fazla mÃ¼ÅŸteri seÃ§ebilir, karÅŸÄ±laÅŸtÄ±rabilirsiniz
                    </p>
                </div>
                
                <!-- Results Container -->
                <div id="customerProfileContainer" style="display: none;">
                    <!-- Customer Profile Header -->
                    <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); color: white; padding: 40px; border-radius: 20px; margin-bottom: 30px;">
                        <h2 style="margin: 0 0 20px 0; font-size: 2em;">ğŸ‘¤ <span id="customerName">-</span></h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸŒ Åehir</div>
                                <div style="font-size: 1.3em; font-weight: bold;" id="customerCity">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ·ï¸ Etiketler</div>
                                <div style="font-size: 1.1em; font-weight: bold;" id="customerTags">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ’° Toplam AlÄ±ÅŸveriÅŸ</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="customerTotalSales">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“¦ Toplam Adet</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="customerTotalQty">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ›’ Ä°ÅŸlem SayÄ±sÄ±</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="customerTransactionCount">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“Š Ortalama Sepet</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="customerAvgBasket">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“… Ä°lk AlÄ±ÅŸveriÅŸ</div>
                                <div style="font-size: 1.1em; font-weight: bold;" id="customerFirstPurchase">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“… Son AlÄ±ÅŸveriÅŸ</div>
                                <div style="font-size: 1.1em; font-weight: bold;" id="customerLastPurchase">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; margin-bottom: 30px;">
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ·ï¸ En Ã‡ok Tercih EttiÄŸi Markalar</h3>
                            <canvas id="customerBrandChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“‚ En Ã‡ok AldÄ±ÄŸÄ± Kategoriler</h3>
                            <canvas id="customerCategoryChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸª AlÄ±ÅŸveriÅŸ YaptÄ±ÄŸÄ± MaÄŸazalar</h3>
                            <canvas id="customerStoreChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“ˆ AylÄ±k AlÄ±ÅŸveriÅŸ Trendi</h3>
                            <canvas id="customerMonthlyTrendChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- AI Customer Analysis -->
                    <div id="customerAIAnalysisPanel" style="margin: 40px 0;">
                        <h3 style="margin-bottom: 20px;">ğŸ¤– AI MÃ¼ÅŸteri Analizi ve Ã–neriler</h3>
                        <div id="customerAIAnalysisContent"></div>
                    </div>
                    
                    <!-- Purchase History Table -->
                    <div style="margin-top: 40px;">
                        <h3 style="margin-bottom: 20px;">ğŸ›ï¸ SatÄ±n Alma GeÃ§miÅŸi</h3>
                        <div id="customerPurchaseHistory" style="overflow-x: auto;"></div>
                    </div>
                </div>
                
                <!-- No Results Message -->
                <div id="customerSearchNoResults" style="display: none; text-align: center; padding: 60px; background: #f8f9fa; border-radius: 15px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">ğŸ”</div>
                    <h3 style="color: #6c757d; margin-bottom: 10px;">MÃ¼ÅŸteri BulunamadÄ±</h3>
                    <p style="color: #adb5bd;">LÃ¼tfen farklÄ± bir mÃ¼ÅŸteri adÄ± deneyin</p>
                </div>
            </div>
        </div>
        <!-- End Customer Search Tab -->

        <!-- Inventory Analysis Tab -->
        <div id="inventoryTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 30px; text-align: center;">ğŸ“Š Envanter + SatÄ±ÅŸ Analizi</h2>
                
                <!-- Filters Section - ÃœrÃ¼n Analizi ile aynÄ± yapÄ± -->
                <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: white; margin-bottom: 20px; text-align: center;">ğŸ” ÃœrÃ¼n, Marka veya Kategori Ara</h3>
                    
                    <!-- Filters Grid -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1000px; margin: 0 auto 20px;">
                        <!-- Search Input -->
                        <div style="grid-column: 1 / -1;">
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ” ÃœrÃ¼n/Marka Ara</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="inventoryProductSearchInput" placeholder="Ã–rnek: KDP120R, Roland, Fender..." 
                                       style="flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 1em;"
                                       onkeypress="if(event.key==='Enter') performInventoryAnalysis()">
                                <button onclick="performInventoryAnalysis()" 
                                        style="padding: 12px 30px; background: #38ef7d; color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer;">
                                    ğŸ” Ara
                                </button>
                            </div>
                        </div>
                        
                        <!-- Category Search -->
                        <div style="position: relative;">
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“ Kategori Ara</label>
                            <input type="text" id="inventoryCategorySearch" placeholder="Kategori adÄ± yazÄ±n..." 
                                   style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;"
                                   oninput="filterInventoryCategories()"
                                   onfocus="showInventoryCategoryDropdown()"
                                   onblur="setTimeout(() => hideInventoryCategoryDropdown(), 200)">
                            <div id="inventoryCategoryDropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border-radius: 8px; max-height: 300px; overflow-y: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; margin-top: 5px;">
                            </div>
                        </div>
                        
                        <!-- Store Filter -->
                        <div style="margin-bottom: 15px;">
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸª MaÄŸaza (Opsiyonel)</label>
                            <select id="inventoryStoreFilter" 
                                    style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;">
                                <option value="">TÃ¼m MaÄŸazalar</option>
                            </select>
                        </div>
                        
                        <!-- Date Range Filters -->
                        <div style="display: flex; gap: 10px; align-items: end;">
                            <div style="flex: 1;">
                                <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“… BaÅŸlangÄ±Ã§ Tarihi</label>
                                <input type="date" id="inventoryDateStart" 
                                       style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;">
                            </div>
                            <div style="flex: 1;">
                                <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“… BitiÅŸ Tarihi</label>
                                <input type="date" id="inventoryDateEnd" 
                                       style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;">
                            </div>
                            <div>
                                <button onclick="clearInventoryDateFilters()" 
                                        style="padding: 12px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; cursor: pointer; font-size: 1em; white-space: nowrap;">
                                    ğŸ”„ Temizle
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <p style="text-align: center; margin-top: 15px; color: white; font-size: 0.95em; opacity: 0.9;">
                        ğŸ’¡ <strong>Ä°pucu:</strong> Filtreleri seÃ§tikten sonra analiz otomatik olarak Ã§alÄ±ÅŸacak. product_id ile envanter ve satÄ±ÅŸ verileri eÅŸleÅŸtirilecek.
                    </p>
                </div>
                
                <!-- Analysis Type Selection -->
                <div style="margin-top: 20px; text-align: center; margin-bottom: 30px;">
                    <label style="font-weight: bold; margin-right: 15px;">Analiz TÃ¼rÃ¼:</label>
                    <select id="inventoryAnalysisType" onchange="switchInventoryAnalysis()" style="padding: 10px 15px; border: 2px solid #10B981; border-radius: 8px; font-size: 1em; background: rgba(30, 41, 59, 0.8); color: #e2e8f0;">
                        <option value="stock">ğŸ“¦ Stok vs SatÄ±ÅŸ Analizi</option>
                        <option value="price">ğŸ’° Fiyat Analizi</option>
                        <option value="performance">ğŸ¯ Performans Metrikleri</option>
                        <option value="trends">ğŸ“ˆ Trend Analizi</option>
                        <option value="alerts">ğŸš¨ UyarÄ± Sistemi</option>
                    </select>
                </div>

                <!-- Results Container -->
                <div id="inventoryResultsContainer" style="display: none;">
                    <!-- Price Analysis -->
                    <div id="priceAnalysisView" style="display: none;">
                        <h3 style="text-align: center; margin-bottom: 30px;">ğŸ’° Fiyat Analizi</h3>
                        
                        <!-- Summary Cards -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="avgDiscountRate">0%</div>
                                <div style="opacity: 0.9;">Ortalama Ä°ndirim OranÄ±</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="priceVariance">$0</div>
                                <div style="opacity: 0.9;">Fiyat VaryansÄ±</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="totalPriceDiff">$0</div>
                                <div style="opacity: 0.9;">Toplam Fiyat FarkÄ±</div>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 30px; margin-bottom: 30px;">
                            <div class="chart-container">
                                <h4 style="text-align: center; margin-bottom: 20px;">ğŸ“Š Liste vs SatÄ±ÅŸ FiyatÄ± KarÅŸÄ±laÅŸtÄ±rmasÄ±</h4>
                                <canvas id="priceComparisonChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4 style="text-align: center; margin-bottom: 20px;">ğŸ“ˆ Ä°ndirim OranlarÄ± DaÄŸÄ±lÄ±mÄ±</h4>
                                <canvas id="discountDistributionChart"></canvas>
                            </div>
                        </div>

                        <!-- Price Analysis Table -->
                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <h4 style="margin-bottom: 20px;">ğŸ“‹ DetaylÄ± Fiyat Analizi</h4>
                            <div id="priceAnalysisTable" style="overflow-x: auto;"></div>
                        </div>
                    </div>

                    <!-- Stock vs Sales Analysis -->
                    <div id="stockAnalysisView" style="display: none;">
                        <h3 style="text-align: center; margin-bottom: 30px;">ğŸ“¦ Stok vs SatÄ±ÅŸ Analizi</h3>
                        
                        <!-- Summary Cards -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="avgStockTurnover">0 adet</div>
                                <div style="opacity: 0.9;">SatÄ±lan Stok (Toplam)</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="overstockCount">0 Ã¼rÃ¼n</div>
                                <div style="opacity: 0.9;">Analiz Edilen ÃœrÃ¼n</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="understockCount">0 adet</div>
                                <div style="opacity: 0.9;">Verilen SipariÅŸ (Toplam)</div>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 30px; margin-bottom: 30px;">
                            <div class="chart-container">
                                <h4 style="text-align: center; margin-bottom: 20px;">ğŸ“Š Stok Devir HÄ±zÄ± DaÄŸÄ±lÄ±mÄ±</h4>
                                <canvas id="stockTurnoverChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4 style="text-align: center; margin-bottom: 20px;">ğŸ¯ Stok vs SatÄ±ÅŸ Scatter Plot</h4>
                                <canvas id="stockSalesScatterChart"></canvas>
                            </div>
                        </div>

                        <!-- Stock Analysis Table -->
                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <h4 style="margin-bottom: 20px;">ğŸ“‹ Stok Analizi DetaylarÄ±</h4>
                            <div id="stockAnalysisTable" style="overflow-x: auto;"></div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div id="performanceView" style="display: none;">
                        <h3 style="text-align: center; margin-bottom: 30px;">ğŸ¯ Performans Metrikleri</h3>
                        
                        <!-- Summary Cards -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="avgProfitability">0%</div>
                                <div style="opacity: 0.9;">Ortalama KarlÄ±lÄ±k</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="avgEfficiency">0%</div>
                                <div style="opacity: 0.9;">Stok VerimliliÄŸi</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="avgReservation">0%</div>
                                <div style="opacity: 0.9;">Rezervasyon OranÄ±</div>
                            </div>
                        </div>

                        <!-- Performance Charts -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 30px; margin-bottom: 30px;">
                            <div class="chart-container">
                                <h4 style="text-align: center; margin-bottom: 20px;">ğŸ“Š KarlÄ±lÄ±k DaÄŸÄ±lÄ±mÄ±</h4>
                                <canvas id="profitabilityChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4 style="text-align: center; margin-bottom: 20px;">ğŸ¯ Verimlilik vs KarlÄ±lÄ±k</h4>
                                <canvas id="efficiencyProfitabilityChart"></canvas>
                            </div>
                        </div>

                        <!-- Performance Table -->
                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <h4 style="margin-bottom: 20px;">ğŸ“‹ Performans Metrikleri DetaylarÄ±</h4>
                            <div id="performanceTable" style="overflow-x: auto;"></div>
                        </div>
                    </div>

                    <!-- Trend Analysis -->
                    <div id="trendsView" style="display: none;">
                        <h3 style="text-align: center; margin-bottom: 30px;">ğŸ“ˆ Trend Analizi</h3>
                        
                        <!-- Summary Cards -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="trendingProducts">0</div>
                                <div style="opacity: 0.9;">Trend ÃœrÃ¼nler</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="decliningProducts">0</div>
                                <div style="opacity: 0.9;">DÃ¼ÅŸen ÃœrÃ¼nler</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="stableProducts">0</div>
                                <div style="opacity: 0.9;">Stabil ÃœrÃ¼nler</div>
                            </div>
                        </div>

                        <!-- Trend Charts -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 30px; margin-bottom: 30px;">
                            <div class="chart-container">
                                <h4 style="text-align: center; margin-bottom: 20px;">ğŸ“ˆ AylÄ±k Stok vs SatÄ±ÅŸ Trendi</h4>
                                <canvas id="monthlyTrendChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4 style="text-align: center; margin-bottom: 20px;">ğŸ¯ ÃœrÃ¼n Kategorisi Trendleri</h4>
                                <canvas id="categoryTrendChart"></canvas>
                            </div>
                        </div>

                        <!-- Trend Table -->
                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <h4 style="margin-bottom: 20px;">ğŸ“‹ Trend Analizi DetaylarÄ±</h4>
                            <div id="trendTable" style="overflow-x: auto;"></div>
                        </div>
                    </div>

                    <!-- Alert System -->
                    <div id="alertsView" style="display: none;">
                        <h3 style="text-align: center; margin-bottom: 30px;">ğŸš¨ UyarÄ± Sistemi</h3>
                        
                        <!-- Alert Summary -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="criticalAlerts">0</div>
                                <div style="opacity: 0.9;">Kritik UyarÄ±lar</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="warningAlerts">0</div>
                                <div style="opacity: 0.9;">UyarÄ±lar</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #48dbfb 0%, #0abde3 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;" id="infoAlerts">0</div>
                                <div style="opacity: 0.9;">Bilgi UyarÄ±larÄ±</div>
                            </div>
                        </div>

                        <!-- Alert Categories -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; margin-bottom: 30px;">
                            <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <h4 style="color: #ff6b6b; margin-bottom: 15px;">ğŸ”´ Stok TÃ¼kenme Riski</h4>
                                <div id="stockoutAlerts"></div>
                            </div>
                            <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <h4 style="color: #feca57; margin-bottom: 15px;">ğŸŸ¡ AÅŸÄ±rÄ± Stok UyarÄ±sÄ±</h4>
                                <div id="overstockAlerts"></div>
                            </div>
                            <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <h4 style="color: #ff9ff3; margin-bottom: 15px;">ğŸŸ£ Fiyat TutarsÄ±zlÄ±ÄŸÄ±</h4>
                                <div id="priceAlerts"></div>
                            </div>
                        </div>

                        <!-- Alert Table -->
                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <h4 style="margin-bottom: 20px;">ğŸ“‹ TÃ¼m UyarÄ±lar</h4>
                            <div id="allAlertsTable" style="overflow-x: auto;"></div>
                        </div>
                    </div>
                </div>

                <!-- No Results Message -->
                <div id="inventoryNoResults" style="display: none; text-align: center; padding: 60px 20px; background: #f8f9fa; border-radius: 15px; margin-top: 30px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">ğŸ“Š</div>
                    <h3 style="color: #6c757d; margin-bottom: 15px;">Analiz YapÄ±lacak Veri BulunamadÄ±</h3>
                    <p style="color: #6c757d;">LÃ¼tfen farklÄ± filtreler deneyin veya veri yÃ¼klenmesini bekleyin.</p>
                </div>
            </div>
        </div>
        <!-- End Inventory Analysis Tab -->

        <!-- Payment Analysis Tab -->
        <div id="paymentsTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 30px; text-align: center;">ğŸ’³ Ã–deme Analizi</h2>
                
                <!-- Filters Section -->
                <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: white; margin-bottom: 20px; text-align: center;">ğŸ” Filtreler</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 1000px; margin: 0 auto 20px;">
                        <div>
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">âœ… Durum</label>
                            <select id="paymentStateFilter" 
                                    style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;"
                                    onchange="analyzePayments()">
                                <option value="done" selected>Done (TamamlanmÄ±ÅŸ)</option>
                                <option value="">TÃ¼m Durumlar</option>
                            </select>
                        </div>
                        <div>
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“… BaÅŸlangÄ±Ã§ Tarihi</label>
                            <input type="date" id="paymentDateStart" 
                                   style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;"
                                   onchange="analyzePayments()">
                        </div>
                        <div>
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“… BitiÅŸ Tarihi</label>
                            <input type="date" id="paymentDateEnd" 
                                   style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;"
                                   onchange="analyzePayments()">
                        </div>
                        <div>
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ’° Min Tutar</label>
                            <input type="number" id="paymentMinAmount" placeholder="0" 
                                   style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;"
                                   onchange="analyzePayments()">
                        </div>
                        <div>
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ’° Max Tutar</label>
                            <input type="number" id="paymentMaxAmount" placeholder="âˆ" 
                                   style="width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1em;"
                                   onchange="analyzePayments()">
                        </div>
                        <div style="display: flex; align-items: end;">
                            <button onclick="clearPaymentFilters()" 
                                    style="width: 100%; padding: 12px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; cursor: pointer; font-size: 1em; white-space: nowrap;">
                                ğŸ”„ Temizle
                            </button>
                        </div>
                    </div>
                    
                    <p style="text-align: center; margin-top: 15px; color: white; font-size: 0.95em; opacity: 0.9;">
                        ğŸ’¡ <strong>Ä°pucu:</strong> Filtreleri seÃ§tikten sonra analiz otomatik olarak Ã§alÄ±ÅŸacak.
                    </p>
                </div>

                <!-- Summary Cards -->
                <div id="paymentSummaryCards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="summary-card">
                        <h3>ğŸ’° Toplam Ã–deme</h3>
                        <p id="paymentTotalAmount">$0</p>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ“Š Toplam Ä°ÅŸlem</h3>
                        <p id="paymentTotalCount">0</p>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ“ˆ Ortalama Tutar</h3>
                        <p id="paymentAvgAmount">$0</p>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ‘¥ FarklÄ± MÃ¼ÅŸteri</h3>
                        <p id="paymentUniqueCustomers">0</p>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ›’ FarklÄ± PoS SipariÅŸi</h3>
                        <p id="paymentUniquePosOrders">0</p>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ’³ En Ã‡ok KullanÄ±lan Kart ProgramÄ±</h3>
                        <p id="paymentTopCardFamily">-</p>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ“… En Ã‡ok KullanÄ±lan Taksit</h3>
                        <p id="paymentTopInstallment">-</p>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ¦ En Ã‡ok KullanÄ±lan Sanal Pos</h3>
                        <p id="paymentTopVpos">-</p>
                    </div>
                </div>

                <!-- AI Analysis Section -->
                <div id="paymentAIAnalysis" style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); border-radius: 15px; padding: 30px; margin-bottom: 30px; display: none;">
                    <h3 style="color: white; margin-bottom: 20px; text-align: center;">ğŸ¤– AI Ã–deme Analizi</h3>
                    <div id="paymentAIResults" style="background: rgba(255,255,255,0.95); border-radius: 10px; padding: 20px; color: #333;">
                        <p style="text-align: center; color: #6c757d;">Veri yÃ¼klendikten sonra AI analiz sonuÃ§larÄ± burada gÃ¶rÃ¼necek...</p>
                    </div>
                </div>

                <!-- Results Container -->
                <div id="paymentResultsContainer" style="display: none;">
                    <!-- Table -->
                    <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px;">ğŸ“‹ Ã–deme Ä°ÅŸlemleri</h3>
                        <div id="paymentTable" style="overflow-x: auto;"></div>
                    </div>
                </div>

                <!-- No Results -->
                <div id="paymentNoResults" style="display: none; text-align: center; padding: 60px 20px; background: #f8f9fa; border-radius: 15px; margin-top: 30px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">ğŸ’³</div>
                    <h3 style="color: #6c757d; margin-bottom: 15px;">Ã–deme Verisi BulunamadÄ±</h3>
                    <p style="color: #6c757d;">LÃ¼tfen farklÄ± filtreler deneyin veya veri yÃ¼klenmesini bekleyin.</p>
                </div>
            </div>
        </div>
        <!-- End Payment Analysis Tab -->

        <!-- Salesperson Analysis Tab -->
        <div id="salespersonTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 30px;">ğŸ‘¨â€ğŸ’¼ SatÄ±ÅŸ Temsilcisi Performans Analizi</h2>
                
                <!-- Filters Section (Dropdown yapÄ±sÄ±) -->
                <div class="filters-section" style="margin-bottom: 30px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 800px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">YÄ±l</label>
                            <select id="filterSalespersonYearSelect" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                                <option value="">TÃ¼m YÄ±llar</option>
                            </select>
                            </div>
                        <div style="display: flex; gap: 20px;">
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Ay (Opsiyonel)</label>
                                <select id="filterSalespersonMonthSelect" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                                    <option value="">TÃ¼m YÄ±l</option>
                                    <option value="01">Ocak</option>
                                    <option value="02">Åubat</option>
                                    <option value="03">Mart</option>
                                    <option value="04">Nisan</option>
                                    <option value="05">MayÄ±s</option>
                                    <option value="06">Haziran</option>
                                    <option value="07">Temmuz</option>
                                    <option value="08">AÄŸustos</option>
                                    <option value="09">EylÃ¼l</option>
                                    <option value="10">Ekim</option>
                                    <option value="11">KasÄ±m</option>
                                    <option value="12">AralÄ±k</option>
                                </select>
                        </div>
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">GÃ¼n (Opsiyonel)</label>
                                <select id="filterSalespersonDaySelect" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                                    <option value="">TÃ¼m GÃ¼nler</option>
                                    <option value="01">01</option>
                                    <option value="02">02</option>
                                    <option value="03">03</option>
                                    <option value="04">04</option>
                                    <option value="05">05</option>
                                    <option value="06">06</option>
                                    <option value="07">07</option>
                                    <option value="08">08</option>
                                    <option value="09">09</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                    <option value="21">21</option>
                                    <option value="22">22</option>
                                    <option value="23">23</option>
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                    <option value="31">31</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button id="clearSalespersonFiltersBtn" 
                                style="background: #6c757d; color: white; border: none; padding: 12px 30px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            ğŸ”„ Filtreleri Temizle
                        </button>
                    </div>
                </div>
                
                <!-- Search Input with Multi-Select -->
                <div style="max-width: 800px; margin: 0 auto 40px;">
                    <!-- Selected Salespersons Tags -->
                    <div id="selectedSalespersonsContainer" style="display: none; margin-bottom: 15px; padding: 15px; background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <span style="font-weight: 600; color: #10B981;">SeÃ§ili Temsilciler:</span>
                            <div id="selectedSalespersonsTags" style="display: flex; gap: 8px; flex-wrap: wrap;"></div>
                        </div>
                    </div>
                    
                    <div style="position: relative;">
                        <input type="text" id="salespersonSearchInput" placeholder="SatÄ±ÅŸ temsilcisi adÄ± yazÄ±n... (Ã¶rn: Mustafa KÄ±lÄ±Ã§, Kaan Poyraz)" 
                               style="width: 100%; padding: 20px 60px 20px 20px; font-size: 1.1em; border: 2px solid #10B981; border-radius: 15px; outline: none; background: rgba(30, 41, 59, 0.8); color: #e2e8f0;"
                               oninput="showSalespersonSuggestions(this.value)"
                               onkeydown="handleSalespersonKeydown(event)"
                               onfocus="showSalespersonSuggestions(this.value)">
                        <button onclick="searchSalespersonProfile()" 
                                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-size: 1em;">
                            ğŸ” Ara
                        </button>
                        <div id="salespersonSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(20px); border: 2px solid #10B981; border-top: none; border-radius: 0 0 15px 15px; max-height: 300px; overflow-y: auto; display: none; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.3); color: #e2e8f0;"></div>
                    </div>
                    <p style="text-align: center; color: #94a3b8; margin-top: 10px; font-size: 0.9em;">
                        ğŸ’¡ Ä°pucu: Birden fazla temsilci seÃ§erek karÅŸÄ±laÅŸtÄ±rmalÄ± analiz yapabilirsiniz! (En fazla 3 temsilci)
                    </p>
                </div>
                
                <!-- Top 50 Salespersons List (Default View - Arama yoksa burada gÃ¶sterilir) -->
                <div id="salespersonListSectionDefault" style="margin: 40px 0; display: block;">
                    <h3 style="margin-bottom: 20px; color: #e2e8f0;">ğŸ‘¥ TÃ¼m SatÄ±ÅŸ Temsilcileri DetaylÄ± Performans Listesi (Top 50)</h3>
                    <div id="salespersonListTableDefault" style="overflow-x: auto;"></div>
                </div>
                
                <!-- Results Container -->
                <div id="salespersonProfileContainer" style="display: none;">
                    <!-- Single Salesperson View -->
                    <div id="singleSalespersonView" style="display: none;">
                    <!-- Salesperson Profile Header -->
                    <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); color: white; padding: 40px; border-radius: 20px; margin-bottom: 30px;">
                        <h2 style="margin: 0 0 20px 0; font-size: 2em;">ğŸ‘¨â€ğŸ’¼ <span id="salespersonName">-</span></h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ’° Toplam SatÄ±ÅŸ (KDV HariÃ§)</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="salespersonTotalSales">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“¦ Toplam Adet</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="salespersonTotalQty">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ›’ Fatura SayÄ±sÄ±</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="salespersonInvoiceCount">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“Š GÃ¼nlÃ¼k Ort. SatÄ±ÅŸ</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="salespersonAvgTransaction">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ›’ Sepet OrtalamasÄ±</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="salespersonAvgBasket">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ‘¥ FarklÄ± MÃ¼ÅŸteri</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="salespersonUniqueCustomers">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ¯ FarklÄ± ÃœrÃ¼n</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="salespersonUniqueProducts">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Multiple Salespersons Comparison View -->
                    <div id="multipleSalespersonsView" style="display: none;">
                        <h2 style="margin: 0 0 30px 0; font-size: 2em; text-align: center;">ğŸ“Š SatÄ±ÅŸ Temsilcileri KarÅŸÄ±laÅŸtÄ±rmalÄ± Analiz</h2>
                        
                        <!-- Comparison Table -->
                        <div style="overflow-x: auto; margin-bottom: 40px;">
                            <div id="salespersonComparisonTable"></div>
                        </div>
                        
                        <!-- Comparison Charts -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; margin-bottom: 30px;">
                        <div class="chart-container">
                                <h3 style="text-align: center; margin-bottom: 20px;">ğŸ’° Toplam SatÄ±ÅŸ KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3>
                                <canvas id="comparisonSalesChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“¦ ÃœrÃ¼n Adet KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3>
                                <canvas id="comparisonQtyChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Grid -->
                    <div id="salespersonBrandCategorySection" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; margin-bottom: 30px;">
                        <div class="chart-container">
                            <h3 id="salespersonBrandChartTitle" style="text-align: center; margin-bottom: 20px;">ğŸ·ï¸ En Ã‡ok SattÄ±ÄŸÄ± Markalar (Top 10)</h3>
                            <canvas id="salespersonBrandChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 id="salespersonCategoryChartTitle" style="text-align: center; margin-bottom: 20px;">ğŸ“‚ En Ã‡ok SattÄ±ÄŸÄ± Kategoriler</h3>
                            <canvas id="salespersonCategoryChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- AylÄ±k Performans Trendi - Tam GeniÅŸlik -->
                    <div id="salespersonMonthlySection" style="margin-bottom: 40px;">
                        <div class="chart-container" style="height: 400px;">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“ˆ AylÄ±k Performans Trendi (YÄ±l KarÅŸÄ±laÅŸtÄ±rmalÄ±)</h3>
                            <canvas id="salespersonMonthlyChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Top 20 Products -->
                    <div id="salespersonTopProductsSection" style="margin-bottom: 40px;">
                        <h3 style="margin-bottom: 20px;">ğŸ¯ En Ã‡ok SattÄ±ÄŸÄ± ÃœrÃ¼nler (Top 20)</h3>
                        <div id="salespersonTopProductsTable" style="overflow-x: auto;"></div>
                    </div>
                    
                    <!-- Bottom 10 Products -->
                    <div id="salespersonBottomProductsSection" style="margin-bottom: 40px;">
                        <h3 style="margin-bottom: 20px;">âš ï¸ En Az SattÄ±ÄŸÄ± ÃœrÃ¼nler (Bottom 10)</h3>
                        <div id="salespersonBottomProductsTable" style="overflow-x: auto;"></div>
                    </div>
                    
                    <!-- AI Salesperson Analysis -->
                    <div id="salespersonAIAnalysisPanel" style="margin: 40px 0;">
                        <h3 style="margin-bottom: 20px;">ğŸ¤– AI Performans Analizi ve Ã–neriler</h3>
                        <div id="salespersonAIAnalysisContent"></div>
                    </div>
                </div>
                
                <!-- No Results Message -->
                <div id="salespersonSearchNoResults" style="display: none; text-align: center; padding: 60px; background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 4em; margin-bottom: 20px;">ğŸ”</div>
                    <h3 style="color: #cbd5e1; margin-bottom: 10px;">SatÄ±ÅŸ Temsilcisi BulunamadÄ±</h3>
                    <p style="color: #94a3b8;">LÃ¼tfen farklÄ± bir isim deneyin</p>
                </div>
                
                <!-- Top 50 Salespersons List (Arama yapÄ±ldÄ±ÄŸÄ±nda sayfanÄ±n en altÄ±nda gÃ¶sterilir) -->
                <div id="salespersonListSectionBottom" style="margin: 40px 0; display: none;">
                    <h3 style="margin-bottom: 20px; color: #e2e8f0;">ğŸ‘¥ TÃ¼m SatÄ±ÅŸ Temsilcileri DetaylÄ± Performans Listesi (Top 50)</h3>
                    <div id="salespersonListTableBottom" style="overflow-x: auto;"></div>
                </div>
            </div>
        </div>
        <!-- End Salesperson Analysis Tab -->

        <!-- Store Analysis Tab -->
        <div id="storeTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 30px;">ğŸª MaÄŸaza Performans Analizi</h2>
                
                <!-- Filters Section (Dropdown yapÄ±sÄ±) -->
                <div class="filters-section" style="margin-bottom: 30px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 800px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">YÄ±l</label>
                            <select id="filterStoreYearSelect" onchange="applyStoreFilters()" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                                <option value="">TÃ¼m YÄ±llar</option>
                            </select>
                            </div>
                        <div style="display: flex; gap: 20px;">
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Ay (Opsiyonel)</label>
                                <select id="filterStoreMonthSelect" onchange="applyStoreFilters()" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                                    <option value="">TÃ¼m YÄ±l</option>
                                    <option value="01">Ocak</option>
                                    <option value="02">Åubat</option>
                                    <option value="03">Mart</option>
                                    <option value="04">Nisan</option>
                                    <option value="05">MayÄ±s</option>
                                    <option value="06">Haziran</option>
                                    <option value="07">Temmuz</option>
                                    <option value="08">AÄŸustos</option>
                                    <option value="09">EylÃ¼l</option>
                                    <option value="10">Ekim</option>
                                    <option value="11">KasÄ±m</option>
                                    <option value="12">AralÄ±k</option>
                                </select>
                        </div>
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">GÃ¼n (Opsiyonel)</label>
                                <select id="filterStoreDaySelect" onchange="applyStoreFilters()" style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
                                    <option value="">TÃ¼m GÃ¼nler</option>
                                    <option value="01">01</option>
                                    <option value="02">02</option>
                                    <option value="03">03</option>
                                    <option value="04">04</option>
                                    <option value="05">05</option>
                                    <option value="06">06</option>
                                    <option value="07">07</option>
                                    <option value="08">08</option>
                                    <option value="09">09</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                    <option value="21">21</option>
                                    <option value="22">22</option>
                                    <option value="23">23</option>
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                    <option value="31">31</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="clearStoreFilters()" 
                                style="background: #6c757d; color: white; border: none; padding: 12px 30px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            ğŸ”„ Filtreleri Temizle
                        </button>
                    </div>
                </div>
                
                <!-- Search Input with Multi-Select -->
                <div style="max-width: 800px; margin: 0 auto 40px;">
                    <!-- Selected Stores Tags -->
                    <div id="selectedStoresContainer" style="display: none; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <span style="font-weight: 600; color: #10B981;">SeÃ§ili MaÄŸazalar:</span>
                            <div id="selectedStoresTags" style="display: flex; gap: 8px; flex-wrap: wrap;"></div>
                        </div>
                    </div>
                    
                    <div style="position: relative;">
                        <input type="text" id="storeSearchInput" placeholder="MaÄŸaza adÄ± yazÄ±n... (Ã¶rn: Toptan, Akasya)" 
                               style="width: 100%; padding: 20px 60px 20px 20px; font-size: 1.1em; border: 2px solid #10B981; border-radius: 15px; outline: none; background: rgba(30, 41, 59, 0.8); color: #e2e8f0;"
                               oninput="showStoreSuggestions(this.value)"
                               onkeydown="handleStoreKeydown(event)"
                               onfocus="showStoreSuggestions(this.value)">
                        <button onclick="searchStoreProfile()" 
                                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-size: 1em;">
                            ğŸ” Ara
                        </button>
                        <div id="storeSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(20px); border: 2px solid #10B981; border-top: none; border-radius: 0 0 15px 15px; max-height: 300px; overflow-y: auto; display: none; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.3); color: #e2e8f0;"></div>
                    </div>
                    <p style="text-align: center; color: #94a3b8; margin-top: 10px; font-size: 0.9em;">
                        ğŸ’¡ Ä°pucu: Birden fazla maÄŸaza seÃ§erek karÅŸÄ±laÅŸtÄ±rmalÄ± analiz yapabilirsiniz! (En fazla 3 maÄŸaza)
                    </p>
                </div>
                
                <!-- Results Container -->
                <div id="storeProfileContainer" style="display: none;">
                    <!-- Multiple Stores Comparison View -->
                    <div id="multipleStoresView" style="display: none;">
                        <h2 style="margin-bottom: 30px; text-align: center;">ğŸª MaÄŸaza KarÅŸÄ±laÅŸtÄ±rma Analizi</h2>
                        
                        <!-- Comparison Table -->
                        <div id="storeComparisonTableContainer" style="margin-bottom: 40px; overflow-x: auto;"></div>
                        
                        <!-- Comparison Charts -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; margin-bottom: 30px;">
                            <div class="chart-container">
                                <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“Š Toplam SatÄ±ÅŸ KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3>
                                <canvas id="comparisonStoreSalesChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“¦ Toplam Adet KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3>
                                <canvas id="comparisonStoreQtyChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Category Comparison by Store -->
                        <div id="storeComparisonCategorySection" style="margin: 40px 0;">
                            <h3 style="text-align: center; margin-bottom: 30px;">ğŸ“‚ MaÄŸaza BazÄ±nda Kategori KarÅŸÄ±laÅŸtÄ±rmasÄ± (Kategori 1)</h3>
                            
                            <!-- Category Comparison Table -->
                            <div id="storeCategoryComparisonTableContainer" style="margin-bottom: 40px; overflow-x: auto;"></div>
                            
                            <!-- Category Charts (GÄ°ZLENDÄ° - Metrik tablo yeterli) -->
                            <div id="storeComparisonCategoryCharts" style="display: none;"></div>
                        </div>
                        
                        <!-- AI Comparison Analysis -->
                        <div id="multipleStoresAIPanel" style="margin: 40px 0;">
                            <div id="multipleStoresAIContent"></div>
                        </div>
                    </div>
                    
                    <!-- Single Store View -->
                    <div id="singleStoreView" style="display: none;">
                    <!-- Store Profile Header -->
                    <div style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); color: white; padding: 40px; border-radius: 20px; margin-bottom: 30px;">
                        <h2 style="margin: 0 0 20px 0; font-size: 2em;">ğŸª <span id="storeName">-</span></h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ’° Toplam SatÄ±ÅŸ (KDV HariÃ§)</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeTotalSales">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“¦ Toplam Adet</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeTotalQty">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ›’ Fatura SayÄ±sÄ±</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeInvoiceCount">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“Š GÃ¼nlÃ¼k Ort. SatÄ±ÅŸ</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeAvgTransaction">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ›’ Sepet OrtalamasÄ±</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeAvgBasket">$0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ‘¥ FarklÄ± MÃ¼ÅŸteri</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeUniqueCustomers">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ¯ FarklÄ± ÃœrÃ¼n</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeUniqueProducts">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“¦ Mevcut Stok</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeCurrentStock">0</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸŸï¸ Genel Ä°ndirim OrtalamasÄ±</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeGeneralDiscount">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ’ KampanyalÄ± ÃœrÃ¼nler Ek Ä°ndirim</div>
                                <div style="font-size: 1.5em; font-weight: bold;" id="storeCampaignExtraDiscount">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ’³ En Ã‡ok Tercih Edilen Kart</div>
                                <div style="font-size: 1.3em; font-weight: bold;" id="storeTopCardFamily">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ“… En Ã‡ok Tercih Edilen Taksit</div>
                                <div style="font-size: 1.3em; font-weight: bold;" id="storeTopInstallment">-</div>
                            </div>
                            <div>
                                <div style="opacity: 0.8; font-size: 0.9em;">ğŸ’³ Ã–deme Metodu</div>
                                <div style="font-size: 1.3em; font-weight: bold;" id="storeTopPaymentMethod">-</div>
                            </div>
                        </div>
                    </div>
                    <!-- End Single Store View -->
                    
                    <!-- Charts Grid (ORTAK - hem tek hem Ã§oklu maÄŸaza iÃ§in) -->
                    <div id="storeBrandCategorySection" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; margin-bottom: 30px;">
                        <div class="chart-container">
                            <h3 id="storeBrandChartTitle" style="text-align: center; margin-bottom: 20px;">ğŸ·ï¸ En Ã‡ok Satan Markalar (Top 10)</h3>
                            <canvas id="storeBrandChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 id="storeCategoryChartTitle" style="text-align: center; margin-bottom: 20px;">ğŸ“‚ En Ã‡ok Satan Kategoriler</h3>
                            <canvas id="storeCategoryChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 id="storeDistrictChartTitle" style="text-align: center; margin-bottom: 20px;">ğŸ“ En Ã‡ok SatÄ±ÅŸ YapÄ±lan Ä°lk 5 Ä°lÃ§e</h3>
                            <canvas id="storeDistrictChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 id="storeSalespersonChartTitle" style="text-align: center; margin-bottom: 20px;">ğŸ‘¨â€ğŸ’¼ SatÄ±ÅŸ Temsilcileri</h3>
                            <canvas id="storeSalespersonChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- AylÄ±k Performans Trendi - Tam GeniÅŸlik -->
                    <div class="chart-container" style="width: 100%; margin-bottom: 30px; height: 500px;">
                            <h3 id="storeMonthlyChartTitle" style="text-align: center; margin-bottom: 20px;">ğŸ“ˆ AylÄ±k Performans Trendi</h3>
                        <canvas id="storeMonthlyChart" style="max-width: 100%;"></canvas>
                    </div>
                    
                    <!-- Top 20 Products -->
                    <div id="storeTopProductsSection" style="margin-bottom: 40px;">
                        <h3 style="margin-bottom: 20px;">ğŸ¯ En Ã‡ok Satan ÃœrÃ¼nler (Top 20)</h3>
                        <div id="storeTopProductsTable" style="overflow-x: auto;"></div>
                    </div>
                    
                    <!-- AI Store Analysis -->
                    <div id="storeAIAnalysisPanel" style="margin: 40px 0;">
                        <h3 style="margin-bottom: 20px;">ğŸ¤– AI Performans Analizi ve Ã–neriler</h3>
                        <div id="storeAIAnalysisContent"></div>
                    </div>
                    
                    <!-- Full Salesperson List -->
                    <div id="storeFullSalespersonSection" style="margin: 40px 0;">
                        <h3 style="margin-bottom: 20px;">ğŸ‘¥ TÃ¼m SatÄ±ÅŸ Temsilcileri DetaylÄ± Performans Listesi</h3>
                        <div id="storeFullSalespersonTable" style="overflow-x: auto;"></div>
                    </div>
                </div>
                <!-- End storeProfileContainer -->
                
                <!-- No Results Message -->
                <div id="storeSearchNoResults" style="display: none; text-align: center; padding: 60px; background: #f8f9fa; border-radius: 15px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">ğŸ”</div>
                    <h3 style="color: #6c757d; margin-bottom: 10px;">MaÄŸaza BulunamadÄ±</h3>
                    <p style="color: #adb5bd;">LÃ¼tfen farklÄ± bir isim deneyin</p>
                </div>
                </div>
            </div>
        </div>
        <!-- End Store Analysis Tab -->

        <!-- City Analysis Tab -->
        <div id="cityTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 30px;">ğŸŒ Åehir BazlÄ± SatÄ±ÅŸ Analizi</h2>
                <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
                    <p style="margin: 0; color: #1565c0; font-size: 0.95em;">
                        ğŸ’¡ <strong>Ä°pucu:</strong> Tarih aralÄ±ÄŸÄ± seÃ§mek zorunlu deÄŸil, istenirse tÃ¼m dÃ¶nem veya belirli tarih aralÄ±ÄŸÄ± iÃ§in analiz yapabilirsiniz.
                    </p>
                </div>
                
                <!-- City Selection & Date Filters -->
                <div style="background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); padding: 30px; border-radius: 15px; margin-bottom: 40px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 20px; align-items: end;">
                        <div>
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“ Åehir SeÃ§in</label>
                            <select id="citySelect" onchange="handleCityChange()" 
                                    style="width: 100%; padding: 15px; font-size: 1.1em; border: none; border-radius: 10px; outline: none;">
                                <option value="">-- Åehir SeÃ§in --</option>
                            </select>
                        </div>
                        <div>
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ˜ï¸ Ä°lÃ§e SeÃ§in <small style="opacity: 0.8;">(Opsiyonel)</small></label>
                            <select id="districtSelect" onchange="analyzeCityPerformance()" 
                                    style="width: 100%; padding: 15px; font-size: 1.1em; border: none; border-radius: 10px; outline: none;" disabled>
                                <option value="">-- Ã–nce Åehir SeÃ§in --</option>
                            </select>
                        </div>
                        <div>
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“… BaÅŸlangÄ±Ã§ Tarihi</label>
                            <input type="date" id="cityDateStart" onchange="analyzeCityPerformance()"
                                   style="width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 1em;">
                        </div>
                        <div>
                            <label style="color: white; display: block; margin-bottom: 8px; font-weight: 600;">ğŸ“… BitiÅŸ Tarihi</label>
                            <input type="date" id="cityDateEnd" onchange="analyzeCityPerformance()"
                                   style="width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 1em;">
                        </div>
                        <div>
                            <button onclick="clearCityFilters()" 
                                    style="padding: 15px 30px; background: rgba(30, 41, 59, 0.8); color: #10B981; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                                ğŸ—‘ï¸ Temizle
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- City Results Container -->
                <div id="cityAnalysisContainer" style="display: none;">
                    <!-- City Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="summary-card">
                            <h3 style="font-size: 1em; margin-bottom: 10px;">ğŸ’° Toplam SatÄ±ÅŸ (KDV HariÃ§)</h3>
                            <p id="cityTotalSales" style="font-size: 1.8em; font-weight: bold;">$0</p>
                        </div>
                        <div class="summary-card">
                            <h3 style="font-size: 1em; margin-bottom: 10px;">ğŸ“¦ Toplam Adet</h3>
                            <p id="cityTotalQty" style="font-size: 1.8em; font-weight: bold;">0</p>
                        </div>
                        <div class="summary-card">
                            <h3 style="font-size: 1em; margin-bottom: 10px;">ğŸ‘¥ MÃ¼ÅŸteri SayÄ±sÄ±</h3>
                            <p id="cityCustomerCount" style="font-size: 1.8em; font-weight: bold;">0</p>
                        </div>
                        <div class="summary-card">
                            <h3 style="font-size: 1em; margin-bottom: 10px;">ğŸ“Š Ortalama Sepet</h3>
                            <p id="cityAvgBasket" style="font-size: 1.8em; font-weight: bold;">$0</p>
                        </div>
                        <div class="summary-card">
                            <h3 style="font-size: 1em; margin-bottom: 10px;">ğŸ“… GÃ¼nlÃ¼k Ortalama</h3>
                            <p id="cityDailyAverage" style="font-size: 1.8em; font-weight: bold;">$0</p>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%); color: white;">
                            <h3 style="font-size: 1em; margin-bottom: 10px; color: white;">ğŸ™ï¸ NÃ¼fus (2024)</h3>
                            <p id="cityPopulation" style="font-size: 1.8em; font-weight: bold; color: white;">-</p>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                            <h3 style="font-size: 1em; margin-bottom: 10px; color: white;">ğŸ‘¤ KiÅŸi BaÅŸÄ± SatÄ±ÅŸ</h3>
                            <p id="cityPerCapitaSales" style="font-size: 1.8em; font-weight: bold; color: white;">$0</p>
                            <small style="opacity: 0.9; font-size: 0.85em;">Toplam SatÄ±ÅŸ / NÃ¼fus</small>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, #38ef7d 0%, #11998e 100%); color: white; grid-column: span 1;">
                            <h3 style="font-size: 0.95em; margin-bottom: 10px;">ğŸ‘¤ Top 5 Temsilci</h3>
                            <div id="cityTopSalespersons" style="color: white; font-size: 0.85em; line-height: 1.6; max-height: 120px; overflow-y: auto;"></div>
                        </div>
                        <div class="summary-card" style="background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); color: white; grid-column: span 1;">
                            <h3 style="font-size: 0.95em; margin-bottom: 10px;">ğŸª Top 5 MaÄŸaza</h3>
                            <div id="cityTopStores" style="color: white; font-size: 0.85em; line-height: 1.6; max-height: 120px; overflow-y: auto;"></div>
                        </div>
                    </div>
                    
                    <!-- Charts Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; margin-bottom: 30px;">
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ·ï¸ En Ã‡ok SatÄ±lan Markalar</h3>
                            <canvas id="cityBrandChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ¸ En Ã‡ok SatÄ±lan ÃœrÃ¼nler</h3>
                            <canvas id="cityProductChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“‚ En Ã‡ok SatÄ±lan Kategoriler</h3>
                            <canvas id="cityCategoryChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ“ˆ AylÄ±k Performans Trendi (YÄ±l KarÅŸÄ±laÅŸtÄ±rmalÄ±)</h3>
                            <canvas id="cityYearlyChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- AI City Analysis -->
                    <div id="cityAIAnalysisPanel" style="margin: 40px 0;">
                        <h3 style="margin-bottom: 20px;">ğŸ¤– AI Åehir Analizi ve Ã–neriler</h3>
                        <div id="cityAIAnalysisContent"></div>
                    </div>
                    
                    <!-- Full District List -->
                    <div id="cityFullDistrictSection" style="margin: 40px 0;">
                        <h3 style="margin-bottom: 20px;">ğŸ˜ï¸ SeÃ§ilen Åehre Ait TÃ¼m Ä°lÃ§eler DetaylÄ± Performans Listesi</h3>
                        <div id="cityFullDistrictTable" style="overflow-x: auto;"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End City Analysis Tab -->

        <!-- Stock Distribution Tab -->
        <div id="stockTab" class="tab-content">
            <div class="content">
                <h2 style="margin-bottom: 30px;">ğŸ“¦ Stok DaÄŸÄ±lÄ±m Analizi</h2>
                
                <!-- Tarih Filtresi -->
                <div style="max-width: 1000px; margin: 0 auto 30px;">
                    <div style="background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); padding: 20px; border-radius: 15px; color: white;">
                        <h3 style="margin-bottom: 15px;">ğŸ“… Tarih AralÄ±ÄŸÄ± Filtresi (Opsiyonel)</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: end;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-size: 0.9em; opacity: 0.9;">BaÅŸlangÄ±Ã§ Tarihi:</label>
                                <input type="date" id="stockDateStart" 
                                       style="width: 100%; padding: 10px; border: none; border-radius: 8px; font-size: 1em;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-size: 0.9em; opacity: 0.9;">BitiÅŸ Tarihi:</label>
                                <input type="date" id="stockDateEnd" 
                                       style="width: 100%; padding: 10px; border: none; border-radius: 8px; font-size: 1em;">
                            </div>
                            <div>
                                <button onclick="clearStockDateFilters()" 
                                        style="padding: 10px 20px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; cursor: pointer; font-size: 1em;">
                                    ğŸ”„ Temizle
                                </button>
                            </div>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.85em; opacity: 0.8;">
                            ğŸ’¡ Tarih seÃ§mezseniz tÃ¼m satÄ±ÅŸ verileri kullanÄ±lÄ±r
                        </p>
                    </div>
                </div>
                
                <!-- Stock Input Methods -->
                <div style="max-width: 1000px; margin: 0 auto;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
                        <!-- Excel Upload -->
                        <div style="background: #f8f9fa; padding: 30px; border-radius: 15px;">
                            <h3 style="margin-bottom: 20px;">ğŸ“„ Excel ile Toplu YÃ¼kleme</h3>
                            <p style="color: #6c757d; margin-bottom: 15px;">Excel formatÄ±: <strong>ÃœrÃ¼n Kodu | Stok MiktarÄ±</strong></p>
                            <input type="file" id="stockExcelInput" accept=".xlsx,.xls" 
                                   style="display: none;" onchange="handleStockExcelUpload(event)">
                            <button onclick="document.getElementById('stockExcelInput').click()" 
                                    style="width: 100%; padding: 15px; background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1.1em;">
                                ğŸ“‚ Excel DosyasÄ± SeÃ§
                            </button>
                            <p style="color: #6c757d; margin-top: 10px; font-size: 0.9em;">Max 5 MB, .xlsx veya .xls</p>
                        </div>
                        
                        <!-- Manual Entry -->
                        <div style="background: #f8f9fa; padding: 30px; border-radius: 15px;">
                            <h3 style="margin-bottom: 20px;">âœï¸ Manuel GiriÅŸ</h3>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">ÃœrÃ¼n Kodu:</label>
                                <input type="text" id="manualProductCode" placeholder="Ã¶rn: KDP120R" 
                                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Stok MiktarÄ±: <span style="color: #6c757d; font-weight: normal;">(Opsiyonel)</span></label>
                                <input type="number" id="manualStockQty" placeholder="Ã¶rn: 25 (opsiyonel)"
                                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            <button onclick="addManualStock()" 
                                    style="width: 100%; padding: 15px; background: linear-gradient(135deg, #38ef7d 0%, #11998e 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1.1em;">
                                â• Stok Ekle
                            </button>
                        </div>
                    </div>
                    
                    <!-- Current Stock List -->
                    <div id="stockListContainer" style="display: none; margin-bottom: 40px;">
                        <h3 style="margin-bottom: 20px;">ğŸ“‹ Mevcut Stok Listesi</h3>
                        <div id="stockListTable" style="overflow-x: auto;"></div>
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="analyzeStockDistribution()" 
                                    style="padding: 15px 40px; background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1.1em; margin-right: 10px;">
                                ğŸ¤– AI DaÄŸÄ±lÄ±m Ã–nerisi Al
                            </button>
                            <button onclick="clearStockList()" 
                                    style="padding: 15px 40px; background: #dc3545; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1.1em;">
                                ğŸ—‘ï¸ Listeyi Temizle
                            </button>
                        </div>
                    </div>
                    
                    <!-- AI Distribution Recommendations -->
                    <div id="stockDistributionResults" style="display: none;">
                        <h3 style="margin-bottom: 20px;">ğŸ¤– AI Stok DaÄŸÄ±lÄ±m Ã–nerileri</h3>
                        <div id="stockDistributionContent"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Stock Distribution Tab -->

    </div>

    <script>
        // Service Worker kaydÄ± (cache iÃ§in)
        // MEMORY LEAK FIX: Service Worker event listener'larÄ±nÄ± kaydet ve cleanup iÃ§in hazÄ±rla
        let serviceWorkerRegistration = null;
        let serviceWorkerUpdateFoundHandler = null;
        let serviceWorkerStateChangeHandler = null;
        let serviceWorkerNewWorker = null; // MEMORY LEAK FIX: newWorker referansÄ±nÄ± sakla
        
        if ('serviceWorker' in navigator) {
            // MEMORY LEAK FIX: Service Worker sadece bir kez kaydedilmeli ve load listener sadece bir kez eklenmeli
            if (!window.serviceWorkerLoadListenerAdded) {
                const serviceWorkerLoadHandler = () => {
                    navigator.serviceWorker.register('/service-worker.js')
                        .then((registration) => {
                            console.log('âœ… Service Worker kaydedildi:', registration.scope);
                            serviceWorkerRegistration = registration;
                            
                            // MEMORY LEAK FIX: EÄŸer zaten bir listener varsa, Ã¶nce temizle
                            if (serviceWorkerUpdateFoundHandler && serviceWorkerRegistration) {
                                serviceWorkerRegistration.removeEventListener('updatefound', serviceWorkerUpdateFoundHandler);
                            }
                            
                            // MEMORY LEAK FIX: Event handler fonksiyonunu tanÄ±mla ve kaydet
                            serviceWorkerUpdateFoundHandler = () => {
                                const newWorker = registration.installing;
                                if (newWorker) {
                                    // MEMORY LEAK FIX: newWorker referansÄ±nÄ± global deÄŸiÅŸkende sakla (cleanup iÃ§in)
                                    serviceWorkerNewWorker = newWorker;
                                    
                                    // MEMORY LEAK FIX: EÄŸer zaten bir listener varsa, Ã¶nce temizle
                                    if (serviceWorkerStateChangeHandler && serviceWorkerNewWorker) {
                                        serviceWorkerNewWorker.removeEventListener('statechange', serviceWorkerStateChangeHandler);
                                    }
                                    
                                    // MEMORY LEAK FIX: Event handler fonksiyonunu tanÄ±mla ve kaydet
                                    serviceWorkerStateChangeHandler = () => {
                                        if (serviceWorkerNewWorker && serviceWorkerNewWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                            console.log('ğŸ”„ Yeni Service Worker versiyonu mevcut, sayfa yenilenecek...');
                                            // KullanÄ±cÄ±ya bildirim gÃ¶sterilebilir
                                        }
                                    };
                                    
                                    serviceWorkerNewWorker.addEventListener('statechange', serviceWorkerStateChangeHandler);
                                }
                            };
                            
                            // Service Worker gÃ¼ncellemesi kontrolÃ¼
                            registration.addEventListener('updatefound', serviceWorkerUpdateFoundHandler);
                        })
                        .catch((error) => {
                            console.warn('âš ï¸ Service Worker kayÄ±t hatasÄ±:', error);
                            // Service Worker hatasÄ± uygulamayÄ± etkilemez, sessizce devam et
                        });
                };
                
                window.addEventListener('load', serviceWorkerLoadHandler);
                window.serviceWorkerLoadListenerAdded = true;
            }
        }
        
        // MEMORY LEAK FIX: Sayfa kapatÄ±ldÄ±ÄŸÄ±nda Service Worker listener'larÄ±nÄ± temizle (sadece bir kez ekle)
        if (!window.serviceWorkerListenersCleanupAdded) {
            window.addEventListener('beforeunload', function() {
                if (serviceWorkerUpdateFoundHandler && serviceWorkerRegistration) {
                    serviceWorkerRegistration.removeEventListener('updatefound', serviceWorkerUpdateFoundHandler);
                    serviceWorkerUpdateFoundHandler = null;
                }
                if (serviceWorkerStateChangeHandler && serviceWorkerNewWorker) {
                    // MEMORY LEAK FIX: newWorker referansÄ± artÄ±k global deÄŸiÅŸkende, removeEventListener Ã§aÄŸrÄ±labilir
                    serviceWorkerNewWorker.removeEventListener('statechange', serviceWorkerStateChangeHandler);
                    serviceWorkerStateChangeHandler = null;
                    serviceWorkerNewWorker = null;
                }
            });
            window.serviceWorkerListenersCleanupAdded = true;
        }
        
        // Sayfa yÃ¼klendiÄŸinde kullanÄ±cÄ± adÄ±nÄ± gÃ¶ster
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('currentUserName').textContent = 'KullanÄ±cÄ±';
        });


        let inventoryData = null; // Envanter verileri
        let inventoryCharts = {}; // Envanter grafikleri
        let stockLocations = {}; // Stok konumu ve maÄŸaza eÅŸleÅŸmesi
        
        // Global SatÄ±ÅŸ KanalÄ± Filtresi State
        let activeChannels = {
            all: true,
            retail: false,
            wholesale: false,
            online: false,
            corporate: false,
            central: false
        };
        
        // GerÃ§ek veri yÃ¼kleme takibi
        let dataLoadProgress = {
            pageInit: false,
            dataFiles: false,
            targets: false,
            ready: false
        };
        
        // isDiscountProduct, applyDiscountLogic, shouldHideItem, getStoreWorkingHours, 
        // isWithinWorkingHours, normalizeStoreName, getCurrentStock, loadStockLocations
        // artÄ±k data-processor.js ve data-loader.js'den geliyor
        
        // Global eriÅŸim iÃ§in window'a ekle (modÃ¼llerden import edilecek)
        import('./assets/js/data/data-processor.js').then(module => {
            window.isDiscountProduct = module.isDiscountProduct;
            window.applyDiscountLogic = module.applyDiscountLogic;
            window.shouldHideItem = module.shouldHideItem;
            window.getStoreWorkingHours = module.getStoreWorkingHours;
            window.isWithinWorkingHours = module.isWithinWorkingHours;
            window.getCurrentStock = (storeName, productCode) => {
                return module.getCurrentStock(storeName, productCode, inventoryData, stockLocations);
            };
        });
        
        import('./assets/js/core/utils.js').then(module => {
            window.normalizeStoreName = module.normalizeStoreName;
        });
        
        // GÃ¼nlÃ¼k satÄ±ÅŸ fonksiyonlarÄ± artÄ±k assets/js/features/sales/daily-sales.js'den geliyor
        import('./assets/js/features/sales/daily-sales.js').then(module => {
            window.populateDailySalesStoreFilter = module.populateDailySalesStoreFilter;
            window.populateDailySalesDateFilters = module.populateDailySalesDateFilters;
            window.loadDailySales = module.loadDailySales;
            window.renderDailySalesTable = module.renderDailySalesTable;
            window.sortDailySalesTable = module.sortDailySalesTable;
            window.exportDailySalesToExcel = module.exportDailySalesToExcel;
        });
        
        // MÃ¼ÅŸteri analizi fonksiyonlarÄ± artÄ±k assets/js/features/customers/customer-analyzer.js'den geliyor
        import('./assets/js/features/customers/customer-analyzer.js').then(module => {
            window.analyzeCustomers = module.analyzeCustomers;
            window.populateCustomerStoreFilter = module.populateCustomerStoreFilter;
            window.renderTopCustomers = module.renderTopCustomers;
            window.renderCustomerCityChart = module.renderCustomerCityChart;
            window.renderCustomerTrendChart = module.renderCustomerTrendChart;
            window.searchCustomerProfileMain = module.searchCustomerProfileMain;
            window.clearCustomerSearchMain = module.clearCustomerSearchMain;
            window.renderCustomerBrandChartMain = module.renderCustomerBrandChartMain;
            window.renderCustomerCategoryChartMain = module.renderCustomerCategoryChartMain;
            window.renderCustomerPurchaseHistoryMain = module.renderCustomerPurchaseHistoryMain;
            window.performCustomerAIAnalysisMain = module.performCustomerAIAnalysisMain;
            window.showCustomerSuggestions = module.showCustomerSuggestions;
            window.handleCustomerKeydown = module.handleCustomerKeydown;
        });
        
        // MaÄŸaza analizi fonksiyonlarÄ± artÄ±k assets/js/features/stores/store-analyzer.js'den geliyor
        // Fallback fonksiyonlar (modÃ¼l yÃ¼klenene kadar)
        let showSalespersonSuggestionsLoaded = false;
        let handleSalespersonKeydownLoaded = false;
        
        window.showSalespersonSuggestions = function(query) {
            if (showSalespersonSuggestionsLoaded) {
                // ModÃ¼l yÃ¼klendi, gerÃ§ek fonksiyonu Ã§aÄŸÄ±r
                const realFn = window._realShowSalespersonSuggestions;
                if (realFn) return realFn(query);
            }
            // ModÃ¼l henÃ¼z yÃ¼klenmedi, sessizce Ã§Ä±k
            const suggestionsDiv = document.getElementById('salespersonSuggestions');
            if (suggestionsDiv) suggestionsDiv.style.display = 'none';
        };
        
        window.handleSalespersonKeydown = function(event) {
            if (handleSalespersonKeydownLoaded) {
                // ModÃ¼l yÃ¼klendi, gerÃ§ek fonksiyonu Ã§aÄŸÄ±r
                const realFn = window._realHandleSalespersonKeydown;
                if (realFn) return realFn(event);
            }
            // ModÃ¼l henÃ¼z yÃ¼klenmedi, sessizce Ã§Ä±k
        };
        
        window.searchSalespersonProfile = function() {
            // Ã–nce gerÃ§ek fonksiyonun yÃ¼klenip yÃ¼klenmediÄŸini kontrol et
            if (window._realSearchSalespersonProfile) {
                return window._realSearchSalespersonProfile();
            }
            
            // ModÃ¼l henÃ¼z yÃ¼klenmedi, modÃ¼lÃ¼n yÃ¼klenmesini bekle
            let attempts = 0;
            const maxAttempts = 50; // 5 saniye (100ms * 50)
            
            const checkAndRetry = setInterval(() => {
                attempts++;
                
                if (window._realSearchSalespersonProfile) {
                    clearInterval(checkAndRetry);
                    // ModÃ¼l yÃ¼klendi, fonksiyonu Ã§aÄŸÄ±r
                    window._realSearchSalespersonProfile();
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkAndRetry);
                    alert('SatÄ±ÅŸ temsilcisi arama Ã¶zelliÄŸi yÃ¼klenemedi. LÃ¼tfen sayfayÄ± yenileyin.');
                }
            }, 100);
        };
        
        // store-analyzer.js modÃ¼lÃ¼nÃ¼ dinamik olarak yÃ¼kle ve hata kontrolÃ¼ yap
        let storeAnalyzerModuleLoaded = false;
        let storeAnalyzerModuleError = null;
        
        // ModÃ¼l yÃ¼kleme fonksiyonu
        async function loadStoreAnalyzerModule() {
            try {
                const module = await import('./assets/js/features/stores/store-analyzer.js');
                // ModÃ¼l baÅŸarÄ±yla yÃ¼klendi
                storeAnalyzerModuleLoaded = true;
                storeAnalyzerModuleError = null;
                
                // window.storeAnalyzerModule zaten modÃ¼l tarafÄ±ndan oluÅŸturulmuÅŸ olmalÄ±
                // Ama yoksa manuel olarak oluÅŸtur
                if (!window.storeAnalyzerModule && module) {
                    // ModÃ¼lden export edilen fonksiyonlarÄ± al
                    window.storeAnalyzerModule = {
                        renderSingleStoreView: module.renderSingleStoreView,
                        renderMultipleStoresView: module.renderMultipleStoresView,
                        renderStoreComparisonTable: module.renderStoreComparisonTable,
                        renderStoreComparisonCharts: module.renderStoreComparisonCharts,
                        renderStoreCategoryComparisonTable: module.renderStoreCategoryComparisonTable,
                        renderStoreComparisonCategoryCharts: module.renderStoreComparisonCategoryCharts,
                        performMultipleStoresAIAnalysis: module.performMultipleStoresAIAnalysis,
                        renderStoreBrandChart: module.renderStoreBrandChart,
                        renderStoreCategoryChart: module.renderStoreCategoryChart,
                        renderStoreDistrictChart: module.renderStoreDistrictChart,
                        renderStoreSalespersonChart: module.renderStoreSalespersonChart,
                        renderStoreMonthlyChart: module.renderStoreMonthlyChart,
                        renderStoreTopProducts: module.renderStoreTopProducts,
                        renderStoreFullSalespersonTable: module.renderStoreFullSalespersonTable,
                        performStoreAIAnalysis: module.performStoreAIAnalysis,
                        sortStoreTopProducts: module.sortStoreTopProducts,
                        sortStoreSpTable: module.sortStoreSpTable,
                        analyzeStore: module.analyzeStore,
                        showSalespersonSuggestions: module.showSalespersonSuggestions,
                        handleSalespersonKeydown: module.handleSalespersonKeydown,
                        searchSalespersonProfile: module.searchSalespersonProfile,
                        renderSalespersonListTable: module.renderSalespersonListTable,
                        renderSalespersonMonthlyChart: module.renderSalespersonMonthlyChart,
                        renderSalespersonTopProducts: module.renderSalespersonTopProducts,
                        renderSalespersonBottomProducts: module.renderSalespersonBottomProducts,
                        renderSalespersonComparisonTable: module.renderSalespersonComparisonTable,
                        renderSalespersonComparisonCharts: module.renderSalespersonComparisonCharts,
                        populateSalespersonYearFilter: module.populateSalespersonYearFilter,
                        populateSalespersonMonthFilter: module.populateSalespersonMonthFilter,
                        populateSalespersonDayFilter: module.populateSalespersonDayFilter,
                        applySalespersonFilters: module.applySalespersonFilters,
                        clearSalespersonFilters: module.clearSalespersonFilters
                    };
                }
                
                // TÃ¼m fonksiyonlarÄ± window'a ata
                if (window.storeAnalyzerModule) {
                    const mod = window.storeAnalyzerModule;
                    window.renderSingleStoreView = mod.renderSingleStoreView;
                    window.renderMultipleStoresView = mod.renderMultipleStoresView;
                    window.renderStoreComparisonTable = mod.renderStoreComparisonTable;
                    window.renderStoreComparisonCharts = mod.renderStoreComparisonCharts;
                    window.renderStoreCategoryComparisonTable = mod.renderStoreCategoryComparisonTable;
                    window.renderStoreComparisonCategoryCharts = mod.renderStoreComparisonCategoryCharts;
                    window.performMultipleStoresAIAnalysis = mod.performMultipleStoresAIAnalysis;
                    window.renderStoreBrandChart = mod.renderStoreBrandChart;
                    window.renderStoreCategoryChart = mod.renderStoreCategoryChart;
                    window.renderStoreDistrictChart = mod.renderStoreDistrictChart;
                    window.renderStoreSalespersonChart = mod.renderStoreSalespersonChart;
                    window.renderStoreMonthlyChart = mod.renderStoreMonthlyChart;
                    window.renderStoreTopProducts = mod.renderStoreTopProducts;
                    window.renderStoreFullSalespersonTable = mod.renderStoreFullSalespersonTable;
                    window.performStoreAIAnalysis = mod.performStoreAIAnalysis;
                    window.sortStoreTopProducts = mod.sortStoreTopProducts;
                    window.sortStoreSpTable = mod.sortStoreSpTable;
                    window.analyzeStore = mod.analyzeStore;
                    window._realShowSalespersonSuggestions = mod.showSalespersonSuggestions;
                    window._realHandleSalespersonKeydown = mod.handleSalespersonKeydown;
                    window._realSearchSalespersonProfile = mod.searchSalespersonProfile;
                    showSalespersonSuggestionsLoaded = true;
                    handleSalespersonKeydownLoaded = true;
                    window.showSalespersonSuggestions = mod.showSalespersonSuggestions;
                    window.handleSalespersonKeydown = mod.handleSalespersonKeydown;
                    window.searchSalespersonProfile = mod.searchSalespersonProfile;
                    window.renderSalespersonListTable = mod.renderSalespersonListTable;
                    window.renderSalespersonMonthlyChart = mod.renderSalespersonMonthlyChart;
                    window.renderSalespersonTopProducts = mod.renderSalespersonTopProducts;
                    window.renderSalespersonBottomProducts = mod.renderSalespersonBottomProducts;
                    window.renderSalespersonComparisonTable = mod.renderSalespersonComparisonTable;
                    window.renderSalespersonComparisonCharts = mod.renderSalespersonComparisonCharts;
                    window.populateSalespersonYearFilter = mod.populateSalespersonYearFilter;
                    window.populateSalespersonMonthFilter = mod.populateSalespersonMonthFilter;
                    window.populateSalespersonDayFilter = mod.populateSalespersonDayFilter;
                    // GerÃ§ek fonksiyonlarÄ± window'a ata (fallback'leri override et)
                    window.applySalespersonFilters = mod.applySalespersonFilters;
                    window.clearSalespersonFilters = mod.clearSalespersonFilters;
                }
                
                console.log('âœ… store-analyzer.js modÃ¼lÃ¼ baÅŸarÄ±yla yÃ¼klendi');
            } catch (error) {
                storeAnalyzerModuleError = error;
                console.error('âŒ store-analyzer.js modÃ¼lÃ¼ yÃ¼klenirken hata:', error);
                console.error('Hata detaylarÄ±:', error.message, error.stack);
            }
        }
        
        // ModÃ¼lÃ¼ yÃ¼kle
        loadStoreAnalyzerModule();
        
        // SatÄ±ÅŸ temsilcisi filtre fonksiyonlarÄ± iÃ§in fallback (modÃ¼l yÃ¼klenene kadar)
        window.applySalespersonFilters = function() {
            // Ã–nce window.storeAnalyzerModule'Ã¼ kontrol et
            if (window.storeAnalyzerModule && window.storeAnalyzerModule.applySalespersonFilters) {
                return window.storeAnalyzerModule.applySalespersonFilters();
            }
            
            // ModÃ¼l yÃ¼klenmediyse, tekrar yÃ¼klemeyi dene
            if (!storeAnalyzerModuleLoaded && !storeAnalyzerModuleError) {
                console.log('ğŸ”„ ModÃ¼l yÃ¼kleniyor, tekrar deniyor...');
                loadStoreAnalyzerModule().then(() => {
                    // ModÃ¼l yÃ¼klendikten sonra tekrar Ã§aÄŸÄ±r
                    if (window.storeAnalyzerModule && window.storeAnalyzerModule.applySalespersonFilters) {
                        window.storeAnalyzerModule.applySalespersonFilters();
                    }
                });
                return;
            }
            
            // ModÃ¼l yÃ¼klenemediyse hata gÃ¶ster
            if (storeAnalyzerModuleError) {
                console.error('âŒ applySalespersonFilters: ModÃ¼l yÃ¼klenemedi:', storeAnalyzerModuleError);
            } else {
                console.warn('âš ï¸ applySalespersonFilters: ModÃ¼l henÃ¼z yÃ¼klenmedi');
            }
        };
        
        window.clearSalespersonFilters = function() {
            // Ã–nce window.storeAnalyzerModule'Ã¼ kontrol et
            if (window.storeAnalyzerModule && window.storeAnalyzerModule.clearSalespersonFilters) {
                return window.storeAnalyzerModule.clearSalespersonFilters();
            }
            
            // ModÃ¼l yÃ¼klenmediyse, tekrar yÃ¼klemeyi dene
            if (!storeAnalyzerModuleLoaded && !storeAnalyzerModuleError) {
                console.log('ğŸ”„ ModÃ¼l yÃ¼kleniyor, tekrar deniyor...');
                loadStoreAnalyzerModule().then(() => {
                    // ModÃ¼l yÃ¼klendikten sonra tekrar Ã§aÄŸÄ±r
                    if (window.storeAnalyzerModule && window.storeAnalyzerModule.clearSalespersonFilters) {
                        window.storeAnalyzerModule.clearSalespersonFilters();
                    }
                });
                return;
            }
            
            // ModÃ¼l yÃ¼klenemediyse hata gÃ¶ster
            if (storeAnalyzerModuleError) {
                console.error('âŒ clearSalespersonFilters: ModÃ¼l yÃ¼klenemedi:', storeAnalyzerModuleError);
            } else {
                console.warn('âš ï¸ clearSalespersonFilters: ModÃ¼l henÃ¼z yÃ¼klenmedi');
            }
        };
        
        // loadYearData ve loadCentralTargets artÄ±k data-loader.js'den geliyor
        // Global eriÅŸim iÃ§in window'a ekleniyorlar
        let centralTargets = {yearly: {}, monthly: {}};
        
        // loadCentralTargets wrapper - loading progress gÃ¼ncellemesi iÃ§in
        // Orijinal fonksiyonu saklamak iÃ§in bir referans tutacaÄŸÄ±z
        let originalLoadCentralTargets = null;
        
        // ModÃ¼l yÃ¼klendiÄŸinde orijinal fonksiyonu sakla
        let checkCount = 0;
        const checkForOriginalFunction = setInterval(() => {
            checkCount++;
            if (checkCount % 10 === 0) { // Her 1 saniyede bir log
                (window.safeConsole || safeConsoleFallback).log(`ğŸ” ModÃ¼l kontrolÃ¼... (${checkCount * 100}ms) - loadCentralTargets: ${typeof window.loadCentralTargets}`);
            }
            
            if (window.loadCentralTargets && typeof window.loadCentralTargets === 'function') {
                // EÄŸer wrapper deÄŸilse (yani modÃ¼lden gelen orijinal fonksiyon ise)
                if (window.loadCentralTargets !== loadCentralTargetsWrapper) {
                    (window.safeConsole || safeConsoleFallback).log(`âœ… Orijinal loadCentralTargets fonksiyonu bulundu!`);
                    originalLoadCentralTargets = window.loadCentralTargets;
                    // Wrapper'Ä± gÃ¼ncelle
                    window.loadCentralTargets = loadCentralTargetsWrapper;
                    clearInterval(checkForOriginalFunction);
                }
            }
            
            // Maksimum 10 saniye bekle
            if (checkCount >= 100) {
                clearInterval(checkForOriginalFunction);
                (window.safeConsole || safeConsoleFallback).warn(`â±ï¸ ModÃ¼l kontrolÃ¼ timeout (10 saniye)`);
            }
        }, 100);
        
        // loadCentralTargetsWrapper() fonksiyonu artÄ±k assets/js/data/data-loader.js modÃ¼lÃ¼nden geliyor
        // Global eriÅŸim iÃ§in window'a ekleniyor

        // ==================== KANAL FÄ°LTRELEME ====================
        // Kanal filtreleme fonksiyonlarÄ± artÄ±k assets/js/filters/filter-manager.js modÃ¼lÃ¼nde
        // handleChannelFilter, applyChannelFilter, updateAfterChannelFilter
        // Global eriÅŸim iÃ§in window.handleChannelFilter, window.applyChannelFilter, window.updateAfterChannelFilter kullanÄ±labilir
        
        // Global Kanal Filtresi Fonksiyonu (window scope'una ekle - modÃ¼lden gelecek)
        // window.handleChannelFilter artÄ±k assets/js/filters/filter-manager.js'den geliyor
        
        // Eski kod kaldÄ±rÄ±ldÄ± - modÃ¼le taÅŸÄ±ndÄ± (assets/js/filters/filter-manager.js)

        
        // ==================== YIL YÃ–NETÄ°MÄ° ====================
        // YÄ±l yÃ¶netimi fonksiyonlarÄ± artÄ±k assets/js/data/data-loader.js modÃ¼lÃ¼nde
        // initializeYearToggles, toggleYear, removeYearDataOptimized, loadYearDataAndMergeOptimized,
        // updateYearToggleUI, updateDataStatusOptimized, updateDataStatus
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        
        // Eski kod kaldÄ±rÄ±ldÄ± - modÃ¼le taÅŸÄ±ndÄ± (assets/js/data/data-loader.js)
        
        // TÃœM YILLARI PARALEL YÃœKLE (Sadece seÃ§ili yÄ±llarÄ± yÃ¼kle)
        // loadAllYearsData fonksiyonu artÄ±k assets/js/features/dashboard.js'de
        // loadAllYearsDataOld() fonksiyonu artÄ±k assets/js/data/data-loader.js modÃ¼lÃ¼nden geliyor
        // loadRemainingYears() fonksiyonu artÄ±k assets/js/data/data-loader.js modÃ¼lÃ¼nden geliyor
        // loadInventoryData() fonksiyonu artÄ±k assets/js/data/data-loader.js modÃ¼lÃ¼nden geliyor
        // loadPaymentData() fonksiyonu artÄ±k assets/js/data/data-loader.js modÃ¼lÃ¼nden geliyor
        // Global eriÅŸim iÃ§in window'a ekleniyorlar

        // ==================== PAYMENTS ====================
        // Payment fonksiyonlarÄ± artÄ±k modÃ¼lde (assets/js/features/payments/payment-analyzer.js)
        
        // ==================== INVENTORY ANALYTICS ====================
        // Inventory Analytics fonksiyonlarÄ± artÄ±k modÃ¼lde:
        // - assets/js/features/analytics/inventory-analytics.js
        // getFilteredInventoryData, renderPriceComparisonChart, renderDiscountDistributionChart,
        // renderPriceAnalysisTable, renderStockAnalysisTable artÄ±k modÃ¼lde
        
        // Placeholder grafik fonksiyonlarÄ± kaldÄ±rÄ±ldÄ± (henÃ¼z implement edilmemiÅŸ, gerektiÄŸinde inventory-analytics.js'e eklenebilir)

        // ==================== ENVANTER FÄ°LTRELERÄ° ====================
        // Envanter filtre fonksiyonlarÄ± artÄ±k assets/js/features/analytics/inventory-analytics.js modÃ¼lÃ¼nde
        // populateInventoryFilters, showInventoryCategoryDropdown, hideInventoryCategoryDropdown,
        // filterInventoryCategories, clearInventoryDateFilters
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        
        // Eski kod kaldÄ±rÄ±ldÄ± - modÃ¼le taÅŸÄ±ndÄ± (assets/js/features/analytics/inventory-analytics.js)

        // Chart.js instances
        // Chart instance'larÄ± artÄ±k assets/js/charts/chart-manager.js'de

        // renderTable ve chart render fonksiyonlarÄ± artÄ±k modÃ¼llerde:
        // - assets/js/components/table-renderer.js
        // - assets/js/charts/sales-charts.js

        // ==================== TAB SYSTEM ====================
        // switchTab fonksiyonu artÄ±k assets/js/features/dashboard.js'de
        // switchTabOld fonksiyonu artÄ±k assets/js/core/tab-manager.js modÃ¼lÃ¼nden geliyor
        // Global eriÅŸim iÃ§in window'a ekleniyor
        
        // ==================== GÃœNLÃœK SATIÅ FONKSÄ°YONLARI ====================
        // GÃ¼nlÃ¼k satÄ±ÅŸ fonksiyonlarÄ± artÄ±k assets/js/features/sales/daily-sales.js modÃ¼lÃ¼nden geliyor
        // Global eriÅŸim iÃ§in window'a ekleniyor
        
        // ==================== EXCEL EXPORT ====================
        // exportToExcel fonksiyonu artÄ±k assets/js/services/export-service.js modÃ¼lÃ¼nde
        // Global eriÅŸim iÃ§in window.exportToExcel kullanÄ±labilir
        
        // ==================== VOICE SEARCH ====================
        // startVoiceSearch fonksiyonu artÄ±k assets/js/services/voice-service.js modÃ¼lÃ¼nde
        // Global eriÅŸim iÃ§in window.startVoiceSearch kullanÄ±labilir
        
        // ==================== TARGET TRACKING ====================
        // Hedef takip fonksiyonlarÄ± artÄ±k assets/js/features/targets/target-manager.js modÃ¼lÃ¼nden geliyor
        import('./assets/js/features/targets/target-manager.js').then(module => {
            window.loadAllStoresTargets = module.loadAllStoresTargets;
            window.populateTargetStoreDropdowns = module.populateTargetStoreDropdowns;
            window.renderYearlyTargetAnalysis = module.renderYearlyTargetAnalysis;
            window.performYearlyTargetAnalysis = module.performYearlyTargetAnalysis;
            window.getYearProgress = module.getYearProgress;
        });
        
        // ==================== CUSTOMER ANALYSIS ====================
        // MÃ¼ÅŸteri analizi fonksiyonlarÄ± artÄ±k modÃ¼lde:
        // - assets/js/features/customers/customer-analyzer.js
        // TÃ¼m fonksiyonlar window objesi Ã¼zerinden eriÅŸilebilir:
        // analyzeCustomers, populateCustomerStoreFilter, renderTopCustomers,
        // renderCustomerCityChart, renderCustomerTrendChart, searchCustomerProfileMain,
        // clearCustomerSearchMain, renderCustomerBrandChartMain, renderCustomerCategoryChartMain,
        // renderCustomerPurchaseHistoryMain, performCustomerAIAnalysisMain,
        // showCustomerSuggestions, handleCustomerKeydown

        // ==================== AI ANALYSIS & INSIGHTS ====================
        // AI analiz fonksiyonlarÄ± artÄ±k assets/js/features/ai/dashboard-ai-analyzer.js modÃ¼lÃ¼nde
        // performAIAnalysis, analyzeData, generateInsights
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        
        // Eski kod kaldÄ±rÄ±ldÄ± - modÃ¼le taÅŸÄ±ndÄ± (assets/js/features/ai/dashboard-ai-analyzer.js)

        // ==================== DASHBOARD ====================
        // Dashboard fonksiyonlarÄ± artÄ±k modÃ¼llerde:
        // - assets/js/features/dashboard/dashboard.js (loadDashboard)
        // - assets/js/charts/dashboard-charts.js (grafik fonksiyonlarÄ±)
        // - assets/js/features/ai/dashboard-ai-analyzer.js (AI analiz)
        
        // loadDashboard fonksiyonu artÄ±k modÃ¼lden geliyor
        // window.loadDashboard kullanÄ±labilir


        // ==================== TIME ANALYSIS ====================
        // Zaman analizi fonksiyonlarÄ± artÄ±k modÃ¼lde:
        // - assets/js/features/analytics/time-analytics.js
        // TÃ¼m fonksiyonlar window objesi Ã¼zerinden eriÅŸilebilir:
        // extractTimeInfo, analyzeTime, updateTimeSummary, renderHourlyChart,
        // renderMonthlyTrendChart, renderYearlyTrendChart, populateTimeFilters,
        // clearTimeFilters, renderStoreTimeChart, renderCategoryTimeChart,
        // renderSalesPersonTimeChart, performTimeAIAnalysis
        
        // Eski kod kaldÄ±rÄ±ldÄ± - modÃ¼le taÅŸÄ±ndÄ±

        // Load data on page load - KALDIRILDI
        // loadData() artÄ±k otomatik baÅŸlatma (satÄ±r 279-288) ve Firebase auth listener (satÄ±r 14934-14962) tarafÄ±ndan Ã§aÄŸrÄ±lÄ±yor
        // Burada tekrar Ã§aÄŸÄ±rmak gereksiz yÃ¼klemelere neden oluyordu
        
        // ==================== VERÄ° YÃ–NETÄ°MÄ° ====================
        
        // YÄ±l yÃ¼kleme kontrolÃ¼ iÃ§in
        let loadedYears = new Set();
        let loadedDataCache = {};
        
        // ==================== ÃœRÃœN ANALÄ°ZÄ° ====================
        // ÃœrÃ¼n analizi modÃ¼lÃ¼ artÄ±k assets/js/features/products/product-analyzer.js dosyasÄ±nda
        // TÃ¼m fonksiyonlar window.productAnalyzer objesi Ã¼zerinden eriÅŸilebilir
        
        // SatÄ±ÅŸ Temsilcisi tablosu sÄ±ralama iÃ§in
        let lastSalespersonTopProductsData = null;
        let currentSalespersonSortColumn = 'sales';
        let currentSalespersonSortDirection = 'desc';
        
        // MÃ¼ÅŸteri alÄ±ÅŸveriÅŸ geÃ§miÅŸi sÄ±ralama iÃ§in
        // ArtÄ±k modÃ¼lde: assets/js/features/customers/customer-analyzer.js
        
        // Kategori dropdown iÃ§in (inventory iÃ§in hala kullanÄ±lÄ±yor)
        let allCategories = [];
        let allCategoriesHierarchical = []; // HiyerarÅŸik kategori listesi
        
        // ÃœrÃ¼n analizi fonksiyonlarÄ± iÃ§in wrapper'lar (geriye uyumluluk)
        function initializeProductFilters() {
            if (window.productAnalyzer && window.productAnalyzer.initializeProductFilters) {
                return window.productAnalyzer.initializeProductFilters();
            }
        }
        
        function showProductCategoryDropdown() {
            if (window.productAnalyzer && window.productAnalyzer.showProductCategoryDropdown) {
                return window.productAnalyzer.showProductCategoryDropdown();
            }
        }
        
        function hideProductCategoryDropdown() {
            if (window.productAnalyzer && window.productAnalyzer.hideProductCategoryDropdown) {
                return window.productAnalyzer.hideProductCategoryDropdown();
            }
        }
        
        function filterProductCategories() {
            if (window.productAnalyzer && window.productAnalyzer.filterProductCategories) {
                return window.productAnalyzer.filterProductCategories();
            }
        }
        
        function selectProductCategory(category) {
            if (window.productAnalyzer && window.productAnalyzer.selectProductCategory) {
                return window.productAnalyzer.selectProductCategory(category);
            }
        }
        
        function clearProductDateFilters() {
            if (window.productAnalyzer && window.productAnalyzer.clearProductDateFilters) {
                return window.productAnalyzer.clearProductDateFilters();
            }
        }
        
        function searchProduct() {
            if (window.productAnalyzer && window.productAnalyzer.searchProduct) {
                return window.productAnalyzer.searchProduct();
            }
        }
        
        function renderProductStoreChart(data) {
            if (window.productAnalyzer && window.productAnalyzer.renderProductStoreChart) {
                return window.productAnalyzer.renderProductStoreChart(data);
            }
        }
        
        function renderProductCityChart(data) {
            if (window.productAnalyzer && window.productAnalyzer.renderProductCityChart) {
                return window.productAnalyzer.renderProductCityChart(data);
            }
        }
        
        function renderProductDistrictChart(data) {
            if (window.productAnalyzer && window.productAnalyzer.renderProductDistrictChart) {
                return window.productAnalyzer.renderProductDistrictChart(data);
            }
        }
        
        function renderProductSalesPersonChart(data) {
            if (window.productAnalyzer && window.productAnalyzer.renderProductSalesPersonChart) {
                return window.productAnalyzer.renderProductSalesPersonChart(data);
            }
        }
        
        function renderProductMonthlyChart(data) {
            if (window.productAnalyzer && window.productAnalyzer.renderProductMonthlyChart) {
                return window.productAnalyzer.renderProductMonthlyChart(data);
            }
        }
        
        function renderProductDetailTable(data = null, sortColumn = null, sortDirection = null) {
            if (window.productAnalyzer && window.productAnalyzer.renderProductDetailTable) {
                return window.productAnalyzer.renderProductDetailTable(data, sortColumn, sortDirection);
            }
        }
        
        function performProductAIAnalysis(data) {
            if (window.productAnalyzer && window.productAnalyzer.performProductAIAnalysis) {
                return window.productAnalyzer.performProductAIAnalysis(data);
            }
        }
        
        // Eski render fonksiyonlarÄ± kaldÄ±rÄ±ldÄ± - modÃ¼le taÅŸÄ±ndÄ± (assets/js/features/products/product-analyzer.js)
        
        // ==================== GPT BACKEND ENTEGRASYONU ====================
        // GPT API fonksiyonlarÄ± artÄ±k assets/js/features/ai/dashboard-ai-analyzer.js modÃ¼lÃ¼nde
        // checkMonthlyReset, updateQueryCost, callGPTAPI, showCostStats
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        // window.showGPTStats ve window.resetGPTStats da modÃ¼lden geliyor
        
        // Eski kod kaldÄ±rÄ±ldÄ± - modÃ¼le taÅŸÄ±ndÄ± (assets/js/features/ai/dashboard-ai-analyzer.js)
        
        // ==================== SATIÅ TEMSÄ°LCÄ°SÄ° FONKSÄ°YONLARI ====================
        // SatÄ±ÅŸ temsilcisi fonksiyonlarÄ± artÄ±k assets/js/features/stores/store-analyzer.js modÃ¼lÃ¼nde
        // renderSalespersonMonthlyChart, renderSalespersonTopProducts, renderSalespersonBottomProducts,
        // renderSalespersonComparisonTable, renderSalespersonComparisonCharts, performSalespersonAIAnalysis
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        
        // ==================== MOBÄ°L: TABLE SCROLL HINT ==================== 
        // Tablolar ilk kaydÄ±rÄ±ldÄ±ÄŸÄ±nda "â† KaydÄ±rÄ±n â†’" mesajÄ±nÄ± gizle
        // MEMORY LEAK FIX: Scroll event listener'larÄ±nÄ± kaydet ve cleanup iÃ§in hazÄ±rla
        const tableScrollListeners = new Map(); // MEMORY LEAK FIX: Table ve listener eÅŸleÅŸmesini sakla
        
        function initMobileTableScrollHint() {
            if (window.innerWidth <= 768) {
                const tables = document.querySelectorAll('table');
                tables.forEach(table => {
                    // MEMORY LEAK FIX: EÄŸer bu table iÃ§in zaten bir listener varsa, Ã¶nce temizle
                    if (tableScrollListeners.has(table)) {
                        const existingHandler = tableScrollListeners.get(table);
                        table.removeEventListener('scroll', existingHandler);
                        tableScrollListeners.delete(table);
                    }
                    
                    // MEMORY LEAK FIX: Event handler fonksiyonunu tanÄ±mla ve kaydet
                    const scrollHandler = function() {
                        this.classList.add('scrolled');
                        // MEMORY LEAK FIX: { once: true } kullanÄ±ldÄ±ÄŸÄ± iÃ§in listener otomatik temizlenir,
                        // ama yine de Map'ten kaldÄ±ralÄ±m
                        tableScrollListeners.delete(this);
                    };
                    
                    table.addEventListener('scroll', scrollHandler, { once: true });
                    tableScrollListeners.set(table, scrollHandler);
                });
            }
        }
        
        // MEMORY LEAK FIX: Sayfa kapatÄ±ldÄ±ÄŸÄ±nda scroll listener'larÄ±nÄ± temizle (sadece bir kez ekle)
        if (!window.tableScrollListenersCleanupAdded) {
            window.addEventListener('beforeunload', function() {
                tableScrollListeners.forEach((handler, table) => {
                    table.removeEventListener('scroll', handler);
                });
                tableScrollListeners.clear();
            });
            window.tableScrollListenersCleanupAdded = true;
        }
        
        // Loading System
        let loadingProgress = 0;
        let loadingSteps = [
            { id: 'step1', text: 'ğŸ”„ Sayfa baÅŸlatÄ±lÄ±yor...', progress: 10 },
            { id: 'step2', text: 'ğŸ“Š Veri dosyalarÄ± yÃ¼kleniyor...', progress: 40 },
            { id: 'step3', text: 'ğŸ¯ Hedefler yÃ¼kleniyor...', progress: 70 },
            { id: 'step4', text: 'âœ… HazÄ±rlanÄ±yor...', progress: 100 }
        ];
        
        function updateLoadingProgress(stepIndex, customProgress = null) {
            const step = loadingSteps[stepIndex];
            const progress = customProgress !== null ? customProgress : step.progress;
            
            // Progress bar gÃ¼ncelle
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '%';
            
            // Step gÃ¶ster/gizle ve aktif step'i vurgula
            loadingSteps.forEach((s, index) => {
                const stepElement = document.getElementById(s.id);
                if (stepElement) {
                    if (index <= stepIndex) {
                        stepElement.style.display = 'block';
                        if (index === stepIndex) {
                            stepElement.style.opacity = '1';
                            stepElement.style.color = '#4ade80';
                            stepElement.style.transform = 'scale(1.05)';
                        } else {
                            stepElement.style.opacity = '0.7';
                            stepElement.style.color = 'white';
                            stepElement.style.transform = 'scale(1)';
                        }
                    } else {
                        stepElement.style.display = 'none';
                    }
                }
            });
            
            // EÄŸer %100'e ulaÅŸtÄ±ysak loading'i gizle
            if (progress >= 100) {
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.opacity = '0';
                    document.getElementById('loadingScreen').style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        document.getElementById('mainContainer').style.display = 'block';
                    }, 500);
                }, 500);
            }
        }
        
        // checkLoadingComplete fonksiyonu artÄ±k assets/js/features/dashboard.js'de
        function checkLoadingCompleteOld() {
            let progress = 0;
            if (dataLoadProgress.pageInit) progress += 25;
            if (dataLoadProgress.dataFiles) progress += 50;
            if (dataLoadProgress.targets) progress += 20;
            if (dataLoadProgress.ready) progress += 5;
            
            // Progress'i gÃ¼ncelle
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '%';
            
            // Step'leri gÃ¼ncelle
            if (dataLoadProgress.pageInit) {
                document.getElementById('step1').style.display = 'block';
                document.getElementById('step1').style.opacity = '1';
                document.getElementById('step1').style.color = '#4ade80';
            }
            
            if (dataLoadProgress.dataFiles) {
                document.getElementById('step2').style.display = 'block';
                document.getElementById('step2').style.opacity = '1';
                document.getElementById('step2').style.color = '#4ade80';
            }
            
            if (dataLoadProgress.targets) {
                document.getElementById('step3').style.display = 'block';
                document.getElementById('step3').style.opacity = '1';
                document.getElementById('step3').style.color = '#4ade80';
            }
            
            if (dataLoadProgress.ready) {
                document.getElementById('step4').style.display = 'block';
                document.getElementById('step4').style.opacity = '1';
                document.getElementById('step4').style.color = '#4ade80';
                
                // %100'e ulaÅŸtÄ±ysak loading'i gizle
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.opacity = '0';
                    document.getElementById('loadingScreen').style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        document.getElementById('mainContainer').style.display = 'block';
                    }, 500);
                }, 500);
            }
        }
        
        function startRealLoading() {
            // EÄŸer veri zaten yÃ¼klendiyse, tekrar yÃ¼kleme
            if (window.dataLoaded) {
                safeConsole.log('âœ… Veri zaten yÃ¼klÃ¼, Firebase auth tetiklemesi atlandÄ±');
                return;
            }
            
            // EÄŸer zaten yÃ¼kleme devam ediyorsa, tekrar baÅŸlatma
            if (window.isLoadingData) {
                safeConsole.log('â¸ï¸ Veri yÃ¼kleme zaten devam ediyor, atlanÄ±yor...');
                return;
            }
            
            safeConsole.log('ğŸš€ Veri yÃ¼kleme baÅŸlatÄ±lÄ±yor...');
            
            // Step 2: Sayfa baÅŸlatÄ±lÄ±yor
            if (typeof window.dataLoadProgress !== 'undefined') {
                window.dataLoadProgress.pageInit = true;
                if (typeof window.checkLoadingComplete === 'function') {
                    window.checkLoadingComplete();
                }
            }
            
            // GerÃ§ek veri yÃ¼kleme iÅŸlemini baÅŸlat
            if (typeof window.loadData === 'function') {
                window.loadData();
            } else {
                console.error('âŒ loadData fonksiyonu bulunamadÄ±');
            }
        }

        // ===== FIREBASE AUTHENTICATION FONKSÄ°YONLARI =====
        
        function hideLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'none';
            }
            
            const errorEl = document.getElementById('loginError');
            if (errorEl) {
                errorEl.style.display = 'none';
                errorEl.textContent = '';
            }
            const successEl = document.getElementById('loginSuccess');
            if (successEl) {
                successEl.style.display = 'none';
                successEl.textContent = '';
            }
            const emailEl = document.getElementById('loginEmail');
            const passwordEl = document.getElementById('loginPassword');
            if (emailEl) emailEl.value = '';
            if (passwordEl) passwordEl.value = '';
            
            // Body scroll'u geri aÃ§
            document.body.style.overflow = '';
        }
        
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            const loadingScreen = document.getElementById('loadingScreen');
            const mainContainer = document.getElementById('mainContainer');
            
            // Modal'Ä± gÃ¶ster
            if (modal) {
                modal.style.display = 'flex';
            }
            
            // Loading screen'i kesinlikle gizle
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
            
            // Main container'Ä± kesinlikle gizle
            if (mainContainer) {
                mainContainer.style.display = 'none';
            }
            
            // Body scroll'u engelle
            document.body.style.overflow = 'hidden';
        }
        
        async function handleLogin() {
            const emailEl = document.getElementById('loginEmail');
            const passwordEl = document.getElementById('loginPassword');
            const errorEl = document.getElementById('loginError');
            
            if (!emailEl || !passwordEl) {
                console.error('âŒ Login form elementleri bulunamadÄ±');
                return;
            }
            
            const email = emailEl.value.trim();
            const password = passwordEl.value;
            
            // GÃ¼venlik: Input validation ve sanitization
            if (!email || !password) {
                if (errorEl) {
                    errorEl.textContent = 'LÃ¼tfen e-posta ve ÅŸifre girin.';
                    errorEl.style.display = 'block';
                }
                return;
            }
            
            // GÃ¼venlik: Email format validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                if (errorEl) {
                    errorEl.textContent = 'GeÃ§erli bir e-posta adresi girin.';
                    errorEl.style.display = 'block';
                }
                return;
            }
            
            // GÃ¼venlik: XSS korumasÄ± - HTML karakterlerini filtrele
            const sanitizedEmail = email.replace(/[<>]/g, '');
            if (sanitizedEmail !== email) {
                if (errorEl) {
                    errorEl.textContent = 'GeÃ§ersiz karakterler tespit edildi.';
                    errorEl.style.display = 'block';
                }
                return;
            }
            
            // GÃ¼venlik: Password minimum uzunluk kontrolÃ¼
            if (password.length < 6) {
                if (errorEl) {
                    errorEl.textContent = 'Åifre en az 6 karakter olmalÄ±dÄ±r.';
                    errorEl.style.display = 'block';
                }
                return;
            }
            
            // GÃ¼venlik: Rate limiting iÃ§in basit kontrol (localStorage kullanarak)
            const loginAttemptsKey = 'loginAttempts';
            const maxAttempts = 5;
            const lockoutTime = 15 * 60 * 1000; // 15 dakika
            
            try {
                const attemptsData = JSON.parse(localStorage.getItem(loginAttemptsKey) || '{"count": 0, "lastAttempt": 0}');
                const now = Date.now();
                
                // Lockout sÃ¼resi dolmuÅŸ mu kontrol et
                if (attemptsData.lastAttempt + lockoutTime < now) {
                    attemptsData.count = 0;
                }
                
                // Ã‡ok fazla deneme yapÄ±ldÄ± mÄ±?
                if (attemptsData.count >= maxAttempts) {
                    const remainingTime = Math.ceil((lockoutTime - (now - attemptsData.lastAttempt)) / 60000);
                    if (errorEl) {
                        errorEl.textContent = `Ã‡ok fazla baÅŸarÄ±sÄ±z deneme. LÃ¼tfen ${remainingTime} dakika sonra tekrar deneyin.`;
                        errorEl.style.display = 'block';
                    }
                    return;
                }
            } catch (e) {
                // localStorage hatasÄ± - sessizce devam et
                safeConsole.warn('Rate limiting kontrolÃ¼ atlandÄ±');
            }
            
            try {
                if (errorEl) errorEl.style.display = 'none';
                
                // Firebase SDK'nÄ±n yÃ¼klenmesini bekle
                if (!window.firebaseAuth || !window.firebaseSignIn) {
                    console.error('âŒ Firebase SDK henÃ¼z yÃ¼klenmedi');
                    if (errorEl) {
                        errorEl.textContent = 'Firebase yÃ¼kleniyor, lÃ¼tfen bekleyin...';
                        errorEl.style.display = 'block';
                    }
                    setTimeout(() => handleLogin(), 1000);
                    return;
                }
                
                // 1. Firebase'de login yap
                const userCredential = await window.firebaseSignIn(window.firebaseAuth, email, password);
                const firebaseToken = await userCredential.user.getIdToken();
                
                // Firebase authentication yeterli - server-side auth kaldÄ±rÄ±ldÄ±
                
                // 3. Login zamanÄ±nÄ± kaydet (24 saatlik session iÃ§in)
                localStorage.setItem('lastLoginTime', Date.now().toString());
                // Eski session yÃ¶netimi kaldÄ±rÄ±ldÄ± - Firebase authentication yeterli
                
                hideLoginModal();
                
                // GÃ¼venlik: BaÅŸarÄ±lÄ± giriÅŸte rate limiting sayacÄ±nÄ± sÄ±fÄ±rla
                try {
                    localStorage.removeItem('loginAttempts');
                } catch (e) {}
                
                safeConsole.log('âœ… GiriÅŸ baÅŸarÄ±lÄ± (Firebase)');
            } catch (error) {
                // GÃ¼venlik: BaÅŸarÄ±sÄ±z giriÅŸte rate limiting sayacÄ±nÄ± artÄ±r
                try {
                    const attemptsData = JSON.parse(localStorage.getItem('loginAttempts') || '{"count": 0, "lastAttempt": 0}');
                    attemptsData.count += 1;
                    attemptsData.lastAttempt = Date.now();
                    localStorage.setItem('loginAttempts', JSON.stringify(attemptsData));
                } catch (e) {}
                // GÃ¼venlik: Hassas bilgi iÃ§eren hatalarÄ± filtrele
                safeConsole.error('âŒ GiriÅŸ hatasÄ±:', sanitizeForLogging(error));
                
                if (errorEl) {
                    let errorMessage = 'GiriÅŸ baÅŸarÄ±sÄ±z. E-posta ve ÅŸifrenizi kontrol edin.';
                    
                    // Firebase auth hatalarÄ± (gÃ¼venli mesajlar)
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'Bu e-posta adresi kayÄ±tlÄ± deÄŸil.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Åifre yanlÄ±ÅŸ.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'GeÃ§ersiz e-posta adresi.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Ã‡ok fazla baÅŸarÄ±sÄ±z deneme. LÃ¼tfen daha sonra tekrar deneyin.';
                    } 
                    // Network/server hatalarÄ± (gÃ¼venli mesajlar)
                    else if (error.message && error.message.includes('eriÅŸilemiyor')) {
                        errorMessage = 'Kimlik doÄŸrulama sunucusuna eriÅŸilemiyor. LÃ¼tfen internet baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                    } else if (error.message && error.message.includes('Failed to fetch')) {
                        errorMessage = 'Kimlik doÄŸrulama sunucusuna baÄŸlanÄ±lamÄ±yor. LÃ¼tfen internet baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
                    }
                    // DiÄŸer hatalar iÃ§in genel mesaj (hassas bilgi iÃ§ermez)
                    // error.message direkt gÃ¶sterilmez (gÃ¼venlik iÃ§in)
                    
                    errorEl.textContent = errorMessage;
                    errorEl.style.display = 'block';
                }
            }
        }
        
        async function handleLogout() {
            try {
                // 1. Firebase'den Ã§Ä±kÄ±ÅŸ yap
                if (window.firebaseAuth && window.firebaseSignOut) {
                    await window.firebaseSignOut(window.firebaseAuth);
                }
                
                safeConsole.log('âœ… Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ± (Firebase)');
            } catch (error) {
                console.error('âŒ Ã‡Ä±kÄ±ÅŸ hatasÄ±:', error);
                alert('Ã‡Ä±kÄ±ÅŸ yapÄ±lÄ±rken bir hata oluÅŸtu: ' + error.message);
            }
        }
        
        async function handleForgotPassword() {
            const emailEl = document.getElementById('loginEmail');
            const errorEl = document.getElementById('loginError');
            const successEl = document.getElementById('loginSuccess');
            
            // Email kontrolÃ¼
            if (!emailEl || !emailEl.value.trim()) {
                if (errorEl) {
                    errorEl.textContent = 'LÃ¼tfen e-posta adresinizi girin.';
                    errorEl.style.display = 'block';
                }
                if (successEl) successEl.style.display = 'none';
                emailEl?.focus();
                return;
            }
            
            const email = emailEl.value.trim();
            
            // Email format kontrolÃ¼
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                if (errorEl) {
                    errorEl.textContent = 'GeÃ§erli bir e-posta adresi girin.';
                    errorEl.style.display = 'block';
                }
                if (successEl) successEl.style.display = 'none';
                return;
            }
            
            try {
                if (!window.firebaseAuth || !window.firebaseSendPasswordResetEmail) {
                    safeConsole.error('âŒ Firebase SDK henÃ¼z yÃ¼klenmedi');
                    if (errorEl) {
                        errorEl.textContent = 'Firebase yÃ¼kleniyor, lÃ¼tfen bekleyin...';
                        errorEl.style.display = 'block';
                    }
                    setTimeout(() => handleForgotPassword(), 1000);
                    return;
                }
                
                if (errorEl) errorEl.style.display = 'none';
                if (successEl) successEl.style.display = 'none';
                
                safeConsole.log('ğŸ“§ Åifre sÄ±fÄ±rlama e-postasÄ± gÃ¶nderiliyor...', email);
                
                await window.firebaseSendPasswordResetEmail(window.firebaseAuth, email);
                
                // BaÅŸarÄ± mesajÄ± gÃ¶ster
                if (successEl) {
                    successEl.textContent = `âœ… Åifre sÄ±fÄ±rlama linki ${email} adresine gÃ¶nderildi. LÃ¼tfen e-postanÄ±zÄ± kontrol edin (Spam klasÃ¶rÃ¼nÃ¼ de kontrol edin).`;
                    successEl.style.display = 'block';
                }
                
                safeConsole.log('âœ… Åifre sÄ±fÄ±rlama e-postasÄ± gÃ¶nderildi:', email);
            } catch (error) {
                safeConsole.error('âŒ Åifre sÄ±fÄ±rlama hatasÄ±:', error);
                if (errorEl) {
                    let errorMessage = 'Åifre sÄ±fÄ±rlama e-postasÄ± gÃ¶nderilemedi.';
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'Bu e-posta adresi kayÄ±tlÄ± deÄŸil.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'GeÃ§ersiz e-posta adresi.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Ã‡ok fazla istek gÃ¶nderildi. LÃ¼tfen daha sonra tekrar deneyin.';
                    } else if (error.message) {
                        errorMessage = `Hata: ${error.message}`;
                    }
                    errorEl.textContent = errorMessage;
                    errorEl.style.display = 'block';
                }
                if (successEl) successEl.style.display = 'none';
            }
        }
        
        async function updateAuthUI(user) {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const userName = document.getElementById('currentUserName');
            const mainContainer = document.getElementById('mainContainer');
            const loadingScreen = document.getElementById('loadingScreen');
            
            // Server-side token kontrolÃ¼ (HER updateAuthUI Ã§aÄŸrÄ±sÄ±nda)
            // Not: Auth server eriÅŸilemiyorsa Firebase auth ile devam edilir
            if (user) {
                // Firebase authentication yeterli - server-side token kontrolÃ¼ kaldÄ±rÄ±ldÄ±
            }
            
            if (user) {
                // KullanÄ±cÄ± giriÅŸ yapmÄ±ÅŸ
                if (loginBtn) loginBtn.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'flex';
                
                const email = user.email || 'KullanÄ±cÄ±';
                const userAvatar = document.getElementById('userAvatar');
                const userInitial = userAvatar?.querySelector('.user-initial');
                
                // Avatar initial extraction
                if (userInitial && email && email !== 'KullanÄ±cÄ±') {
                    // Email'den initial al (ilk harf veya ilk 2 harf)
                    const emailParts = email.split('@')[0];
                    let initial = '';
                    if (emailParts.length >= 2) {
                        initial = emailParts.substring(0, 2).toUpperCase();
                    } else {
                        initial = emailParts.substring(0, 1).toUpperCase();
                    }
                    userInitial.textContent = initial;
                } else if (userInitial) {
                    userInitial.textContent = 'U';
                }
                
                // Email badge gÃ¼ncelle
                if (userName) {
                    const fullEmail = email;
                    // Email'i truncate et (max 25 karakter)
                    let displayEmail = fullEmail;
                    if (fullEmail.length > 25) {
                        displayEmail = fullEmail.substring(0, 22) + '...';
                    }
                    userName.textContent = displayEmail;
                    userName.setAttribute('data-full-email', fullEmail);
                    userName.style.display = 'inline-block';
                }
                // Ana iÃ§eriÄŸi gÃ¶ster
                if (mainContainer) {
                    mainContainer.style.display = 'block';
                }
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                // Login modal'Ä± gizle
                const modal = document.getElementById('loginModal');
                if (modal) {
                    modal.style.display = 'none';
                }
                
                // Body scroll'u geri aÃ§
                document.body.style.overflow = '';
            } else {
                // KullanÄ±cÄ± giriÅŸ yapmamÄ±ÅŸ
                if (loginBtn) loginBtn.style.display = 'flex';
                if (logoutBtn) logoutBtn.style.display = 'none';
                if (userName) {
                    userName.style.display = 'none';
                    userName.removeAttribute('data-full-email');
                }
                // Avatar'Ä± resetle
                const userAvatar = document.getElementById('userAvatar');
                const userInitial = userAvatar?.querySelector('.user-initial');
                if (userInitial) {
                    userInitial.textContent = 'U';
                }
                
                // TÃœM Ä°Ã‡ERÄ°ÄÄ° KESÄ°NLÄ°KLE GÄ°ZLE
                if (mainContainer) {
                    mainContainer.style.display = 'none';
                }
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                // Body scroll'u engelle
                document.body.style.overflow = 'hidden';
                
                // Login modal'Ä± gÃ¶ster
                showLoginModal();
            }
        }
        
        // Firebase authentication yeterli - verifyServerToken fonksiyonu kaldÄ±rÄ±ldÄ±
        
        // Firebase Auth listener cleanup iÃ§in global deÄŸiÅŸkenler
        let firebaseAuthUnsubscribe = null;
        let firebaseAuthInitTimeout = null;
        let firebaseAuthInitAttempts = 0;
        const MAX_FIREBASE_AUTH_INIT_ATTEMPTS = 20; // Maksimum 10 saniye (20 * 500ms)
        
        // Firebase Auth state listener - SDK yÃ¼klendiÄŸinde Ã§alÄ±ÅŸacak
        function initFirebaseAuth() {
            // MEMORY LEAK FIX: EÄŸer zaten bir listener varsa, Ã¶nce temizle
            if (firebaseAuthUnsubscribe) {
                safeConsole.log('ğŸ”„ Mevcut Firebase Auth listener temizleniyor...');
                firebaseAuthUnsubscribe();
                firebaseAuthUnsubscribe = null;
            }
            
            // MEMORY LEAK FIX: EÄŸer pending timeout varsa, temizle
            if (firebaseAuthInitTimeout) {
                clearTimeout(firebaseAuthInitTimeout);
                firebaseAuthInitTimeout = null;
            }
            
            if (!window.firebaseAuth || !window.firebaseOnAuthStateChanged) {
                // Firebase SDK henÃ¼z yÃ¼klenmedi, tekrar dene
                firebaseAuthInitAttempts++;
                
                // MEMORY LEAK FIX: Maksimum deneme sayÄ±sÄ±nÄ± kontrol et
                if (firebaseAuthInitAttempts >= MAX_FIREBASE_AUTH_INIT_ATTEMPTS) {
                    safeConsole.warn('âš ï¸ Firebase Auth SDK yÃ¼klenemedi (maksimum deneme sayÄ±sÄ±na ulaÅŸÄ±ldÄ±)');
                    return;
                }
                
                // MEMORY LEAK FIX: Timeout ID'sini kaydet
                firebaseAuthInitTimeout = setTimeout(() => {
                    firebaseAuthInitTimeout = null;
                    initFirebaseAuth();
                }, 500);
                return;
            }
            
            // SDK yÃ¼klendi, deneme sayacÄ±nÄ± sÄ±fÄ±rla
            firebaseAuthInitAttempts = 0;
            safeConsole.log('âœ… Firebase Auth listener baÅŸlatÄ±lÄ±yor...');
            
            // MEMORY LEAK FIX: Unsubscribe fonksiyonunu kaydet
            firebaseAuthUnsubscribe = window.firebaseOnAuthStateChanged(window.firebaseAuth, async (user) => {
                safeConsole.log('ğŸ” Auth state deÄŸiÅŸti:', user ? user.email : 'Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±');
                
                // Firebase authentication yeterli - server-side token kontrolÃ¼ kaldÄ±rÄ±ldÄ±
                
                await updateAuthUI(user);
                
                // KullanÄ±cÄ± giriÅŸ yaptÄ±ysa veri yÃ¼kleme baÅŸlat
                if (user) {
                    // Biraz bekle (UI gÃ¼ncellensin)
                    setTimeout(() => {
                        // EÄŸer veri zaten yÃ¼klendiyse tekrar yÃ¼kleme
                        if (window.dataLoaded) {
                            safeConsole.log('âœ… Veri zaten yÃ¼klÃ¼, Firebase auth tetiklemesi atlandÄ±');
                            return;
                        }
                        
                        // EÄŸer zaten yÃ¼kleme devam ediyorsa tekrar baÅŸlatma
                        if (window.isLoadingData) {
                            safeConsole.log('â¸ï¸ Veri yÃ¼kleme zaten devam ediyor, Firebase auth tetiklemesi atlandÄ±');
                            return;
                        }
                        
                        // Veri yÃ¼kleme baÅŸlat
                        startRealLoading();
                    }, 300);
                }
            });
        }
        
        // MEMORY LEAK FIX: Cleanup fonksiyonu - sayfa kapatÄ±ldÄ±ÄŸÄ±nda veya gerektiÄŸinde Ã§aÄŸrÄ±labilir
        function cleanupFirebaseAuth() {
            if (firebaseAuthUnsubscribe) {
                firebaseAuthUnsubscribe();
                firebaseAuthUnsubscribe = null;
                safeConsole.log('ğŸ§¹ Firebase Auth listener temizlendi');
            }
            if (firebaseAuthInitTimeout) {
                clearTimeout(firebaseAuthInitTimeout);
                firebaseAuthInitTimeout = null;
            }
        }
        
        // MEMORY LEAK FIX: Sayfa kapatÄ±ldÄ±ÄŸÄ±nda cleanup yap
        window.addEventListener('beforeunload', cleanupFirebaseAuth);
        
        // Sayfa yÃ¼klendiÄŸinde Firebase Auth'u baÅŸlat
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initFirebaseAuth);
        } else {
            initFirebaseAuth();
        }
        
        // Enter tuÅŸu ile login
        // MEMORY LEAK FIX: Login form event listener'larÄ±nÄ± kaydet ve cleanup iÃ§in hazÄ±rla
        let loginEmailInputHandler = null;
        let loginPasswordInputHandler = null;
        let loginEmailInputElement = null;
        let loginPasswordInputElement = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            const emailInput = document.getElementById('loginEmail');
            const passwordInput = document.getElementById('loginPassword');
            
            // MEMORY LEAK FIX: EÄŸer zaten listener'lar varsa, Ã¶nce temizle
            if (loginEmailInputHandler && loginEmailInputElement) {
                loginEmailInputElement.removeEventListener('keypress', loginEmailInputHandler);
            }
            if (loginPasswordInputHandler && loginPasswordInputElement) {
                loginPasswordInputElement.removeEventListener('keypress', loginPasswordInputHandler);
            }
            
            // MEMORY LEAK FIX: Event handler fonksiyonlarÄ±nÄ± tanÄ±mla ve kaydet
            if (emailInput) {
                loginEmailInputHandler = function(e) {
                    if (e.key === 'Enter') {
                        passwordInput?.focus();
                    }
                };
                emailInput.addEventListener('keypress', loginEmailInputHandler);
                loginEmailInputElement = emailInput;
            }
            
            if (passwordInput) {
                loginPasswordInputHandler = function(e) {
                    if (e.key === 'Enter') {
                        handleLogin();
                    }
                };
                passwordInput.addEventListener('keypress', loginPasswordInputHandler);
                loginPasswordInputElement = passwordInput;
            }
        });
        
        // MEMORY LEAK FIX: Sayfa kapatÄ±ldÄ±ÄŸÄ±nda login form listener'larÄ±nÄ± temizle (sadece bir kez ekle)
        if (!window.loginFormListenersCleanupAdded) {
            window.addEventListener('beforeunload', function() {
                if (loginEmailInputHandler && loginEmailInputElement) {
                    loginEmailInputElement.removeEventListener('keypress', loginEmailInputHandler);
                    loginEmailInputHandler = null;
                    loginEmailInputElement = null;
                }
                if (loginPasswordInputHandler && loginPasswordInputElement) {
                    loginPasswordInputElement.removeEventListener('keypress', loginPasswordInputHandler);
                    loginPasswordInputHandler = null;
                    loginPasswordInputElement = null;
                }
            });
            window.loginFormListenersCleanupAdded = true;
        }

        // Sayfa yÃ¼klendiÄŸinde ve tab deÄŸiÅŸtiÄŸinde Ã§alÄ±ÅŸtÄ±r
        document.addEventListener('DOMContentLoaded', function() {
            // Auth kontrolÃ¼ yukarÄ±daki listener tarafÄ±ndan yapÄ±lacak
            // Burada sadece diÄŸer baÅŸlangÄ±Ã§ iÅŸlemlerini yap
            
            initMobileTableScrollHint();
            
            // SatÄ±ÅŸ temsilcisi filtre event listener'larÄ±
            // MEMORY LEAK FIX: Event listener'larÄ± kaydet ve cleanup iÃ§in hazÄ±rla
            const yearSelect = document.getElementById('filterSalespersonYearSelect');
            const monthSelect = document.getElementById('filterSalespersonMonthSelect');
            const daySelect = document.getElementById('filterSalespersonDaySelect');
            const clearBtn = document.getElementById('clearSalespersonFiltersBtn');
            
            // MEMORY LEAK FIX: Event handler fonksiyonlarÄ±nÄ± tanÄ±mla (removeEventListener iÃ§in)
            const yearSelectHandler = function() {
                if (window.applySalespersonFilters) {
                    window.applySalespersonFilters();
                }
            };
            
            const monthSelectHandler = function() {
                if (window.applySalespersonFilters) {
                    window.applySalespersonFilters();
                }
            };
            
            const daySelectHandler = function() {
                if (window.applySalespersonFilters) {
                    window.applySalespersonFilters();
                }
            };
            
            const clearBtnHandler = function() {
                if (window.clearSalespersonFilters) {
                    window.clearSalespersonFilters();
                }
            };
            
            // MEMORY LEAK FIX: EÄŸer zaten listener'lar varsa, Ã¶nce temizle
            if (window.salespersonFilterListeners) {
                if (window.salespersonFilterListeners.yearSelect && window.salespersonFilterListeners.yearSelectElement) {
                    window.salespersonFilterListeners.yearSelectElement.removeEventListener('change', window.salespersonFilterListeners.yearSelect);
                }
                if (window.salespersonFilterListeners.monthSelect && window.salespersonFilterListeners.monthSelectElement) {
                    window.salespersonFilterListeners.monthSelectElement.removeEventListener('change', window.salespersonFilterListeners.monthSelect);
                }
                if (window.salespersonFilterListeners.daySelect && window.salespersonFilterListeners.daySelectElement) {
                    window.salespersonFilterListeners.daySelectElement.removeEventListener('change', window.salespersonFilterListeners.daySelect);
                }
                if (window.salespersonFilterListeners.clearBtn && window.salespersonFilterListeners.clearBtnElement) {
                    window.salespersonFilterListeners.clearBtnElement.removeEventListener('click', window.salespersonFilterListeners.clearBtn);
                }
            }
            
            // MEMORY LEAK FIX: Listener'larÄ± ekle ve kaydet
            if (yearSelect) {
                yearSelect.addEventListener('change', yearSelectHandler);
                if (!window.salespersonFilterListeners) {
                    window.salespersonFilterListeners = {};
                }
                window.salespersonFilterListeners.yearSelect = yearSelectHandler;
                window.salespersonFilterListeners.yearSelectElement = yearSelect;
            }
            
            if (monthSelect) {
                monthSelect.addEventListener('change', monthSelectHandler);
                if (!window.salespersonFilterListeners) {
                    window.salespersonFilterListeners = {};
                }
                window.salespersonFilterListeners.monthSelect = monthSelectHandler;
                window.salespersonFilterListeners.monthSelectElement = monthSelect;
            }
            
            if (daySelect) {
                daySelect.addEventListener('change', daySelectHandler);
                if (!window.salespersonFilterListeners) {
                    window.salespersonFilterListeners = {};
                }
                window.salespersonFilterListeners.daySelect = daySelectHandler;
                window.salespersonFilterListeners.daySelectElement = daySelect;
            }
            
            if (clearBtn) {
                clearBtn.addEventListener('click', clearBtnHandler);
                if (!window.salespersonFilterListeners) {
                    window.salespersonFilterListeners = {};
                }
                window.salespersonFilterListeners.clearBtn = clearBtnHandler;
                window.salespersonFilterListeners.clearBtnElement = clearBtn;
            }
            
            // MEMORY LEAK FIX: Sayfa kapatÄ±ldÄ±ÄŸÄ±nda listener'larÄ± temizle (sadece bir kez ekle)
            if (!window.salespersonFilterListenersCleanupAdded) {
                window.addEventListener('beforeunload', function() {
                    if (window.salespersonFilterListeners) {
                        if (window.salespersonFilterListeners.yearSelect && window.salespersonFilterListeners.yearSelectElement) {
                            window.salespersonFilterListeners.yearSelectElement.removeEventListener('change', window.salespersonFilterListeners.yearSelect);
                        }
                        if (window.salespersonFilterListeners.monthSelect && window.salespersonFilterListeners.monthSelectElement) {
                            window.salespersonFilterListeners.monthSelectElement.removeEventListener('change', window.salespersonFilterListeners.monthSelect);
                        }
                        if (window.salespersonFilterListeners.daySelect && window.salespersonFilterListeners.daySelectElement) {
                            window.salespersonFilterListeners.daySelectElement.removeEventListener('change', window.salespersonFilterListeners.daySelect);
                        }
                        if (window.salespersonFilterListeners.clearBtn && window.salespersonFilterListeners.clearBtnElement) {
                            window.salespersonFilterListeners.clearBtnElement.removeEventListener('click', window.salespersonFilterListeners.clearBtn);
                        }
                        window.salespersonFilterListeners = null;
                    }
                });
                window.salespersonFilterListenersCleanupAdded = true;
            }
            
            // Tab deÄŸiÅŸimlerinde de Ã§alÄ±ÅŸtÄ±r
            // MEMORY LEAK FIX: Observer'Ä± global deÄŸiÅŸkende sakla ve cleanup iÃ§in hazÄ±rla
            let mobileTableScrollObserver = null;
            
            // EÄŸer zaten bir observer varsa, Ã¶nce temizle
            if (window.mobileTableScrollObserver) {
                window.mobileTableScrollObserver.disconnect();
                window.mobileTableScrollObserver = null;
            }
            
            mobileTableScrollObserver = new MutationObserver(function() {
                initMobileTableScrollHint();
            });
            
            mobileTableScrollObserver.observe(document.body, {
                childList: true,
                subtree: true
            });
            
            // MEMORY LEAK FIX: Global deÄŸiÅŸkende sakla (cleanup iÃ§in)
            window.mobileTableScrollObserver = mobileTableScrollObserver;
            
            // MEMORY LEAK FIX: Sayfa kapatÄ±ldÄ±ÄŸÄ±nda observer'Ä± disconnect et (sadece bir kez ekle)
            if (!window.mobileTableScrollObserverCleanupAdded) {
                window.addEventListener('beforeunload', function() {
                    if (window.mobileTableScrollObserver) {
                        window.mobileTableScrollObserver.disconnect();
                        window.mobileTableScrollObserver = null;
                    }
                });
                window.mobileTableScrollObserverCleanupAdded = true;
            }
        });

        

        // KullanÄ±cÄ± bilgilerini gÃ¼ncelle
        function updateUserInfo() {
            if (window.currentUser && window.currentUserType) {
                document.getElementById('userInfo').textContent = window.currentUser.name || window.currentUser.username || 'KullanÄ±cÄ±';
                
                const userTypeText = window.currentUserType === 'admin' ? 'ğŸ‘‘ YÃ¶netici' : 'ğŸ‘¤ KullanÄ±cÄ±';
                document.getElementById('userType').textContent = userTypeText;
                
                // GÃ¼venlik bilgilerini gÃ¼ncelle
                const securityText = window.currentUser.twoFactorEnabled ? 'ğŸ” 2FA Aktif' : 'ğŸ›¡ï¸ GÃ¼venli Oturum';
                document.getElementById('securityInfo').textContent = securityText;
            }
        }
        
        // Sayfa yÃ¼klenince kullanÄ±cÄ± bilgilerini gÃ¼ncelle
        updateUserInfo();

        // Eski session yÃ¶netimi kaldÄ±rÄ±ldÄ± - Firebase authentication yeterli
        function showSecurityInfo() {
            // Firebase authentication kullanÄ±lÄ±yor - eski session yÃ¶netimi kaldÄ±rÄ±ldÄ±
            const user = window.firebaseAuth?.currentUser;
            if (user) {
                alert(`ğŸ›¡ï¸ GÃ¼venlik Bilgileri:\nâ€¢ KullanÄ±cÄ±: ${user.email}\nâ€¢ Firebase Authentication aktif`);
            } else {
                alert('GiriÅŸ yapÄ±lmamÄ±ÅŸ.');
            }
        }

        // Sayfa yÃ¼klendiÄŸinde kullanÄ±cÄ± bilgilerini gÃ¼ncelle
        // YÄ±l tamamlanma oranÄ± hesaplama fonksiyonu
        function getYearProgress(year) {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            
            if (currentYear > year) {
                return 1; // GeÃ§miÅŸ yÄ±l - tamamlandÄ±
            } else if (currentYear === year) {
                // Mevcut yÄ±l - tamamlanma oranÄ±nÄ± hesapla
                const daysInYear = 365;
                const daysPassed = Math.floor((currentDate - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24));
                return daysPassed / daysInYear;
            } else {
                return 0; // Gelecek yÄ±l - henÃ¼z baÅŸlamadÄ±
            }
        }
        
        // YÄ±llÄ±k Hedef Analizi Fonksiyonu
        // performYearlyTargetAnalysis fonksiyonu artÄ±k assets/js/features/targets/target-manager.js modÃ¼lÃ¼nde
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        function performYearlyTargetAnalysis() {
            safeConsole.log('ğŸ“Š YÄ±llÄ±k hedef analizi baÅŸlatÄ±lÄ±yor...');
            
            // Veri kontrolÃ¼ - gÃ¼venli Ã§Ä±kÄ±ÅŸ
            if (!allData || allData.length === 0) {
                safeConsole.log('âš ï¸ Veri henÃ¼z yÃ¼klenmedi, analiz atlanÄ±yor');
                return;
            }
            
            // Sadece Hedef Takip sekmesinde Ã§alÄ±ÅŸ
            const targetsTab = document.getElementById('targetsTab');
            if (!targetsTab || !targetsTab.classList.contains('active')) {
                safeConsole.log('âš ï¸ Hedef Takip sekmesi aktif deÄŸil, analiz atlanÄ±yor');
                return;
            }
            
            const container = document.getElementById('yearlyAnalysisContent');
            if (!container) {
                safeConsole.log('âš ï¸ yearlyAnalysisContent elementi bulunamadÄ±, Ã¶nce renderYearlyTargetAnalysis Ã§aÄŸrÄ±lmalÄ±');
                return;
            }
            
            // Mevcut yÄ±l
            const currentYear = new Date().getFullYear();
            
            // SeÃ§ilen yÄ±l (targetFilterYear dropdown'Ä±ndan)
            const selectedYear = document.getElementById('targetFilterYear')?.value || currentYear.toString();
            
            // YÄ±llÄ±k hedefleri localStorage'dan yÃ¼kle
            const yearlyTargets = JSON.parse(localStorage.getItem('yearlyTargets') || '{}');
            
            // YÄ±l tamamlanma oranlarÄ±
            const yearProgress2023 = getYearProgress(2023);
            const yearProgress2024 = getYearProgress(2024);
            const yearProgress2025 = getYearProgress(2025);
            
            // YÄ±llÄ±k verileri topla
            const yearlyData = {};
            const years = ['2023', '2024', '2025'];
            
            years.forEach(year => {
                yearlyData[year] = allData.filter(item => item.date && item.date.startsWith(year));
            });
            
            // MaÄŸaza bazlÄ± analiz
            const storeAnalysis = {};
            
            // TÃ¼m maÄŸazalarÄ± topla
            const allStores = new Set();
            Object.values(yearlyData).forEach(yearData => {
                yearData.forEach(item => {
                    if (item.store) allStores.add(item.store);
                });
            });
            
            // Her maÄŸaza iÃ§in analiz yap
            allStores.forEach(store => {
                const storeData = {
                    name: store,
                    years: {},
                    trends: {},
                    recommendations: []
                };
                
                // Her yÄ±l iÃ§in maÄŸaza verilerini topla
                years.forEach(year => {
                    const yearStoreData = yearlyData[year].filter(item => item.store === store);
                    const totalSales = yearStoreData.reduce((sum, item) => sum + parseFloat(item.usd_amount || 0), 0);
                    const totalQty = yearStoreData.reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
                    const invoiceCount = new Set(yearStoreData.filter(item => item.move_type === 'out_invoice').map(item => item.move_name)).size;
                    
                    storeData.years[year] = {
                        sales: totalSales,
                        qty: totalQty,
                        invoiceCount: invoiceCount,
                        recordCount: yearStoreData.length
                    };
                });
                
                // Trend analizi - 2025 tamamlanmamÄ±ÅŸ yÄ±l dikkate alÄ±narak
                const sales2023 = storeData.years['2023']?.sales || 0;
                const sales2024 = storeData.years['2024']?.sales || 0;
                const sales2025 = storeData.years['2025']?.sales || 0;
                
                // Mevcut tarih ve tamamlanmamÄ±ÅŸ yÄ±l analizi
                const currentDate = new Date();
                const currentYear = currentDate.getFullYear();
                
                // Her yÄ±l iÃ§in tamamlanma oranÄ±nÄ± hesapla
                const getYearProgress = (year) => {
                    if (currentYear > year) {
                        return 1; // GeÃ§miÅŸ yÄ±l - tamamlandÄ±
                    } else if (currentYear === year) {
                        // Mevcut yÄ±l - tamamlanma oranÄ±nÄ± hesapla
                        const daysInYear = 365;
                        const daysPassed = Math.floor((currentDate - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24));
                        return daysPassed / daysInYear;
                    } else {
                        return 0; // Gelecek yÄ±l - henÃ¼z baÅŸlamadÄ±
                    }
                };
                
                
                // Dinamik trend analizi - her yÄ±l iÃ§in tamamlanma durumunu dikkate al
                const calculateTrend = (fromYear, toYear, fromSales, toSales, fromProgress, toProgress) => {
                    if (fromSales <= 0) return null;
                    
                    let actualToSales = toSales;
                    let isProjected = false;
                    
                    // EÄŸer hedef yÄ±l tamamlanmamÄ±ÅŸsa projeksiyon yap
                    if (toProgress < 1 && toProgress > 0) {
                        actualToSales = toSales / toProgress;
                        isProjected = true;
                    }
                    
                    const growth = ((actualToSales - fromSales) / fromSales) * 100;
                    
                    return {
                        growth: growth,
                        type: growth > 0 ? 'positive' : 'negative',
                        isProjected: isProjected,
                        yearProgress: toProgress,
                        projectedSales: isProjected ? actualToSales : toSales
                    };
                };
                
                // 2023-2024 trend
                storeData.trends['2023-2024'] = calculateTrend(2023, 2024, sales2023, sales2024, yearProgress2023, yearProgress2024);
                
                // 2024-2025 trend
                storeData.trends['2024-2025'] = calculateTrend(2024, 2025, sales2024, sales2025, yearProgress2024, yearProgress2025);
                
                // 2023-2025 genel trend
                storeData.trends['2023-2025'] = calculateTrend(2023, 2025, sales2023, sales2025, yearProgress2023, yearProgress2025);
                
                // Dinamik Ã¶neriler oluÅŸtur - gelecek yÄ±l hedefi hesapla
                const nextYear = currentYear + 1;
                const currentYearSales = storeData.years[currentYear.toString()]?.sales || 0;
                const projectedCurrentYear = yearProgress2025 < 1 && yearProgress2025 > 0 ? 
                    (storeData.years['2025']?.sales || 0) / yearProgress2025 : 
                    currentYearSales;
                
                const generateRecommendation = () => {
                    const trend2023_2024 = storeData.trends['2023-2024'];
                    const trend2024_2025 = storeData.trends['2024-2025'];
                    
                    if (trend2023_2024?.type === 'positive' && trend2024_2025?.type === 'positive') {
                        return {
                            type: 'success',
                            title: 'ğŸš€ SÃ¼rekli BÃ¼yÃ¼me',
                            description: `MaÄŸaza 2 yÄ±ldÄ±r sÃ¼rekli bÃ¼yÃ¼yor. ${nextYear} hedefi: $${(projectedCurrentYear * 1.15).toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`
                        };
                    } else if (trend2023_2024?.type === 'negative' && trend2024_2025?.type === 'positive') {
                        return {
                            type: 'warning',
                            title: 'ğŸ“ˆ Toparlanma',
                            description: `2024'te dÃ¼ÅŸÃ¼ÅŸ yaÅŸadÄ± ama ${currentYear}'te toparlandÄ±. ${nextYear} hedefi: $${(projectedCurrentYear * 1.10).toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`
                        };
                    } else if (trend2023_2024?.type === 'positive' && trend2024_2025?.type === 'negative') {
                        return {
                            type: 'danger',
                            title: 'âš ï¸ Dikkat Gerekli',
                            description: `2024'te bÃ¼yÃ¼dÃ¼ ama ${currentYear}'te dÃ¼ÅŸtÃ¼. ${nextYear} hedefi: $${(projectedCurrentYear * 1.05).toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`
                        };
                    } else {
                        return {
                            type: 'info',
                            title: 'ğŸ“Š Stabil Durum',
                            description: `MaÄŸaza stabil performans gÃ¶steriyor. ${nextYear} hedefi: $${(projectedCurrentYear * 1.08).toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`
                        };
                    }
                };
                
                storeData.recommendations.push(generateRecommendation());
                
                storeAnalysis[store] = storeData;
            });
            
            // HTML oluÅŸtur
            let html = '';
            
            Object.values(storeAnalysis).forEach(store => {
                const bgColor = store.recommendations[0]?.type === 'success' ? 'linear-gradient(135deg, #28a745 0%, #20c997 100%)' :
                               store.recommendations[0]?.type === 'warning' ? 'linear-gradient(135deg, #ffc107 0%, #fd7e14 100%)' :
                               store.recommendations[0]?.type === 'danger' ? 'linear-gradient(135deg, #dc3545 0%, #e83e8c 100%)' :
                               'linear-gradient(135deg, #6c757d 0%, #495057 100%)';
                
                html += `
                    <div style="background: ${bgColor}; color: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);">
                        <h3 style="margin: 0 0 20px 0; font-size: 1.4em; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px;">
                            ğŸª ${store.name}
                        </h3>
                        
                        <!-- YÄ±llÄ±k Veriler -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                            ${['2023', '2024', '2025'].map(year => {
                                const yearData = store.years[year];
                                const isCurrentYear = year === currentYear.toString();
                                const currentYearProgress = getYearProgress(parseInt(year));
                                const isProjected = isCurrentYear && currentYearProgress < 1 && currentYearProgress > 0;
                                const displayValue = isProjected ? 
                                    (yearData?.sales || 0) / currentYearProgress : 
                                    (yearData?.sales || 0);
                                
                                // EÄŸer "Proj." yazÄ±yorsa (projeksiyon yÄ±lÄ±), o yÄ±lÄ±n hedefini gÃ¶ster
                                let targetInfo = '';
                                if (isProjected && yearlyTargets[year] && yearlyTargets[year][store.name]) {
                                    const targetValue = parseFloat(yearlyTargets[year][store.name]) || 0;
                                    if (targetValue > 0) {
                                        targetInfo = `<div style="font-size: 0.85em; opacity: 0.9; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2);">
                                            ğŸ¯ %100 Hedef: $${targetValue.toLocaleString('tr-TR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                                        </div>`;
                                    }
                                }
                                
                                return `
                                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                        <div style="font-size: 0.9em; opacity: 0.8;">
                                            ${year}${isProjected ? ' (Proj.)' : ''}
                                        </div>
                                        <div style="font-size: 1.2em; font-weight: bold;">
                                            $${displayValue.toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})}
                                        </div>
                                        ${targetInfo}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <!-- Trend GÃ¶stergeleri -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                            ${[
                                { key: '2023-2024', label: '2023â†’2024' },
                                { key: '2024-2025', label: '2024â†’2025' }
                            ].map(trend => {
                                const trendData = store.trends[trend.key];
                                return `
                                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                                        <div style="font-size: 0.9em; opacity: 0.8; margin-bottom: 5px;">
                                            ${trend.label}${trendData?.isProjected ? ' (Proj.)' : ''}
                                        </div>
                                        <div style="font-size: 1.1em; font-weight: bold;">
                                            ${trendData ? 
                                                (trendData.type === 'positive' ? 'ğŸ“ˆ +' : 'ğŸ“‰ ') + 
                                                trendData.growth.toFixed(1) + '%' : 
                                                'N/A'}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <!-- Ã–neriler -->
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9em; opacity: 0.8; margin-bottom: 10px;">ğŸ’¡ Analiz ve Ã–neri</div>
                            <div style="font-size: 1em; font-weight: 500;">
                                ${store.recommendations[0]?.title || 'Bilgi yok'}
                            </div>
                            <div style="font-size: 0.9em; opacity: 0.9; margin-top: 5px;">
                                ${store.recommendations[0]?.description || 'Analiz yapÄ±lamadÄ±'}
                            </div>
                            ${yearlyTargets[selectedYear] && yearlyTargets[selectedYear][store.name] ? `
                                <div style="font-size: 0.9em; opacity: 0.9; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">
                                    ğŸ¯ ${selectedYear} Hedefi: $${parseFloat(yearlyTargets[selectedYear][store.name]).toLocaleString('tr-TR', {minimumFractionDigits: 0, maximumFractionDigits: 0})}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            safeConsole.log('âœ… YÄ±llÄ±k hedef analizi tamamlandÄ±');
        }
        
        // ğŸ§ª KAMPANYA Ä°NDÄ°RÄ°M TEST FONKSÄ°YONU (Console'dan Ã§alÄ±ÅŸtÄ±rÄ±labilir)
        window.testCampaignDiscount = function() {
            console.log('ğŸ§ª Kampanya Ä°ndirim Test Modu BaÅŸlatÄ±lÄ±yor...');
            
            // Mock kampanya verileri ile test
            const mockData = [
                {
                    date: '2025-01-15',
                    product: 'Fender Stratocaster',
                    brand: 'Fender',
                    quantity: 1,
                    usd_amount: 364.29,  // KampanyalÄ± fiyattan satÄ±ldÄ±
                    store: 'Akasya',
                    partner: 'Test MÃ¼ÅŸteri',
                    // YENÄ°: Kampanya bilgileri
                    has_campaign: true,
                    campaign_discount_pct: 15.0,
                    extra_discount_pct: 0.0,
                    actual_discount_pct: 0.0,  // âœ… %0 gÃ¶rÃ¼necek
                    campaign_lost: false,
                    list_price_usd: 428.57,
                    campaign_price_usd: 364.29,
                    price_unit_usd: 364.29
                },
                {
                    date: '2025-01-16',
                    product: 'Fender Stratocaster',
                    brand: 'Fender',
                    quantity: 1,
                    usd_amount: 342.86,  // KampanyanÄ±n Ã¼stÃ¼ne ek indirim
                    store: 'Akasya',
                    partner: 'Test MÃ¼ÅŸteri',
                    has_campaign: true,
                    campaign_discount_pct: 15.0,
                    extra_discount_pct: 5.88,
                    actual_discount_pct: 20.0,  // âœ… %20 gÃ¶rÃ¼necek
                    campaign_lost: false,
                    list_price_usd: 428.57,
                    campaign_price_usd: 364.29,
                    price_unit_usd: 342.86
                },
                {
                    date: '2025-01-17',
                    product: 'Fender Stratocaster',
                    brand: 'Fender',
                    quantity: 1,
                    usd_amount: 385.71,  // Kampanya yok, normal indirim
                    store: 'Akasya',
                    partner: 'Test MÃ¼ÅŸteri',
                    has_campaign: false,
                    campaign_discount_pct: 0.0,
                    extra_discount_pct: 0.0,
                    actual_discount_pct: 10.0,  // âœ… %10 gÃ¶rÃ¼necek
                    campaign_lost: false,
                    list_price_usd: 428.57,
                    campaign_price_usd: null,
                    price_unit_usd: 385.71
                }
            ];
            
            // Test sonuÃ§larÄ±nÄ± gÃ¶ster
            console.table(mockData.map(item => ({
                'ÃœrÃ¼n': item.product,
                'SatÄ±ÅŸ FiyatÄ± (USD)': item.price_unit_usd.toFixed(2),
                'Kampanya Var mÄ±?': item.has_campaign ? 'Evet' : 'HayÄ±r',
                'Kampanya Ä°ndirimi': item.has_campaign ? `${item.campaign_discount_pct}%` : '-',
                'Ek Ä°ndirim': item.extra_discount_pct > 0 ? `${item.extra_discount_pct.toFixed(2)}%` : '0%',
                'GerÃ§ek Ä°ndirim (Sayfada GÃ¶rÃ¼necek)': `${item.actual_discount_pct.toFixed(2)}%`
            })));
            
            // HTML formatÄ±nda gÃ¶ster
            let html = `
                <div style="background: #f8f9fa; padding: 20px; margin: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h3 style="color: #10B981; margin-bottom: 15px;">ğŸ§ª Kampanya Ä°ndirim Test SonuÃ§larÄ±</h3>
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead style="background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); color: white;">
                            <tr>
                                <th style="padding: 10px; text-align: left;">ÃœrÃ¼n</th>
                                <th style="padding: 10px; text-align: right;">SatÄ±ÅŸ FiyatÄ±</th>
                                <th style="padding: 10px; text-align: center;">Kampanya</th>
                                <th style="padding: 10px; text-align: center;">Kampanya Ä°nd.</th>
                                <th style="padding: 10px; text-align: center;">Ek Ä°ndirim</th>
                                <th style="padding: 10px; text-align: center; background: #38ef7d;">GerÃ§ek Ä°ndirim</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            mockData.forEach((item, index) => {
                const bgColor = index % 2 === 0 ? '#f8f9fa' : 'white';
                const discountColor = item.actual_discount_pct === 0 ? '#38ef7d' : item.actual_discount_pct > 15 ? '#f5576c' : '#ffc107';
                html += `
                    <tr style="background: ${bgColor};">
                        <td style="padding: 10px;"><strong>${item.product}</strong></td>
                        <td style="padding: 10px; text-align: right;">$${item.price_unit_usd.toFixed(2)}</td>
                        <td style="padding: 10px; text-align: center;">${item.has_campaign ? 'âœ… Evet' : 'âŒ HayÄ±r'}</td>
                        <td style="padding: 10px; text-align: center;">${item.has_campaign ? `${item.campaign_discount_pct}%` : '-'}</td>
                        <td style="padding: 10px; text-align: center;">${item.extra_discount_pct > 0 ? `${item.extra_discount_pct.toFixed(2)}%` : '0%'}</td>
                        <td style="padding: 10px; text-align: center; font-weight: bold; color: ${discountColor}; background: ${discountColor}22;">
                            ${item.actual_discount_pct.toFixed(2)}%
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 5px;">
                        <strong>ğŸ“ Not:</strong> Bu test verileri mock data ile oluÅŸturulmuÅŸtur. 
                        GerÃ§ek veriler workflow'dan geldiÄŸinde aynÄ± mantÄ±k uygulanacaktÄ±r.
                        <br><br>
                        <strong>âœ… Senaryo 1:</strong> KampanyalÄ± fiyattan satÄ±ÅŸ â†’ GerÃ§ek indirim: <strong>%0</strong>
                        <br>
                        <strong>âœ… Senaryo 2:</strong> KampanyanÄ±n Ã¼stÃ¼ne ek indirim â†’ Toplam: <strong>%20</strong> (Kampanya %15 + Ek %6)
                        <br>
                        <strong>âœ… Senaryo 3:</strong> Kampanya yok, normal indirim â†’ <strong>%10</strong>
                    </div>
                </div>
            `;
            
            // Test sonuÃ§larÄ±nÄ± sayfaya ekle
            const testContainer = document.createElement('div');
            testContainer.id = 'campaignDiscountTestResults';
            testContainer.innerHTML = html;
            testContainer.style.position = 'fixed';
            testContainer.style.top = '20px';
            testContainer.style.right = '20px';
            testContainer.style.width = '800px';
            testContainer.style.maxHeight = '90vh';
            testContainer.style.overflow = 'auto';
            testContainer.style.zIndex = '10000';
            testContainer.style.border = '2px solid #10B981';
            
            // Kapat butonu ekle
            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'âœ• Kapat';
            closeBtn.style.cssText = 'position: absolute; top: 10px; right: 10px; background: #f5576c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;';
            closeBtn.onclick = () => testContainer.remove();
            testContainer.querySelector('h3').style.position = 'relative';
            testContainer.querySelector('h3').appendChild(closeBtn);
            
            // Eski test sonuÃ§larÄ±nÄ± kaldÄ±r
            const oldTest = document.getElementById('campaignDiscountTestResults');
            if (oldTest) oldTest.remove();
            
            document.body.appendChild(testContainer);
            
            console.log('âœ… Test sonuÃ§larÄ± sayfaya eklendi! Test panelini kapatmak iÃ§in âœ• Kapat butonuna tÄ±klayÄ±n.');
            console.log('ğŸ’¡ Console\'da testCampaignDiscount() fonksiyonunu tekrar Ã§alÄ±ÅŸtÄ±rarak test panelini tekrar aÃ§abilirsiniz.');
        };
        
        // Test fonksiyonunu console'a bilgi ver
        console.log('ğŸ§ª Kampanya Ä°ndirim Test Modu hazÄ±r! Console\'da testCampaignDiscount() yazarak test edebilirsiniz.');

        document.addEventListener('DOMContentLoaded', function() {
            updateUserInfo();
            
            // YÄ±llÄ±k hedef analizini baÅŸlat (allData yÃ¼klenene kadar bekle)
            // MEMORY LEAK FIX: Timeout ID'lerini kaydet ve maksimum retry ekle
            if (!window.checkAnalysisTimeoutId) {
                window.checkAnalysisTimeoutId = null;
            }
            if (!window.checkAnalysisRetryCount) {
                window.checkAnalysisRetryCount = 0;
            }
            const MAX_CHECK_ANALYSIS_RETRIES = 60; // Maksimum 30 saniye (60 * 500ms)
            
            const checkAndPerformAnalysis = () => {
                // MEMORY LEAK FIX: Timeout ID'sini temizle
                window.checkAnalysisTimeoutId = null;
                
                if (typeof window.allData !== 'undefined' && window.allData && window.allData.length > 0) {
                    performYearlyTargetAnalysis();
                    // BaÅŸarÄ±lÄ±, retry sayacÄ±nÄ± sÄ±fÄ±rla
                    window.checkAnalysisRetryCount = 0;
                } else {
                    // allData henÃ¼z yÃ¼klenmedi, tekrar dene
                    window.checkAnalysisRetryCount++;
                    
                    // MEMORY LEAK FIX: Maksimum retry sayÄ±sÄ±nÄ± kontrol et
                    if (window.checkAnalysisRetryCount >= MAX_CHECK_ANALYSIS_RETRIES) {
                        safeConsole.warn('âš ï¸ YÄ±llÄ±k hedef analizi baÅŸlatÄ±lamadÄ± (allData yÃ¼klenemedi, maksimum retry sayÄ±sÄ±na ulaÅŸÄ±ldÄ±)');
                        return;
                    }
                    
                    // MEMORY LEAK FIX: Timeout ID'sini kaydet
                    window.checkAnalysisTimeoutId = setTimeout(checkAndPerformAnalysis, 500);
                }
            };
            
            // MEMORY LEAK FIX: Ä°lk kontrolÃ¼ 2 saniye sonra yap, ID'yi kaydet
            window.checkAnalysisTimeoutId = setTimeout(checkAndPerformAnalysis, 2000);
            
            // MEMORY LEAK FIX: Sayfa kapatÄ±ldÄ±ÄŸÄ±nda timeout'u temizle (sadece bir kez ekle)
            if (!window.checkAnalysisTimeoutCleanupAdded) {
                window.addEventListener('beforeunload', function() {
                    if (window.checkAnalysisTimeoutId !== null) {
                        clearTimeout(window.checkAnalysisTimeoutId);
                        window.checkAnalysisTimeoutId = null;
                    }
                });
                window.checkAnalysisTimeoutCleanupAdded = true;
            }
            
        });
        
        // ==================== AI SORGULAMA (OPENAI GPT-4o MINI) ====================
        // AI sorgulama fonksiyonlarÄ± artÄ±k assets/js/filters/ai-filter.js modÃ¼lÃ¼nde
        // buildAdvancedAIContext, askAI, saveQueryToHistory, getQueryHistory
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        
        // Ã–ÄŸrenme mekanizmasÄ± (localStorage ile geÃ§miÅŸ sorular)
        // saveQueryToHistory, getQueryHistory, askAI fonksiyonlarÄ± artÄ±k assets/js/filters/ai-filter.js modÃ¼lÃ¼nde
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        
        // buildAdvancedAIContext fonksiyonu artÄ±k assets/js/filters/ai-filter.js modÃ¼lÃ¼nde
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        
        // buildAdvancedAIContext, saveQueryToHistory, getQueryHistory, askAI fonksiyonlarÄ± artÄ±k assets/js/filters/ai-filter.js modÃ¼lÃ¼nde
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        function saveQueryToHistory(query, response) {
            if (window.saveQueryToHistory) {
                return window.saveQueryToHistory(query, response);
            }
            safeConsole.warn('âš ï¸ saveQueryToHistory fonksiyonu modÃ¼lden yÃ¼klenemedi');
        }
        
        function getQueryHistory() {
            if (window.getQueryHistory) {
                return window.getQueryHistory();
            }
            safeConsole.warn('âš ï¸ getQueryHistory fonksiyonu modÃ¼lden yÃ¼klenemedi');
            return [];
        }
        
        async function askAI() {
            if (window.askAI) {
                return window.askAI();
            }
            safeConsole.warn('âš ï¸ askAI fonksiyonu modÃ¼lden yÃ¼klenemedi');
            alert('âš ï¸ AI sorgulama fonksiyonu yÃ¼klenemedi. LÃ¼tfen sayfayÄ± yenileyin.');
        }
        
        // askAI_OLD fonksiyonu kaldÄ±rÄ±ldÄ± - artÄ±k assets/js/filters/ai-filter.js modÃ¼lÃ¼nde
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        
        // askAI_OLD fonksiyonunun kalÄ±ntÄ±larÄ± kaldÄ±rÄ±ldÄ± - artÄ±k assets/js/filters/ai-filter.js modÃ¼lÃ¼nde
        // Global eriÅŸim iÃ§in window objesi Ã¼zerinden eriÅŸilebilir
        
    </script>
    
    <!-- Developer Credit -->
    <div style="position: fixed; bottom: 10px; right: 25px; font-size: 11px; color: #999; z-index: 9999; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: rgba(255,255,255,0.9); padding: 5px 12px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); backdrop-filter: blur(5px);">
        Developed by <strong style="color: #10B981;">Tofta</strong>
    </div>
    
    <!-- Chatbase Embed Script -->
    <script>
        (function(){
            // Chatbase configuration - Environment variables veya default deÄŸerler
            const CHATBOT_ID = window.NEXT_PUBLIC_CHATBOT_ID || "MqnCwh4qRsFJXknXYKMnL";
            const CHATBASE_HOST = window.NEXT_PUBLIC_CHATBASE_HOST || "https://www.chatbase.co/";
            
            if(!window.chatbase||window.chatbase("getState")!=="initialized"){
                window.chatbase=(...arguments)=>{
                    if(!window.chatbase.q){window.chatbase.q=[]}
                    window.chatbase.q.push(arguments)
                };
                window.chatbase=new Proxy(window.chatbase,{
                    get(target,prop){
                        if(prop==="q"){return target.q}
                        return(...args)=>target(prop,...args)
                    }
                })
            }
            const onLoad=function(){
                console.log("ğŸ” Chatbase yÃ¼kleniyor...", {CHATBOT_ID, CHATBASE_HOST});
                const script=document.createElement("script");
                script.src=CHATBASE_HOST.replace(/\/$/, "") + "/embed.min.js";
                script.id=CHATBOT_ID;
                script.domain="www.chatbase.co";
                script.onload = function() {
                    console.log("âœ… Chatbase script yÃ¼klendi");
                };
                script.onerror = function(error) {
                    console.error("âŒ Chatbase script yÃ¼kleme hatasÄ±:", error);
                };
                document.body.appendChild(script);
                
                // Chatbase'in yÃ¼klenmesini bekle ve durumu kontrol et
                setTimeout(function() {
                    if (window.chatbase) {
                        console.log("âœ… Chatbase widget hazÄ±r");
                        try {
                            const state = window.chatbase("getState");
                            console.log("ğŸ“Š Chatbase durumu:", state);
                        } catch(e) {
                            console.warn("âš ï¸ Chatbase durumu alÄ±namadÄ±:", e);
                        }
                    } else {
                        console.warn("âš ï¸ Chatbase widget yÃ¼klenemedi");
                    }
                }, 2000);
            };
            if(document.readyState==="complete"){
                onLoad()
            }else{
                window.addEventListener("load",onLoad)
            }
        })();
    </script>
    
    <!-- Mixedbread Embedding SDK -->
    <script>
        (function(){
            // Mixedbread configuration - Environment variables veya default deÄŸerler
            const MXBAI_API_KEY = window.MXBAI_API_KEY || window.NEXT_PUBLIC_MXBAI_API_KEY || "mxb_1vHduIQLOuBCAbUkFVYo9rwR0bRs";
            const MXBAI_STORE_ID = window.MXBAI_STORE_ID || window.NEXT_PUBLIC_MXBAI_STORE_ID || "f614451d-f90e-4381-a8ef-3b09c4cc04a5";
            const MXBAI_API_URL = window.MXBAI_API_URL || "https://api.mixedbread.ai";
            const MXBAI_DEFAULT_MODEL = window.MXBAI_DEFAULT_MODEL || "mixedbread-ai/mxbai-embed-large-v1";
            
            // Mixedbread SDK
            window.Mixedbread = function(options) {
                const opts = options || {};
                this.apiKey = opts.apiKey || MXBAI_API_KEY;
                this.apiUrl = MXBAI_API_URL;
                this.storeId = opts.storeId || MXBAI_STORE_ID;
                
                if (!this.apiKey) {
                    console.warn("âš ï¸ Mixedbread API key bulunamadÄ±. MXBAI_API_KEY environment variable'Ä±nÄ± ayarlayÄ±n.");
                }
                
                // Stores API
                this.stores = {
                    // Store oluÅŸturma
                    create: async (options) => {
                        const { name, description } = options || {};
                        if (!name) {
                            throw new Error("Store name gerekli.");
                        }
                        
                        try {
                            const response = await fetch(`${this.apiUrl}/v1/stores`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${this.apiKey}`
                                },
                                body: JSON.stringify({
                                    name: name,
                                    description: description || ""
                                })
                            });
                            
                            if (!response.ok) {
                                const errorData = await response.json().catch(() => ({}));
                                throw new Error(errorData.error?.message || `API hatasÄ±: ${response.status} ${response.statusText}`);
                            }
                            
                            return await response.json();
                        } catch (error) {
                            console.error("âŒ Mixedbread store oluÅŸturma hatasÄ±:", error);
                            throw error;
                        }
                    },
                    
                    // Dosya yÃ¼kleme (File API ile)
                    files: {
                        uploadAndPoll: async (options) => {
                            const { storeIdentifier, file } = options || {};
                            const storeId = storeIdentifier || this.storeId;
                            
                            if (!storeId) {
                                throw new Error("Store ID gerekli. MXBAI_STORE_ID ayarlayÄ±n veya storeIdentifier parametresi verin.");
                            }
                            
                            if (!file) {
                                throw new Error("File gerekli. File object veya FileList verin.");
                            }
                            
                            // File object'i FormData'ya Ã§evir
                            const formData = new FormData();
                            
                            // File object ise direkt ekle
                            if (file instanceof File) {
                                formData.append('file', file);
                            } else if (file instanceof FileList && file.length > 0) {
                                formData.append('file', file[0]);
                            } else {
                                throw new Error("GeÃ§ersiz file formatÄ±. File veya FileList olmalÄ±.");
                            }
                            
                            try {
                                // Dosya yÃ¼kleme
                                const uploadResponse = await fetch(`${this.apiUrl}/v1/stores/${storeId}/files`, {
                                    method: 'POST',
                                    headers: {
                                        'Authorization': `Bearer ${this.apiKey}`
                                    },
                                    body: formData
                                });
                                
                                if (!uploadResponse.ok) {
                                    const errorData = await uploadResponse.json().catch(() => ({}));
                                    throw new Error(errorData.error?.message || `API hatasÄ±: ${uploadResponse.status} ${uploadResponse.statusText}`);
                                }
                                
                                const uploadData = await uploadResponse.json();
                                const fileId = uploadData.id || uploadData.file_id;
                                
                                // Polling - iÅŸlem tamamlanana kadar bekle
                                let pollAttempts = 0;
                                const maxPollAttempts = 60; // 5 dakika (5 saniye aralÄ±klarla)
                                
                                while (pollAttempts < maxPollAttempts) {
                                    await new Promise(resolve => setTimeout(resolve, 5000)); // 5 saniye bekle
                                    
                                    const statusResponse = await fetch(`${this.apiUrl}/v1/stores/${storeId}/files/${fileId}`, {
                                        method: 'GET',
                                        headers: {
                                            'Authorization': `Bearer ${this.apiKey}`
                                        }
                                    });
                                    
                                    if (statusResponse.ok) {
                                        const statusData = await statusResponse.json();
                                        const status = statusData.status || statusData.state;
                                        
                                        if (status === 'completed' || status === 'ready') {
                                            return statusData;
                                        } else if (status === 'failed' || status === 'error') {
                                            throw new Error(`Dosya yÃ¼kleme baÅŸarÄ±sÄ±z: ${statusData.error || 'Bilinmeyen hata'}`);
                                        }
                                        // Devam ediyor, tekrar dene
                                    }
                                    
                                    pollAttempts++;
                                }
                                
                                throw new Error("Dosya yÃ¼kleme timeout. Ä°ÅŸlem Ã§ok uzun sÃ¼rdÃ¼.");
                            } catch (error) {
                                console.error("âŒ Mixedbread dosya yÃ¼kleme hatasÄ±:", error);
                                throw error;
                            }
                        }
                    },
                    
                    // Arama yapma
                    search: async (options) => {
                        const { 
                            query, 
                            store_identifiers, 
                            top_k = 10,
                            model = MXBAI_DEFAULT_MODEL
                        } = options || {};
                        
                        if (!query) {
                            throw new Error("Query gerekli.");
                        }
                        
                        const storeIds = store_identifiers || (this.storeId ? [this.storeId] : []);
                        
                        if (storeIds.length === 0) {
                            throw new Error("Store ID gerekli. MXBAI_STORE_ID ayarlayÄ±n veya store_identifiers parametresi verin.");
                        }
                        
                        try {
                            const response = await fetch(`${this.apiUrl}/v1/stores/search`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${this.apiKey}`
                                },
                                body: JSON.stringify({
                                    query: query,
                                    store_identifiers: storeIds,
                                    top_k: top_k,
                                    model: model
                                })
                            });
                            
                            if (!response.ok) {
                                const errorData = await response.json().catch(() => ({}));
                                throw new Error(errorData.error?.message || `API hatasÄ±: ${response.status} ${response.statusText}`);
                            }
                            
                            return await response.json();
                        } catch (error) {
                            console.error("âŒ Mixedbread arama hatasÄ±:", error);
                            throw error;
                        }
                    }
                };
            };
            
            // Embed fonksiyonu
            window.Mixedbread.prototype.embed = async function(options) {
                const {
                    model = MXBAI_DEFAULT_MODEL,
                    input = [],
                    normalized = true,
                    encoding_format = "float"
                } = options || {};
                
                if (!this.apiKey) {
                    throw new Error("Mixedbread API key bulunamadÄ±. MXBAI_API_KEY ayarlayÄ±n.");
                }
                
                if (!Array.isArray(input) || input.length === 0) {
                    throw new Error("Input bir array olmalÄ± ve en az bir eleman iÃ§ermeli.");
                }
                
                try {
                    const response = await fetch(`${this.apiUrl}/v1/embeddings`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiKey}`
                        },
                        body: JSON.stringify({
                            model: model,
                            input: input,
                            normalized: normalized,
                            encoding_format: encoding_format
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error?.message || `API hatasÄ±: ${response.status} ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    return {
                        data: data.data || [],
                        model: data.model,
                        usage: data.usage
                    };
                } catch (error) {
                    console.error("âŒ Mixedbread embedding hatasÄ±:", error);
                    throw error;
                }
            };
            
            // Global instance oluÅŸtur (API key varsa)
            if (MXBAI_API_KEY) {
                window.mxbai = new window.Mixedbread({
                    apiKey: MXBAI_API_KEY,
                    storeId: MXBAI_STORE_ID
                });
                console.log("âœ… Mixedbread SDK yÃ¼klendi.");
                console.log("ğŸ“š KullanÄ±m Ã¶rnekleri:");
                console.log("  - Embedding: window.mxbai.embed({input: ['text']})");
                console.log("  - Store oluÅŸtur: window.mxbai.stores.create({name: 'My Store'})");
                console.log("  - Dosya yÃ¼kle: window.mxbai.stores.files.uploadAndPoll({storeIdentifier: 'id', file: fileObject})");
                console.log("  - Arama: window.mxbai.stores.search({query: 'soru', store_identifiers: ['id']})");
            } else {
                console.warn("âš ï¸ Mixedbread API key bulunamadÄ±. window.mxbai kullanÄ±lamayacak.");
            }
        })();
    </script>
    
</body>
</html>

